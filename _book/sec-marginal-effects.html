<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 17 Marginal Effects | A Guide on Data Analysis</title>
<meta name="author" content="Mike Nguyen">
<meta name="description" content="Marginal effects play a fundamental role in interpreting regression models, particularly when analyzing the impact of explanatory variables on an outcome variable. These effects provide a precise...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 17 Marginal Effects | A Guide on Data Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/mike/data_analysis/sec-marginal-effects.html">
<meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<meta property="og:description" content="Marginal effects play a fundamental role in interpreting regression models, particularly when analyzing the impact of explanatory variables on an outcome variable. These effects provide a precise...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 17 Marginal Effects | A Guide on Data Analysis">
<meta name="twitter:description" content="Marginal effects play a fundamental role in interpreting regression models, particularly when analyzing the impact of explanatory variables on an outcome variable. These effects provide a precise...">
<meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DMNX2X65HQ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide on Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">2</span> Prerequisites</a></li>
<li class="book-part">I. BASIC</li>
<li><a class="" href="descriptive-statistics.html"><span class="header-section-number">3</span> Descriptive Statistics</a></li>
<li><a class="" href="basic-statistical-inference.html"><span class="header-section-number">4</span> Basic Statistical Inference</a></li>
<li class="book-part">II. REGRESSION</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></li>
<li><a class="" href="non-linear-regression.html"><span class="header-section-number">6</span> Non-Linear Regression</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></li>
<li><a class="" href="sec-linear-mixed-models.html"><span class="header-section-number">8</span> Linear Mixed Models</a></li>
<li><a class="" href="sec-nonlinear-and-generalized-linear-mixed-models.html"><span class="header-section-number">9</span> Nonlinear and Generalized Linear Mixed Models</a></li>
<li><a class="" href="sec-nonparametric-regression.html"><span class="header-section-number">10</span> Nonparametric Regression</a></li>
<li class="book-part">III. RAMIFICATIONS</li>
<li><a class="" href="data.html"><span class="header-section-number">11</span> Data</a></li>
<li><a class="" href="variable-transformation.html"><span class="header-section-number">12</span> Variable Transformation</a></li>
<li><a class="" href="imputation-missing-data.html"><span class="header-section-number">13</span> Imputation (Missing Data)</a></li>
<li><a class="" href="model-specification-tests.html"><span class="header-section-number">14</span> Model Specification Tests</a></li>
<li><a class="" href="variable-selection.html"><span class="header-section-number">15</span> Variable Selection</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">16</span> Hypothesis Testing</a></li>
<li><a class="active" href="sec-marginal-effects.html"><span class="header-section-number">17</span> Marginal Effects</a></li>
<li><a class="" href="moderation.html"><span class="header-section-number">18</span> Moderation</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">19</span> Mediation</a></li>
<li><a class="" href="prediction-and-estimation.html"><span class="header-section-number">20</span> Prediction and Estimation</a></li>
<li class="book-part">IV. CAUSAL INFERENCE</li>
<li><a class="" href="sec-causal-inference.html"><span class="header-section-number">21</span> Causal Inference</a></li>
<li class="book-part">A. EXPERIMENTAL DESIGN</li>
<li><a class="" href="sec-experimental-design.html"><span class="header-section-number">22</span> Experimental Design</a></li>
<li><a class="" href="sampling.html"><span class="header-section-number">23</span> Sampling</a></li>
<li><a class="" href="sec-analysis-of-variance-anova.html"><span class="header-section-number">24</span> Analysis of Variance</a></li>
<li><a class="" href="sec-multivariate-methods.html"><span class="header-section-number">25</span> Multivariate Methods</a></li>
<li class="book-part">B. QUASI-EXPERIMENTAL DESIGN</li>
<li><a class="" href="sec-quasi-experimental.html"><span class="header-section-number">26</span> Quasi-Experimental Methods</a></li>
<li><a class="" href="sec-regression-discontinuity.html"><span class="header-section-number">27</span> Regression Discontinuity</a></li>
<li><a class="" href="temporal-discontinuity-designs.html"><span class="header-section-number">28</span> Temporal Discontinuity Designs</a></li>
<li><a class="" href="sec-synthetic-difference-in-differences.html"><span class="header-section-number">29</span> Synthetic Difference-in-Differences</a></li>
<li><a class="" href="sec-difference-in-differences.html"><span class="header-section-number">30</span> Difference-in-Differences</a></li>
<li><a class="" href="changes-in-changes.html"><span class="header-section-number">31</span> Changes-in-Changes</a></li>
<li><a class="" href="sec-synthetic-control.html"><span class="header-section-number">32</span> Synthetic Control</a></li>
<li><a class="" href="event-studies.html"><span class="header-section-number">33</span> Event Studies</a></li>
<li><a class="" href="sec-instrumental-variables.html"><span class="header-section-number">34</span> Instrumental Variables</a></li>
<li><a class="" href="sec-matching-methods.html"><span class="header-section-number">35</span> Matching Methods</a></li>
<li class="book-part">C. OTHER CONCERNS</li>
<li><a class="" href="endogeneity.html"><span class="header-section-number">36</span> Endogeneity</a></li>
<li><a class="" href="other-biases.html"><span class="header-section-number">37</span> Other Biases</a></li>
<li><a class="" href="controls.html"><span class="header-section-number">38</span> Controls</a></li>
<li><a class="" href="directed-acyclic-graph.html"><span class="header-section-number">39</span> Directed Acyclic Graph</a></li>
<li class="book-part">V. MISCELLANEOUS</li>
<li><a class="" href="report.html"><span class="header-section-number">40</span> Report</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">41</span> Exploratory Data Analysis</a></li>
<li><a class="" href="sensitivity-analysis-robustness-check.html"><span class="header-section-number">42</span> Sensitivity Analysis/ Robustness Check</a></li>
<li><a class="" href="replication-and-synthetic-data.html"><span class="header-section-number">43</span> Replication and Synthetic Data</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="appendix.html"><span class="header-section-number">A</span> Appendix</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">B</span> Bookdown cheat sheet</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mikenguyen13/data_analysis">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="sec-marginal-effects" class="section level1" number="17">
<h1>
<span class="header-section-number">17</span> Marginal Effects<a class="anchor" aria-label="anchor" href="#sec-marginal-effects"><i class="fas fa-link"></i></a>
</h1>
<p>Marginal effects play a fundamental role in <strong>interpreting regression models</strong>, particularly when analyzing the impact of explanatory variables on an outcome variable. These effects provide a precise measure of <strong>how a small change in an independent variable influences the dependent variable</strong>.</p>
<p>The concept of a <a href="sec-marginal-effects.html#sec-marginal-effects">marginal effect</a> is closely linked to <strong>derivatives</strong> in calculus. In simple linear models, marginal effects correspond directly to the estimated regression coefficients. However, in nonlinear models, computing marginal effects requires careful consideration, often involving either <a href="sec-marginal-effects.html#sec-analytical-derivation-of-marginal-effects">analytical differentiation</a> or <a href="sec-marginal-effects.html#sec-numerical-approximation-of-marginal-effects">numerical approximation</a>.</p>
<div id="definition-of-marginal-effects" class="section level2" number="17.1">
<h2>
<span class="header-section-number">17.1</span> Definition of Marginal Effects<a class="anchor" aria-label="anchor" href="#definition-of-marginal-effects"><i class="fas fa-link"></i></a>
</h2>
<p>Mathematically, the <strong>marginal effect</strong> of an independent variable <span class="math inline">\(X\)</span> on the expected value of a dependent variable <span class="math inline">\(Y\)</span> is given by:</p>
<p><span class="math display">\[
\frac{\partial E[Y|X]}{\partial X}
\]</span></p>
<p>which represents the instantaneous rate of change of <span class="math inline">\(E[Y|X]\)</span> with respect to <span class="math inline">\(X\)</span>.</p>
<p>For a <strong>linear regression model</strong>:</p>
<p><span class="math display">\[
Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_k X_k + \varepsilon
\]</span></p>
<p>the marginal effect of <span class="math inline">\(X_j\)</span> is simply <span class="math inline">\(\beta_j\)</span>. However, in more complex cases, such as nonlinear models, interaction effects, or transformations, marginal effects are not directly given by the regression coefficients and must be computed explicitly.</p>
<hr>
<div id="sec-analytical-derivation-of-marginal-effects" class="section level3" number="17.1.1">
<h3>
<span class="header-section-number">17.1.1</span> Analytical Derivation of Marginal Effects<a class="anchor" aria-label="anchor" href="#sec-analytical-derivation-of-marginal-effects"><i class="fas fa-link"></i></a>
</h3>
<p>In models where <span class="math inline">\(E[Y|X]\)</span> is a differentiable function of <span class="math inline">\(X\)</span>, marginal effects are computed using calculus. The derivative of a function <span class="math inline">\(f(x)\)</span> is given by:</p>
<p><span class="math display">\[
f'(x) \equiv \lim_{h \to 0} \frac{f(x+h) - f(x)}{h}
\]</span></p>
<hr>
<p><strong>Example: Quadratic Function</strong></p>
<p>Consider the function:</p>
<p><span class="math display">\[
f(x) = x^2.
\]</span></p>
<p>The marginal effect is derived as follows:</p>
<p><span class="math display">\[
\begin{aligned}
f'(x) &amp;= \lim_{h \to 0} \frac{(x+h)^2 - x^2}{h} \\
&amp;= \frac{x^2 + 2xh + h^2 - x^2}{h} \\
&amp;= \frac{2xh + h^2}{h} \\
&amp;= 2x + h.
\end{aligned}
\]</span></p>
<p>As <span class="math inline">\(h \to 0\)</span>, the marginal effect simplifies to:</p>
<p><span class="math display">\[
f'(x) = 2x.
\]</span></p>
<p>Thus, for small changes in <span class="math inline">\(x\)</span>, the effect on <span class="math inline">\(f(x)\)</span> depends on <span class="math inline">\(x\)</span> itself.</p>
<hr>
</div>
<div id="sec-numerical-approximation-of-marginal-effects" class="section level3" number="17.1.2">
<h3>
<span class="header-section-number">17.1.2</span> Numerical Approximation of Marginal Effects<a class="anchor" aria-label="anchor" href="#sec-numerical-approximation-of-marginal-effects"><i class="fas fa-link"></i></a>
</h3>
<p>In practice, analytical differentiation may be infeasible, particularly when dealing with <strong>complex functions, large datasets, or models without closed-form derivatives</strong>. In such cases, numerical differentiation provides an alternative.</p>
<div id="sec-one-sided-numerical-approximation" class="section level4" number="17.1.2.1">
<h4>
<span class="header-section-number">17.1.2.1</span> One-Sided Numerical Approximation<a class="anchor" aria-label="anchor" href="#sec-one-sided-numerical-approximation"><i class="fas fa-link"></i></a>
</h4>
<p>A simple way to approximate the derivative is the forward difference formula:</p>
<p><span class="math display">\[
\begin{aligned}
f'(x) &amp;= \lim_{h \to 0} \frac{(x+h)^2 - x^2}{h}  \\
&amp; \approx \frac{f(x+h) -f(x)}{h}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(h\)</span> is a small step size.</p>
</div>
<div id="sec-two-sided-numerical-approximation" class="section level4" number="17.1.2.2">
<h4>
<span class="header-section-number">17.1.2.2</span> Two-Sided Numerical Approximation<a class="anchor" aria-label="anchor" href="#sec-two-sided-numerical-approximation"><i class="fas fa-link"></i></a>
</h4>
<p>A more accurate method is the central difference formula:</p>
<p><span class="math display">\[
f'_2(x) \approx \frac{f(x+h) - f(x-h)}{2h}.
\]</span></p>
<p>This approach reduces numerical error and is generally preferred in computational implementations.</p>
</div>
<div id="choosing-an-appropriate-h" class="section level4" number="17.1.2.3">
<h4>
<span class="header-section-number">17.1.2.3</span> Choosing an Appropriate <span class="math inline">\(h\)</span><a class="anchor" aria-label="anchor" href="#choosing-an-appropriate-h"><i class="fas fa-link"></i></a>
</h4>
<p>The choice of <span class="math inline">\(h\)</span> is critical <span class="citation">(<a href="references.html#ref-gould2010maximum">Gould, Pitblado, and Poi 2010, chap. 1</a>)</span>:</p>
<ul>
<li>
<strong>Too small</strong>: Can lead to numerical instability due to floating-point precision limitations.</li>
<li>
<strong>Too large</strong>: Reduces the accuracy of the approximation.</li>
</ul>
<p>A common heuristic is to set <span class="math inline">\(h = 10^{-5}\)</span> or a small fraction of the standard deviation of <span class="math inline">\(X\)</span>.</p>
<hr>
<p><strong>Comparison of Analytical and Numerical Methods</strong></p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<caption>Numerical derivatives are often preferred in empirical applications, especially when working with <strong>complex models or machine learning algorithms</strong>.</caption>
<colgroup>
<col width="41%">
<col width="26%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Advantages</th>
<th>Disadvantages</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="sec-marginal-effects.html#sec-analytical-derivation-of-marginal-effects"><strong>Analytical</strong></a></td>
<td>Provides exact expressions</td>
<td>Requires differentiability, not always feasible</td>
</tr>
<tr class="even">
<td><a href="sec-marginal-effects.html#sec-numerical-approximation-of-marginal-effects"><strong>Numerical</strong></a></td>
<td>Works for any function, easy to implement</td>
<td>Requires careful choice of step size <span class="math inline">\(h\)</span>
</td>
</tr>
</tbody>
</table></div>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="13%">
<col width="42%">
<col width="44%">
</colgroup>
<thead><tr class="header">
<th></th>
<th><a href="sec-marginal-effects.html#sec-analytical-derivation-of-marginal-effects">Analytical Derivation</a></th>
<th><a href="sec-marginal-effects.html#sec-numerical-approximation-of-marginal-effects">Numerical Approximation</a></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Marginal Effects</strong></td>
<td>Uses calculus (rules of differentiation)</td>
<td>Uses finite differences to approximate derivatives</td>
</tr>
<tr class="even">
<td><strong>Standard Errors</strong></td>
<td>Derived using variance rules</td>
<td>Estimated via the delta method using the variance-covariance matrix</td>
</tr>
</tbody>
</table></div>
<hr>
</div>
</div>
</div>
<div id="marginal-effects-in-different-contexts" class="section level2" number="17.2">
<h2>
<span class="header-section-number">17.2</span> Marginal Effects in Different Contexts<a class="anchor" aria-label="anchor" href="#marginal-effects-in-different-contexts"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li><strong>Linear Regression Models</strong></li>
</ol>
<p>For a simple linear regression:</p>
<p><span class="math display">\[
E[Y|X] = \beta_0 + \beta_1 X,
\]</span></p>
<p>the marginal effect is <strong>constant</strong> and equal to <span class="math inline">\(\beta_1\)</span>. This makes interpretation straightforward.</p>
<ol start="2" style="list-style-type: decimal">
<li><strong>Logit and Probit Models</strong></li>
</ol>
<p>In logistic regression, the expected value of <span class="math inline">\(Y\)</span> is modeled as:</p>
<p><span class="math display">\[
E[Y|X] = P(Y=1|X) = \frac{1}{1 + e^{-\beta_0 - \beta_1 X}}.
\]</span></p>
<p>The marginal effect is given by:</p>
<p><span class="math display">\[
\frac{\partial E[Y|X]}{\partial X} = \beta_1 P(Y=1|X) (1 - P(Y=1|X)).
\]</span></p>
<p>Unlike linear models, the effect <strong>varies with</strong> <span class="math inline">\(X\)</span>, requiring evaluation at specific values (e.g., means or percentiles).</p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Interaction Effects and Nonlinear Terms</strong></li>
</ol>
<p>When models include interactions (e.g., <span class="math inline">\(X_1 X_2\)</span>) or transformations (e.g., <span class="math inline">\(\log(X)\)</span>), marginal effects become more complex. For example, in:</p>
<p><span class="math display">\[
E[Y|X] = \beta_0 + \beta_1 X + \beta_2 X^2,
\]</span></p>
<p>the marginal effect of <span class="math inline">\(X\)</span> is:</p>
<p><span class="math display">\[
\frac{\partial E[Y|X]}{\partial X} = \beta_1 + 2\beta_2 X.
\]</span></p>
<p>This means the marginal effect <strong>depends on the value of</strong> <span class="math inline">\(X\)</span>.</p>
<hr>
</div>
<div id="marginal-effects-interpretation" class="section level2" number="17.3">
<h2>
<span class="header-section-number">17.3</span> Marginal Effects Interpretation<a class="anchor" aria-label="anchor" href="#marginal-effects-interpretation"><i class="fas fa-link"></i></a>
</h2>
<p>The interpretation of marginal effects differs depending on whether <span class="math inline">\(X\)</span> is continuous or discrete:</p>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="14%">
<col width="85%">
</colgroup>
<thead><tr class="header">
<th>Variable Type</th>
<th>Definition of Marginal Effect</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Continuous</strong></td>
<td>The derivative <span class="math inline">\(\frac{\partial E[Y|X]}{\partial X}\)</span> represents an <strong>infinitesimal</strong> change in <span class="math inline">\(X\)</span>.</td>
</tr>
<tr class="even">
<td><strong>Discrete</strong></td>
<td>The change in <span class="math inline">\(E[Y|X]\)</span> when <span class="math inline">\(X\)</span> increases by one unit (also called an <strong>incremental effect</strong>).</td>
</tr>
</tbody>
</table></div>
<p>For example, in a <strong>binary variable case</strong> (e.g., a dummy variable for gender), the marginal effect is:</p>
<p><span class="math display">\[
E[Y|X=1] - E[Y|X=0].
\]</span></p>
<p>which quantifies the expected change in <span class="math inline">\(Y\)</span> when switching from <span class="math inline">\(X = 0\)</span> to <span class="math inline">\(X = 1\)</span>.</p>
<hr>
</div>
<div id="sec-delta-method" class="section level2" number="17.4">
<h2>
<span class="header-section-number">17.4</span> Delta Method<a class="anchor" aria-label="anchor" href="#sec-delta-method"><i class="fas fa-link"></i></a>
</h2>
<p>The <a href="sec-marginal-effects.html#sec-delta-method">Delta Method</a> is a statistical technique for approximating the <strong>mean and variance</strong> of a function of random variables. It is particularly useful in regression analysis when estimating the standard errors of <strong>nonlinear functions</strong> of estimated coefficients, such as:</p>
<ul>
<li>
<strong>Marginal effects in nonlinear models</strong> (e.g., logistic regression)</li>
<li>
<strong>Elasticities and risk measures</strong> (e.g., in finance)</li>
<li>
<strong>Transformation of regression coefficients</strong> (e.g., log transformations)</li>
</ul>
<p>This method is based on a first-order <a href="prerequisites.html#taylor-series">Taylor Series</a> approximation, which allows us to estimate the variance of a transformed parameter without requiring explicit distributional assumptions.</p>
<hr>
<p>Let <span class="math inline">\(G(\beta)\)</span> be a function of the estimated parameters <span class="math inline">\(\beta\)</span>, where <span class="math inline">\(\beta\)</span> follows an asymptotically normal distribution:</p>
<p><span class="math display">\[
\beta \sim N(\hat{\beta}, \text{Var}(\hat{\beta})).
\]</span></p>
<p>Using a <strong>first-order Taylor expansion</strong>, we approximate <span class="math inline">\(G(\beta)\)</span> around its expectation:</p>
<p><span class="math display">\[
G(\beta) \approx G(\hat{\beta}) + \nabla G(\beta) (\beta - \hat{\beta}),
\]</span></p>
<p>where <span class="math inline">\(\nabla G(\beta)\)</span> is the gradient (also known as the <strong>Jacobian</strong>) of <span class="math inline">\(G(\beta)\)</span>, i.e., the vector of partial derivatives:</p>
<p><span class="math display">\[
\nabla G(\beta) = \left( \frac{\partial G}{\partial \beta_1}, \frac{\partial G}{\partial \beta_2}, \dots, \frac{\partial G}{\partial \beta_k} \right).
\]</span></p>
<p>The variance of <span class="math inline">\(G(\beta)\)</span> is then approximated as:</p>
<p><span class="math display">\[
\text{Var}(G(\beta)) \approx \nabla G(\beta) \, \text{Cov}(\beta) \, \nabla G(\beta)'.
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\nabla G(\beta)\)</span> is the gradient vector of <span class="math inline">\(G(\beta)\)</span>.</p></li>
<li><p><span class="math inline">\(\text{Cov}(\beta)\)</span> is the variance-covariance matrix of <span class="math inline">\(\hat{\beta}\)</span>.</p></li>
<li><p>The expression <span class="math inline">\(\nabla G(\beta)'\)</span> denotes the transpose of the gradient.</p></li>
</ul>
<p><strong>Key Properties of the Delta Method</strong></p>
<ul>
<li>
<strong>Semi-parametric approach</strong>: It does not require full knowledge of the distribution of <span class="math inline">\(G(\beta)\)</span>.</li>
<li>
<strong>Widely applicable</strong>: Useful for computing standard errors in regression models.</li>
<li>
<strong>Alternative approaches</strong>:
<ul>
<li>
<strong>Analytical derivation</strong>: Directly deriving a probability function for the margin.</li>
<li>
<strong>Simulation/Bootstrapping</strong>: Using Monte Carlo methods to approximate standard errors.</li>
</ul>
</li>
</ul>
</div>
<div id="comparison-delta-method-vs.-alternative-approaches" class="section level2" number="17.5">
<h2>
<span class="header-section-number">17.5</span> Comparison: Delta Method vs. Alternative Approaches<a class="anchor" aria-label="anchor" href="#comparison-delta-method-vs.-alternative-approaches"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="36%">
<col width="25%">
<col width="16%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Description</th>
<th>Pros</th>
<th>Cons</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="sec-marginal-effects.html#sec-delta-method"><strong>Delta Method</strong></a></td>
<td>Uses Taylor expansion to approximate variance</td>
<td>Computationally efficient</td>
<td>Accuracy depends on linearity assumption</td>
</tr>
<tr class="even">
<td><a href="sec-marginal-effects.html#sec-analytical-derivation-of-marginal-effects"><strong>Analytical Derivation</strong></a></td>
<td>Directly derives probability function</td>
<td>Exact solution (if feasible)</td>
<td>Can be mathematically complex</td>
</tr>
<tr class="odd">
<td><strong>Simulation/Bootstrapping</strong></td>
<td>Uses repeated sampling from estimated distribution</td>
<td>No assumptions on functional form</td>
<td>Computationally expensive</td>
</tr>
</tbody>
</table></div>
<p>When to Use the Delta Method:</p>
<ul>
<li><p>When you need a <strong>quick approximation</strong> for standard errors.</p></li>
<li><p>When the function <span class="math inline">\(G(\beta)\)</span> is <strong>smooth and differentiable</strong>.</p></li>
<li><p>When working with <strong>large sample sizes</strong>, where asymptotic normality holds.</p></li>
</ul>
<p>For deeper exploration, refer to these excellent resources:</p>
<ul>
<li><p><strong>Advanced</strong>: <a href="https://cran.r-project.org/web/packages/modmarg/vignettes/delta-method.html">modmarg package documentation</a> – covers implementation of the Delta Method in R.</p></li>
<li><p><strong>Intermediate</strong>: <a href="https://stats.oarc.ucla.edu/r/faq/how-can-i-estimate-the-standard-error-of-transformed-regression-parameters-in-r-using-the-delta-method/">UCLA Statistical Consulting</a> – a practical FAQ on the Delta Method.</p></li>
</ul>
<hr>
<div id="example-applying-the-delta-method-in-a-logistic-regression" class="section level3" number="17.5.1">
<h3>
<span class="header-section-number">17.5.1</span> Example: Applying the Delta Method in a logistic regression<a class="anchor" aria-label="anchor" href="#example-applying-the-delta-method-in-a-logistic-regression"><i class="fas fa-link"></i></a>
</h3>
<p>To illustrate, let’s apply the <strong>Delta Method</strong> to compute the standard error of a nonlinear transformation of regression coefficients.</p>
<p>In logistic regression, the estimated coefficient <span class="math inline">\(\hat{\beta}\)</span> represents the <strong>log-odds</strong> change for a one-unit increase in <span class="math inline">\(X\)</span>. However, we often want the <strong>odds ratio</strong>, which is:</p>
<p><span class="math display">\[
G(\beta) = e^{\beta}.
\]</span></p>
<p>By the <strong>Delta Method</strong>, the variance of <span class="math inline">\(e^{\beta}\)</span> is:</p>
<p><span class="math display">\[
\text{Var}(e^{\beta}) \approx e^{2\beta} \cdot \text{Var}(\beta).
\]</span></p>
<div class="sourceCode" id="cb579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leeper/margins">margins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/">sandwich</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>  <span class="co"># Simulate independent variable</span></span>
<span><span class="co"># Generate binary outcome using logistic model</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">X</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Logistic regression</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract coefficient and variance</span></span>
<span><span class="va">beta_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span><span class="op">[</span><span class="st">"X"</span><span class="op">]</span>   <span class="co"># Estimated coefficient</span></span>
<span><span class="va">var_beta_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html">vcov</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span><span class="op">[</span><span class="st">"X"</span>, <span class="st">"X"</span><span class="op">]</span>  <span class="co"># Variance of beta_hat</span></span>
<span></span>
<span><span class="co"># Apply Delta Method</span></span>
<span><span class="va">odds_ratio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">beta_hat</span><span class="op">)</span>  <span class="co"># Transform beta to odds ratio</span></span>
<span><span class="va">se_odds_ratio</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">odds_ratio</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">var_beta_hat</span><span class="op">)</span>  <span class="co"># Delta Method SE</span></span>
<span></span>
<span><span class="co"># Compute 95% Confidence Interval</span></span>
<span><span class="va">lower_CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">beta_hat</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_beta_hat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">upper_CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">beta_hat</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_beta_hat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Term <span class="op">=</span> <span class="st">"X"</span>,</span>
<span>    Odds_Ratio <span class="op">=</span> <span class="va">odds_ratio</span>,</span>
<span>    SE <span class="op">=</span> <span class="va">se_odds_ratio</span>,</span>
<span>    Lower_CI <span class="op">=</span> <span class="va">lower_CI</span>,</span>
<span>    Upper_CI <span class="op">=</span> <span class="va">upper_CI</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/print.html">print</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Term Odds_Ratio        SE Lower_CI Upper_CI</span></span>
<span><span class="co">#&gt; X    X   2.655431 0.7677799 1.506669 4.680069</span></span>
<span></span>
<span><span class="co"># ---- VISUALIZATION 1: Distribution of Simulated Odds Ratios ----</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Simulate beta estimates</span></span>
<span><span class="va">simulated_betas</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, mean <span class="op">=</span> <span class="va">beta_hat</span>, sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">var_beta_hat</span><span class="op">)</span><span class="op">)</span>  </span>
<span><span class="va">simulated_odds_ratios</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">simulated_betas</span><span class="op">)</span>  <span class="co"># Apply transformation</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Odds_Ratio <span class="op">=</span> <span class="va">simulated_odds_ratios</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Odds_Ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span></span>
<span>        color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        fill <span class="op">=</span> <span class="st">"skyblue"</span>,</span>
<span>        bins <span class="op">=</span> <span class="fl">50</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.7</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span></span>
<span>        xintercept <span class="op">=</span> <span class="va">odds_ratio</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>        linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>        linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span></span>
<span>        xintercept <span class="op">=</span> <span class="va">lower_CI</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>        linetype <span class="op">=</span> <span class="st">"dotted"</span>,</span>
<span>        linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span></span>
<span>        xintercept <span class="op">=</span> <span class="va">upper_CI</span>,</span>
<span>        color <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>        linetype <span class="op">=</span> <span class="st">"dotted"</span>,</span>
<span>        linewidth <span class="op">=</span> <span class="fl">1.2</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Distribution of Simulated Odds Ratios"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Odds Ratio"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Frequency"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="17-marginal-effect_files/figure-html/unnamed-chunk-1-1.png" width="90%" style="display: block; margin: auto;"></div>
<ul>
<li>
<p><strong>Odds Ratio Computation</strong></p>
<ul>
<li><p>The odds ratio is the exponentiated coefficient <span class="math inline">\(e^{\hat{\beta}}\)</span>, which represents the multiplicative change in the odds of <span class="math inline">\(Y = 1\)</span> for a one-unit increase in <span class="math inline">\(X\)</span>.</p></li>
<li><p>If <span class="math inline">\(\hat{\beta} = 0.8\)</span>, then <span class="math inline">\(e^{0.8} \approx 2.23\)</span>, meaning a one-unit increase in <span class="math inline">\(X\)</span> increases the odds of <span class="math inline">\(Y = 1\)</span> by <strong>123%</strong>.</p></li>
</ul>
</li>
<li>
<p><strong>Standard Error via Delta Method</strong></p>
<ul>
<li><p>Since <span class="math inline">\(\beta\)</span> follows a normal distribution, its transformation <span class="math inline">\(e^\beta\)</span> is <strong>not normally distributed</strong> but rather follows a log-normal shape.</p></li>
<li><p>The Delta Method approximates the <strong>standard error</strong> of <span class="math inline">\(e^\beta\)</span> using: <span class="math display">\[
SE(e^\beta) = \sqrt{e^{2\beta} \cdot \text{Var}(\beta)}
\]</span></p></li>
</ul>
</li>
<li>
<p><strong>Confidence Intervals</strong></p>
<ul>
<li>The confidence interval is obtained by: <span class="math display">\[
[e^{\beta - 1.96 \cdot SE}, e^{\beta + 1.96 \cdot SE}]
\]</span>
</li>
<li>This helps interpret the uncertainty around the odds ratio estimate.</li>
</ul>
</li>
<li>
<p><strong>Visualization</strong></p>
<ul>
<li>
<p>The <strong>histogram of simulated odds ratios</strong> shows how the transformation affects variance:</p>
<ul>
<li><p>The <strong>red dashed line</strong> represents the estimated odds ratio.</p></li>
<li><p>The <strong>blue dotted lines</strong> show the <strong>confidence interval bounds</strong>.</p></li>
<li><p>The <strong>right-skewed distribution</strong> reflects the non-linear transformation, meaning higher uncertainty for larger values.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="types-of-marginal-effect" class="section level2" number="17.6">
<h2>
<span class="header-section-number">17.6</span> Types of Marginal Effect<a class="anchor" aria-label="anchor" href="#types-of-marginal-effect"><i class="fas fa-link"></i></a>
</h2>
<div id="sec-average-marginal-effect" class="section level3" number="17.6.1">
<h3>
<span class="header-section-number">17.6.1</span> Average Marginal Effect<a class="anchor" aria-label="anchor" href="#sec-average-marginal-effect"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="sec-marginal-effects.html#sec-average-marginal-effect">Average Marginal Effect</a> (AME) measures the <strong>expected change in the predicted probability</strong> when an independent variable <strong>increases by a small amount</strong> while holding all other variables constant. Unlike marginal effects at the mean (MEM), AMEs average the marginal effects <strong>across all observations</strong>, providing a more representative measure.</p>
<p><strong>Applications of AMEs</strong></p>
<ul>
<li>
<strong>Marketing</strong>: How much does increasing ad spend change the probability of a customer purchase?</li>
<li>
<strong>Finance</strong>: How does an interest rate change impact the probability of loan approval?</li>
<li>
<strong>Econometrics</strong>: What is the effect of education on the probability of employment?</li>
</ul>
<p>Since nonlinear models like <strong>logit</strong> and <strong>probit</strong> do not have constant marginal effects, AMEs require <a href="sec-marginal-effects.html#sec-numerical-approximation-of-marginal-effects">numerical differentiation</a>. There are two common approaches:</p>
<ol style="list-style-type: decimal">
<li>
<a href="sec-marginal-effects.html#sec-one-sided-numerical-derivative">One-Sided Numerical Derivative</a>: Uses a small forward step <span class="math inline">\(h\)</span> to estimate the derivative.</li>
<li>
<a href="sec-marginal-effects.html#sec-two-sided-numerical-derivative">Two-Sided Numerical Derivative</a>: Takes both a forward step and a backward step to improve accuracy.</li>
</ol>
<hr>
<div id="sec-one-sided-numerical-derivative" class="section level4" number="17.6.1.1">
<h4>
<span class="header-section-number">17.6.1.1</span> One-Sided Numerical Derivative<a class="anchor" aria-label="anchor" href="#sec-one-sided-numerical-derivative"><i class="fas fa-link"></i></a>
</h4>
<p>To estimate <span class="math inline">\(\frac{\partial p(\mathbf{X},\beta)}{\partial X}\)</span> numerically:</p>
<p><strong>Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Estimate the model using logistic (or probit) regression.</li>
<li>For each observation <span class="math inline">\(i\)</span>:
<ol style="list-style-type: decimal">
<li>Compute predicted probability using the observed data: <span class="math display">\[
\hat{Y}_{i0} = p(\mathbf{X}_i, \hat{\beta}).
\]</span>
</li>
<li>Increase <span class="math inline">\(X\)</span> by a small step <span class="math inline">\(h\)</span>, where:
<ul>
<li>If <span class="math inline">\(X\)</span> is continuous, choose:<br><span class="math display">\[ h = (|\bar{X}| + 0.001) \times 0.001. \]</span>
</li>
<li>If <span class="math inline">\(X\)</span> is discrete, set <span class="math inline">\(h = 1\)</span>.</li>
</ul>
</li>
<li>Compute the new predicted probability: <span class="math display">\[
\hat{Y}_{i1} = p(\mathbf{X}_i + h, \hat{\beta}).
\]</span>
</li>
<li>Compute the numerical derivative: <span class="math display">\[
\frac{\hat{Y}_{i1} - \hat{Y}_{i0}}{h}.
\]</span>
</li>
</ol>
</li>
<li>Average across all observations: <span class="math display">\[
E\left[\frac{\hat{Y}_{i1} - \hat{Y}_{i0}}{h}\right] \approx \frac{\partial p (Y|\mathbf{X}, \beta)}{\partial X}.
\]</span>
</li>
</ol>
<div class="sourceCode" id="cb580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leeper/margins">margins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/">sandwich</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">X</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Logistic function</span></span>
<span></span>
<span><span class="co"># Logistic regression</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define step size h for continuous variable</span></span>
<span><span class="va">X_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html">mean</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span><span class="va">h</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">X_mean</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.001</span></span>
<span></span>
<span><span class="co"># Compute predicted probabilities at original X</span></span>
<span><span class="va">pred_Y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute predicted probabilities at X + h</span></span>
<span><span class="va">X_new</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">+</span> <span class="va">h</span></span>
<span><span class="va">data_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_new</span><span class="op">)</span></span>
<span><span class="va">pred_Y1</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, newdata <span class="op">=</span> <span class="va">data_new</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute marginal effects</span></span>
<span><span class="va">marginal_effects</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pred_Y1</span> <span class="op">-</span> <span class="va">pred_Y0</span><span class="op">)</span> <span class="op">/</span> <span class="va">h</span></span>
<span></span>
<span><span class="co"># Compute Average Marginal Effect (AME)</span></span>
<span><span class="va">AME_one_sided</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html">mean</a></span><span class="op">(</span><span class="va">marginal_effects</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Method <span class="op">=</span> <span class="st">"One-Sided AME"</span>, Estimate <span class="op">=</span> <span class="va">AME_one_sided</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Method  Estimate</span></span>
<span><span class="co">#&gt; 1 One-Sided AME 0.1921614</span></span></code></pre></div>
<ul>
<li><p>The AME is the average effect of <span class="math inline">\(X\)</span> on the probability of <span class="math inline">\(Y=1\)</span>.</p></li>
<li><p>Since logistic regression is nonlinear, the effect varies across observations.</p></li>
<li><p>This method assumes a small <span class="math inline">\(h\)</span> provides a good approximation.</p></li>
</ul>
</div>
<div id="sec-two-sided-numerical-derivative" class="section level4" number="17.6.1.2">
<h4>
<span class="header-section-number">17.6.1.2</span> Two-Sided Numerical Derivative<a class="anchor" aria-label="anchor" href="#sec-two-sided-numerical-derivative"><i class="fas fa-link"></i></a>
</h4>
<p>To improve accuracy, we use the <strong>two-sided derivative</strong>:</p>
<p><strong>Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li><p>Estimate the model using logistic (or probit) regression.</p></li>
<li>
<p>For each observation <span class="math inline">\(i\)</span>:</p>
<ol style="list-style-type: decimal">
<li><p>Compute the original predicted probability:<span class="math display">\[\hat{Y}_{i0} = p(\mathbf{X}_i, \hat{\beta}).\]</span></p></li>
<li>
<p>Compute the new predicted probabilities:</p>
<ul>
<li><p>Increase <span class="math inline">\(X\)</span> by <span class="math inline">\(h\)</span>:<span class="math display">\[\hat{Y}_{i1} = p(\mathbf{X}_i + h, \hat{\beta}).\]</span></p></li>
<li><p>Decrease <span class="math inline">\(X\)</span> by <span class="math inline">\(h\)</span>:<span class="math display">\[\hat{Y}_{i2} = p(\mathbf{X}_i - h, \hat{\beta}).\]</span></p></li>
</ul>
</li>
<li><p>Compute the numerical derivative: <span class="math display">\[\frac{\hat{Y}_{i1} - \hat{Y}_{i2}}{2h}.\]</span></p></li>
</ol>
</li>
<li><p>Average across all observations: <span class="math display">\[
E\left[\frac{\hat{Y}_{i1} - \hat{Y}_{i2}}{2h}\right] \approx \frac{\partial p (Y|\mathbf{X}, \beta)}{\partial X}.
\]</span></p></li>
</ol>
<div class="sourceCode" id="cb581"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute predicted probabilities at X - h</span></span>
<span><span class="va">X_new_minus</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">-</span> <span class="va">h</span></span>
<span><span class="va">data_new_minus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_new_minus</span><span class="op">)</span></span>
<span><span class="va">pred_Y2</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, newdata <span class="op">=</span> <span class="va">data_new_minus</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute two-sided marginal effects</span></span>
<span><span class="va">marginal_effects_2sided</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pred_Y1</span> <span class="op">-</span> <span class="va">pred_Y2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">h</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute Average Marginal Effect (AME) - Two-Sided</span></span>
<span><span class="va">AME_two_sided</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html">mean</a></span><span class="op">(</span><span class="va">marginal_effects_2sided</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Method <span class="op">=</span> <span class="st">"Two-Sided AME"</span>, Estimate <span class="op">=</span> <span class="va">AME_two_sided</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Method  Estimate</span></span>
<span><span class="co">#&gt; 1 Two-Sided AME 0.1921633</span></span></code></pre></div>
<p><strong>Comparison of One-Sided vs. Two-Sided AME</strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Method</th>
<th>Accuracy</th>
<th>Computational Cost</th>
<th>Bias</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>One-Sided</strong></td>
<td>Lower</td>
<td>Faster</td>
<td>Higher</td>
</tr>
<tr class="even">
<td><strong>Two-Sided</strong></td>
<td>Higher</td>
<td>Slightly Slower</td>
<td>Lower</td>
</tr>
</tbody>
</table></div>
<ul>
<li><p><strong>One-sided</strong> AME is computationally simpler but can introduce bias.</p></li>
<li><p><strong>Two-sided</strong> AME reduces bias but requires two function evaluations per observation.</p></li>
</ul>
</div>
</div>
<div id="sec-marginal-effects-at-the-mean" class="section level3" number="17.6.2">
<h3>
<span class="header-section-number">17.6.2</span> Marginal Effects at the Mean<a class="anchor" aria-label="anchor" href="#sec-marginal-effects-at-the-mean"><i class="fas fa-link"></i></a>
</h3>
<p>Marginal effects in nonlinear models are not constant, as they depend on the values of independent variables. One way to summarize them is by computing <a href="sec-marginal-effects.html#sec-marginal-effects-at-the-mean">Marginal Effects at the Mean</a> (MEM), which estimates marginal effects <strong>at the average values of the independent variables</strong>.</p>
<p>MEM is commonly used in:</p>
<ul>
<li><p><strong>Econometrics</strong>: Evaluating the effect of education on wages at the average level of experience.</p></li>
<li><p><strong>Finance</strong>: Assessing the impact of credit scores on loan approval probability for a typical applicant.</p></li>
<li><p><strong>Marketing</strong>: Estimating the effect of price on purchase probability for an average customer.</p></li>
</ul>
<p>Unlike the <a href="sec-marginal-effects.html#sec-average-marginal-effect">Average Marginal Effect</a>, which averages marginal effects over all observations, MEM computes the effect <strong>at a single point</strong>—the mean of the explanatory variables.</p>
<hr>
<p>Let <span class="math inline">\(p(\mathbf{X}, \beta)\)</span> be the predicted probability in a nonlinear model (e.g., logistic regression). The <strong>MEM</strong> is computed as:</p>
<p><span class="math display">\[
\frac{\partial p(\bar{\mathbf{X}}, \beta)}{\partial X}
\]</span></p>
<p>where <span class="math inline">\(\bar{\mathbf{X}}\)</span> is the <strong>vector of mean values</strong> of all explanatory variables.</p>
<p>For a logistic regression model:</p>
<p><span class="math display">\[
E[Y|X] = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X)}}
\]</span></p>
<p>the MEM for a continuous variable <span class="math inline">\(X\)</span> is:</p>
<p><span class="math display">\[
\frac{\partial E[Y|X]}{\partial X} \Bigg|_{X = \bar{X}} = \beta_1 \cdot p(\bar{X}) \cdot (1 - p(\bar{X})).
\]</span></p>
<p><strong>MEM vs. AME</strong></p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="7%">
<col width="32%">
<col width="31%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Description</th>
<th>Pros</th>
<th>Cons</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>MEM</strong></td>
<td>Marginal effect computed at the mean values of predictors.</td>
<td>Easy to interpret, based on a single reference point.</td>
<td>Not representative if data is skewed or nonlinear.</td>
</tr>
<tr class="even">
<td><strong>AME</strong></td>
<td>Average of marginal effects across all observations.</td>
<td>More generalizable, considers full distribution of data.</td>
<td>Computationally more expensive.</td>
</tr>
</tbody>
</table></div>
<hr>
<p><strong>Step 1: Estimate the Model</strong></p>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leeper/margins">margins</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/">sandwich</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">X</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Logistic function</span></span>
<span></span>
<span><span class="co"># Logistic regression</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Step 2: Compute Marginal Effects at the Mean</strong></p>
<div class="sourceCode" id="cb583"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute mean of X</span></span>
<span><span class="va">X_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html">mean</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute predicted probability at mean X</span></span>
<span><span class="va">p_mean</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>,</span>
<span>            newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X_mean</span><span class="op">)</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute MEM for X</span></span>
<span><span class="va">MEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span><span class="op">[</span><span class="st">"X"</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_mean</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display result</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Method <span class="op">=</span> <span class="st">"MEM"</span>, Estimate <span class="op">=</span> <span class="va">MEM</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Method  Estimate</span></span>
<span><span class="co">#&gt; X    MEM 0.2146628</span></span></code></pre></div>
<p><strong>Interpretation</strong></p>
<ul>
<li><p>The MEM tells us the effect of <span class="math inline">\(X\)</span> on the probability of <span class="math inline">\(Y=1\)</span> at the mean value of <span class="math inline">\(X\)</span>.</p></li>
<li><p>It provides a simple interpretation but may not capture the variability in marginal effects across different values of <span class="math inline">\(X\)</span>.</p></li>
</ul>
<p>A third approach is <strong>Marginal Effects at Representative Values (MER)</strong>, where we calculate marginal effects at <strong>specific percentiles</strong> (e.g., median, quartiles). Below is a comparison:</p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="7%">
<col width="36%">
<col width="27%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Description</th>
<th>Pros</th>
<th>Cons</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>MEM</strong></td>
<td>Marginal effect at mean values of predictors.</td>
<td>Simple to compute, useful if data is symmetric.</td>
<td>Not informative if mean is not representative.</td>
</tr>
<tr class="even">
<td><strong>AME</strong></td>
<td>Average of marginal effects over all observations.</td>
<td>More generalizable.</td>
<td>More computationally expensive.</td>
</tr>
<tr class="odd">
<td><strong>MER</strong></td>
<td>Marginal effect at specific values (e.g., median, percentiles).</td>
<td>Captures effects at different levels of X.</td>
<td>Requires choosing relevant reference values.</td>
</tr>
</tbody>
</table></div>
<p><strong>When to Use Each Method</strong></p>
<ul>
<li><p>Use <strong>MEM</strong> when you need a quick, interpretable summary at an “average” individual.</p></li>
<li><p>Use <strong>AME</strong> when marginal effects <strong>vary widely across individuals</strong>.</p></li>
<li><p>Use <strong>MER</strong> when you need to understand effects at <strong>specific values of interest</strong>.</p></li>
</ul>
</div>
<div id="sec-marginal-effects-at-the-average" class="section level3" number="17.6.3">
<h3>
<span class="header-section-number">17.6.3</span> Marginal Effects at the Average<a class="anchor" aria-label="anchor" href="#sec-marginal-effects-at-the-average"><i class="fas fa-link"></i></a>
</h3>
<p>Marginal effects summarize how an independent variable influences the probability of an outcome in <strong>nonlinear models</strong> (e.g., logistic regression). We have already discussed:</p>
<ul>
<li><p><a href="sec-marginal-effects.html#sec-marginal-effects-at-the-mean">Marginal Effects at the Mean</a> (MEM): Marginal effects computed at the mean values of the independent variables.</p></li>
<li><p><a href="sec-marginal-effects.html#sec-average-marginal-effect">Average Marginal Effects</a> (AME): The mean of marginal effects computed at each observation.</p></li>
</ul>
<p>A third approach is <a href="sec-marginal-effects.html#sec-marginal-effects-at-the-average">Marginal Effects at the Average</a>(MAE), where we <strong>first average the independent variables</strong> across all observations, and then compute the marginal effect at that single averaged observation.</p>
<hr>
<p>Let <span class="math inline">\(p(\mathbf{X}, \beta)\)</span> be the probability function of a model (e.g., a logistic regression). The <a href="sec-marginal-effects.html#sec-marginal-effects-at-the-average">Marginal Effect at the Average</a> is computed as:</p>
<p><span class="math display">\[
\frac{\partial p(\bar{\mathbf{X}}, \beta)}{\partial X}
\]</span></p>
<p>where <span class="math inline">\(\bar{\mathbf{X}}\)</span> is the vector of <strong>averaged independent variables across all observations</strong>.</p>
<hr>
<p><strong>Key Differences Between AME and MAE</strong></p>
<ul>
<li><p>AME answers a <strong>general</strong> question: “How does <span class="math inline">\(X\)</span> affect <span class="math inline">\(Y\)</span> across the entire dataset?”</p></li>
<li><p>MAE answers a more <strong>specific</strong> question: “How does <span class="math inline">\(X\)</span> affect <span class="math inline">\(Y\)</span> for a typical (average) person in our dataset?”</p></li>
</ul>
<p>MAE is particularly relevant when we want a single, interpretable effect for a representative individual.</p>
<p><strong>Use Cases for MAE</strong></p>
<ol style="list-style-type: decimal">
<li><p><strong>Policy &amp; Business Decision-Making</strong>: If policymakers or business leaders want to know the effect of a tax increase on a “typical” consumer, MAE gives an effect for a single representative individual.</p></li>
<li><p><strong>Marketing Campaigns</strong>: If a marketing team wants to know how much increasing ad spend affects the purchase probability of an “average” customer, MAE provides this insight.</p></li>
<li><p><strong>Simplified Reporting</strong>: AMEs vary across individuals, which can make reporting complex. MAE condenses everything into one easy-to-interpret number.</p></li>
</ol>
<hr>
<p><strong>Comparison: MAE vs. MEM vs. AME</strong></p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="6%">
<col width="39%">
<col width="21%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Definition</th>
<th>Pros</th>
<th>Cons</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>MEM</strong></td>
<td>Compute marginal effects <strong>at the mean values</strong> of <span class="math inline">\(X\)</span>.</td>
<td>Simple and interpretable.</td>
<td>Mean values may not represent actual observations.</td>
</tr>
<tr class="even">
<td><strong>AME</strong></td>
<td>Compute marginal effects <strong>for each observation</strong>, then take the average.</td>
<td>More robust, accounts for variability.</td>
<td>Computationally more expensive.</td>
</tr>
<tr class="odd">
<td><strong>MAE</strong></td>
<td>Compute probability at <strong>averaged</strong> <span class="math inline">\(X\)</span> values, then compute the marginal effect.</td>
<td>Accounts for interactions better than MEM.</td>
<td>Less commonly used, can be misleading if <span class="math inline">\(X\)</span> values are skewed.</td>
</tr>
</tbody>
</table></div>
<p><strong>Intuition Behind MAE</strong></p>
<ul>
<li>Instead of computing individual marginal effects (as in AME), MAE computes the <strong>marginal effect for a single averaged observation</strong>.</li>
<li>This method is <strong>somewhat similar to MEM</strong>, but instead of taking the mean of each independent variable separately, it <strong>first computes a single averaged observation and then derives the marginal effect at that observation</strong>.</li>
</ul>
<hr>
<p><strong>Step 1: Estimate the Model</strong></p>
<div class="sourceCode" id="cb584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leeper/margins">margins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Simulate data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>  <span class="co"># Continuous variable</span></span>
<span><span class="va">X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span>  <span class="co"># Binary variable</span></span>
<span><span class="co"># Logistic function</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">X1</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">X2</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Logistic regression</span></span>
<span><span class="va">logit_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Step 2: Compute MAE</strong></p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the average of independent variables</span></span>
<span><span class="va">X_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>X1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html">mean</a></span><span class="op">(</span><span class="va">X1</span><span class="op">)</span>, X2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mean.html">mean</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute predicted probability at averaged X</span></span>
<span><span class="va">p_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logit_model</span>, newdata <span class="op">=</span> <span class="va">X_mean</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute MAE for X1</span></span>
<span><span class="va">MAE_X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span><span class="op">[</span><span class="st">"X1"</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_mean</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute MAE for X2</span></span>
<span><span class="va">MAE_X2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logit_model</span><span class="op">)</span><span class="op">[</span><span class="st">"X2"</span><span class="op">]</span> <span class="op">*</span> <span class="va">p_mean</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p_mean</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Method <span class="op">=</span> <span class="st">"MAE"</span>,</span>
<span>    Variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span>,</span>
<span>    Estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">MAE_X1</span>, <span class="va">MAE_X2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    Method Variable    Estimate</span></span>
<span><span class="co">#&gt; X1    MAE       X1  0.20280618</span></span>
<span><span class="co">#&gt; X2    MAE       X2 -0.06286593</span></span></code></pre></div>
<ul>
<li><p>The MAE for <span class="math inline">\(X_1\)</span> represents the change in probability when increasing <span class="math inline">\(X_1\)</span> at the average values of <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>.</p></li>
<li><p>The MAE for <span class="math inline">\(X_2\)</span> (a binary variable) represents the probability change when switching from <span class="math inline">\(X_2 = 0\)</span> to <span class="math inline">\(X_2 = 1\)</span>, holding all other variables at their average.</p></li>
</ul>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="7%">
<col width="26%">
<col width="17%">
<col width="46%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Computes Marginal Effect...</th>
<th>Accounts for Variability?</th>
<th>Best for...</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>MEM</strong></td>
<td>At the mean of each independent variable.</td>
<td>No</td>
<td>
<p>Quick interpretation at a reference point.</p>
<p>When individual means are meaningful (e.g., symmetric data).</p>
</td>
</tr>
<tr class="even">
<td><strong>AME</strong></td>
<td>At each observation, then averages.</td>
<td>Yes</td>
<td>Generalizable results.</td>
</tr>
<tr class="odd">
<td><strong>MAE</strong></td>
<td>At a single averaged observation.</td>
<td>No</td>
<td>
<p>Simple summary when interactions exist.</p>
<p>When we need a single interpretable summary that accounts for interactions</p>
</td>
</tr>
</tbody>
</table></div>
<p><strong>When to Use MAE</strong></p>
<ul>
<li><p>When you want a single number summary that reflects a realistic scenario.</p></li>
<li><p>When there are interaction effects, and you want to account for the joint impact of predictors.</p></li>
<li><p>However, if predictor distributions are skewed, AME is usually preferred.</p></li>
</ul>
</div>
</div>
<div id="packages-for-marginal-effects" class="section level2" number="17.7">
<h2>
<span class="header-section-number">17.7</span> Packages for Marginal Effects<a class="anchor" aria-label="anchor" href="#packages-for-marginal-effects"><i class="fas fa-link"></i></a>
</h2>
<p>Several R packages compute <strong>marginal effects</strong> for regression models, each with different features and functionalities. The primary packages include:</p>
<ol style="list-style-type: decimal">
<li>
<strong><code>marginaleffects</code></strong> – A modern, flexible, and efficient package.</li>
<li>
<strong><code>margins</code></strong> – A widely used package for replicating Stata’s <code>margins</code> command.</li>
<li>
<strong><code>mfx</code></strong> – A package tailored for Generalized Linear Models (<code>glm</code>).</li>
</ol>
<p>These tools help analyze how small changes in explanatory variables impact the dependent variable.</p>
<hr>
<div id="marginaleffects-package-recommended" class="section level3" number="17.7.1">
<h3>
<span class="header-section-number">17.7.1</span> <code>marginaleffects</code> Package (Recommended)<a class="anchor" aria-label="anchor" href="#marginaleffects-package-recommended"><i class="fas fa-link"></i></a>
</h3>
<p>The <strong><code>marginaleffects</code></strong> package is the successor to <code>margins</code> and <code>emtrends</code>, offering a faster, more efficient, and more flexible approach to estimating marginal effects.</p>
<p><strong>Why Use <code>marginaleffects</code>?</strong></p>
<ul>
<li><p>Supports interaction effects and complex models</p></li>
<li><p>Computes marginal effects, marginal means, and counterfactuals</p></li>
<li><p>Integrates well with ggplot2 for visualization</p></li>
<li><p>Works with many model types (linear, logistic, Poisson, etc.)</p></li>
</ul>
<p><strong>Limitation</strong>:</p>
<ul>
<li>No built-in function for <strong>multiple comparisons correction</strong>, but you can use <code><a href="https://rdrr.io/r/stats/p.adjust.html">p.adjust()</a></code> for adjustment.</li>
</ul>
<p><strong>Key Definitions</strong></p>
<ul>
<li>
<strong>Marginal Effects</strong>: The partial derivative (slope) of the outcome with respect to each variable.
<ul>
<li>
<code>margins</code> package defines marginal effects as “partial derivatives of the regression equation with respect to each variable in the model for each unit in the data.”</li>
</ul>
</li>
<li>
<strong>Marginal Means</strong>: The expected outcome averaged over a grid of predictor values.</li>
</ul>
<p><strong>Computing Predictions and Marginal Effects</strong></p>
<div class="sourceCode" id="cb586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/">marginaleffects</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Fit a regression model with interaction terms</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="va">wt</span> <span class="op">*</span> <span class="va">am</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get predicted values</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/r/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Estimate Std. Error    z Pr(&gt;|z|)     S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;      22.5      0.884 25.4   &lt;0.001 471.7  20.8   24.2</span></span>
<span><span class="co">#&gt;      20.8      1.194 17.4   &lt;0.001 223.3  18.5   23.1</span></span>
<span><span class="co">#&gt;      25.3      0.709 35.7   &lt;0.001 922.7  23.9   26.7</span></span>
<span><span class="co">#&gt;      20.3      0.704 28.8   &lt;0.001 601.5  18.9   21.6</span></span>
<span><span class="co">#&gt;      17.0      0.712 23.9   &lt;0.001 416.2  15.6   18.4</span></span>
<span><span class="co">#&gt;      19.7      0.875 22.5   &lt;0.001 368.8  17.9   21.4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Columns: rowid, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, mpg, hp, wt, am </span></span>
<span><span class="co">#&gt; Type:  response</span></span>
<span></span>
<span><span class="co"># Create a reference grid for prediction</span></span>
<span><span class="va">newdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marginaleffects.com/man/r/datagrid.html">datagrid</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                    wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                    model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot predictions for 'hp' and 'wt'</span></span>
<span><span class="fu">marginaleffects</span><span class="fu">::</span><span class="fu"><a href="https://marginaleffects.com/man/r/plot_predictions.html">plot_predictions</a></span><span class="op">(</span><span class="va">mod</span>, </span>
<span>                                  newdata <span class="op">=</span> <span class="va">newdata</span>, </span>
<span>                                  condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="17-marginal-effect_files/figure-html/unnamed-chunk-8-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Computing Marginal Effects</p>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute Average Marginal Effects (AME)</span></span>
<span><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu">marginaleffects</span><span class="fu">::</span><span class="fu"><a href="https://marginaleffects.com/man/r/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"hp"</span>, <span class="st">"wt"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Estimate Std. Error     z Pr(&gt;|z|)   S   2.5 %    97.5 %</span></span>
<span><span class="co">#&gt;    hp  -0.0369     0.0185 -1.99  0.04605 4.4 -0.0732 -0.000648</span></span>
<span><span class="co">#&gt;    hp  -0.0287     0.0156 -1.84  0.06626 3.9 -0.0593  0.001926</span></span>
<span><span class="co">#&gt;    hp  -0.0466     0.0226 -2.06  0.03926 4.7 -0.0909 -0.002293</span></span>
<span><span class="co">#&gt;    hp  -0.0423     0.0133 -3.18  0.00146 9.4 -0.0683 -0.016232</span></span>
<span><span class="co">#&gt;    hp  -0.0390     0.0134 -2.91  0.00363 8.1 -0.0653 -0.012730</span></span>
<span><span class="co">#&gt;    hp  -0.0387     0.0135 -2.87  0.00409 7.9 -0.0652 -0.012289</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Columns: rowid, term, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, mpg, hp, wt, am </span></span>
<span><span class="co">#&gt; Type:  response</span></span>
<span></span>
<span><span class="co"># Compute Group-Average Marginal Effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu">marginaleffects</span><span class="fu">::</span><span class="fu"><a href="https://marginaleffects.com/man/r/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"hp"</span>, variables <span class="op">=</span> <span class="st">"am"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term          Contrast hp Estimate Std. Error      z Pr(&gt;|z|)   S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;    am mean(1) - mean(0) 52     3.98       5.20  0.764    0.445 1.2 -6.22  14.18</span></span>
<span><span class="co">#&gt;    am mean(1) - mean(0) 62    -2.77       2.51 -1.107    0.268 1.9 -7.68   2.14</span></span>
<span><span class="co">#&gt;    am mean(1) - mean(0) 65     3.00       4.13  0.725    0.468 1.1 -5.10  11.10</span></span>
<span><span class="co">#&gt;    am mean(1) - mean(0) 66     2.03       3.48  0.582    0.561 0.8 -4.80   8.85</span></span>
<span><span class="co">#&gt;    am mean(1) - mean(0) 91     1.86       2.76  0.674    0.500 1.0 -3.54   7.26</span></span>
<span><span class="co">#&gt;    am mean(1) - mean(0) 93     1.20       2.35  0.511    0.609 0.7 -3.40   5.80</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Columns: term, contrast, hp, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted </span></span>
<span><span class="co">#&gt; Type:  response</span></span>
<span></span>
<span><span class="co"># Marginal Effects at Representative Values (MER)</span></span>
<span><span class="fu">marginaleffects</span><span class="fu">::</span><span class="fu"><a href="https://marginaleffects.com/man/r/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://marginaleffects.com/man/r/datagrid.html">datagrid</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span>, wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast am wt Estimate Std. Error      z Pr(&gt;|z|)   S   2.5 %   97.5 %</span></span>
<span><span class="co">#&gt;    am    1 - 0  0  2   2.5465     2.7860  0.914   0.3607 1.5 -2.9139  8.00694</span></span>
<span><span class="co">#&gt;    am    1 - 0  0  4  -2.9661     3.0381 -0.976   0.3289 1.6 -8.9207  2.98852</span></span>
<span><span class="co">#&gt;    hp    dY/dX  0  2  -0.0598     0.0283 -2.115   0.0344 4.9 -0.1153 -0.00439</span></span>
<span><span class="co">#&gt;    hp    dY/dX  0  4  -0.0309     0.0187 -1.654   0.0981 3.4 -0.0676  0.00571</span></span>
<span><span class="co">#&gt;    wt    dY/dX  0  2  -2.6762     1.4199 -1.885   0.0595 4.1 -5.4591  0.10676</span></span>
<span><span class="co">#&gt;    wt    dY/dX  0  4  -2.6762     1.4206 -1.884   0.0596 4.1 -5.4605  0.10816</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, am, wt, predicted_lo, predicted_hi, predicted, hp, mpg </span></span>
<span><span class="co">#&gt; Type:  response</span></span>
<span></span>
<span><span class="co"># Marginal Effects at the Mean (MEM)</span></span>
<span><span class="fu">marginaleffects</span><span class="fu">::</span><span class="fu"><a href="https://marginaleffects.com/man/r/slopes.html">slopes</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast Estimate Std. Error      z Pr(&gt;|z|)   S   2.5 %  97.5 %</span></span>
<span><span class="co">#&gt;    am    1 - 0  -0.8086     1.5238 -0.531  0.59568 0.7 -3.7952  2.1781</span></span>
<span><span class="co">#&gt;    hp    dY/dX  -0.0422     0.0133 -3.181  0.00147 9.4 -0.0683 -0.0162</span></span>
<span><span class="co">#&gt;    wt    dY/dX  -2.6762     1.4193 -1.886  0.05935 4.1 -5.4579  0.1055</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, hp, wt, am, mpg </span></span>
<span><span class="co">#&gt; Type:  response</span></span></code></pre></div>
<p>Counterfactual Comparisons</p>
<div class="sourceCode" id="cb588"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Counterfactual comparison: Effect of changing 'am' from 0 to 1</span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/r/comparisons.html">comparisons</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Term Contrast Estimate Std. Error      z Pr(&gt;|z|)   S 2.5 % 97.5 %</span></span>
<span><span class="co">#&gt;    am    1 - 0    0.325       1.68  0.193    0.847 0.2 -2.97   3.62</span></span>
<span><span class="co">#&gt;    am    1 - 0   -0.544       1.57 -0.347    0.729 0.5 -3.62   2.53</span></span>
<span><span class="co">#&gt;    am    1 - 0    1.201       2.35  0.511    0.609 0.7 -3.40   5.80</span></span>
<span><span class="co">#&gt;    am    1 - 0   -1.703       1.87 -0.912    0.362 1.5 -5.36   1.96</span></span>
<span><span class="co">#&gt;    am    1 - 0   -0.615       1.68 -0.366    0.715 0.5 -3.91   2.68</span></span>
<span><span class="co">#&gt; --- 22 rows omitted. See ?avg_comparisons and ?print.marginaleffects --- </span></span>
<span><span class="co">#&gt;    am    1 - 0    4.081       3.94  1.037    0.300 1.7 -3.63  11.79</span></span>
<span><span class="co">#&gt;    am    1 - 0    2.106       2.29  0.920    0.358 1.5 -2.38   6.59</span></span>
<span><span class="co">#&gt;    am    1 - 0    0.895       1.64  0.544    0.586 0.8 -2.33   4.12</span></span>
<span><span class="co">#&gt;    am    1 - 0    4.027       3.24  1.243    0.214 2.2 -2.32  10.38</span></span>
<span><span class="co">#&gt;    am    1 - 0   -0.237       1.59 -0.149    0.881 0.2 -3.35   2.87</span></span>
<span><span class="co">#&gt; Columns: rowid, term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted, mpg, hp, wt, am </span></span>
<span><span class="co">#&gt; Type:  response</span></span></code></pre></div>
</div>
<div id="margins-package" class="section level3" number="17.7.2">
<h3>
<span class="header-section-number">17.7.2</span> <code>margins</code> Package<a class="anchor" aria-label="anchor" href="#margins-package"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>margins</code> package is a popular choice, designed to replicate Stata’s <code>margins</code> command in R. It provides marginal effects for each variable in a model, including interaction terms. <code>margins</code> define:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Average Partial Effects:</strong> The contribution of each variable to the outcome scale, conditional on the other variables involved in the link function transformation of the linear predictor.</li>
<li>
<strong>Average Marginal Effects:</strong> The marginal contribution of each variable on the scale of the linear predictor.</li>
<li>Average marginal effects represent the mean of these unit-specific partial derivatives over a given sample.</li>
</ol>
<p><strong>Key Features</strong></p>
<ul>
<li><p>Computes Average Partial Effects (APE).</p></li>
<li><p>Supports Marginal Effects at the Mean (MEM).</p></li>
<li><p>Provides visualizations of marginal effects.</p></li>
</ul>
<p><strong>Limitation</strong>:</p>
<ul>
<li>Slower than <code>marginaleffects</code>, especially with large datasets.</li>
</ul>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/leeper/margins">margins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit a linear model with interactions</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">cyl</span> <span class="op">*</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">wt</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute marginal effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/margins/man/margins.html">margins</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  factor     AME     SE       z      p   lower   upper</span></span>
<span><span class="co">#&gt;     cyl  0.0381 0.5999  0.0636 0.9493 -1.1376  1.2139</span></span>
<span><span class="co">#&gt;      hp -0.0463 0.0145 -3.1909 0.0014 -0.0748 -0.0179</span></span>
<span><span class="co">#&gt;      wt -3.1198 0.6613 -4.7175 0.0000 -4.4160 -1.8236</span></span>
<span></span>
<span><span class="co"># Equivalent function for summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/margins/man/margins.html">margins_summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;  factor     AME     SE       z      p   lower   upper</span></span>
<span><span class="co">#&gt;     cyl  0.0381 0.5999  0.0636 0.9493 -1.1376  1.2139</span></span>
<span><span class="co">#&gt;      hp -0.0463 0.0145 -3.1909 0.0014 -0.0748 -0.0179</span></span>
<span><span class="co">#&gt;      wt -3.1198 0.6613 -4.7175 0.0000 -4.4160 -1.8236</span></span>
<span></span>
<span><span class="co"># Plot marginal effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/margins/man/margins.html">margins</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="17-marginal-effect_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Marginal Effects at Representative Values</p>
<div class="sourceCode" id="cb590"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute marginal effects when 'hp' = 150</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/margins/man/margins.html">margins</a></span><span class="op">(</span><span class="va">mod</span>, at <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  factor       hp     AME     SE       z      p   lower   upper</span></span>
<span><span class="co">#&gt;     cyl 150.0000  0.1009 0.6128  0.1647 0.8692 -1.1001  1.3019</span></span>
<span><span class="co">#&gt;      hp 150.0000 -0.0463 0.0145 -3.1909 0.0014 -0.0748 -0.0179</span></span>
<span><span class="co">#&gt;      wt 150.0000 -3.1198 0.6613 -4.7175 0.0000 -4.4160 -1.8236</span></span></code></pre></div>
</div>
<div id="mfx-package" class="section level3" number="17.7.3">
<h3>
<span class="header-section-number">17.7.3</span> <code>mfx</code> Package<a class="anchor" aria-label="anchor" href="#mfx-package"><i class="fas fa-link"></i></a>
</h3>
<p>The <strong><code>mfx</code></strong> package is specialized for GLMs, computing marginal effects for probit, logit, Poisson, and other count models.</p>
<p><strong>Limitation</strong>:</p>
<ul>
<li>Computes only marginal effects for each variable, not the average marginal effect.</li>
</ul>
<p><strong>Supported Models in <code>mfx</code></strong></p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>Model</th>
<th>Outcome Type</th>
<th>Function</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Probit</strong></td>
<td>Binary</td>
<td><code><a href="https://rdrr.io/pkg/mfx/man/probitmfx.html">probitmfx()</a></code></td>
</tr>
<tr class="even">
<td><strong>Logit</strong></td>
<td>Binary</td>
<td><code><a href="https://rdrr.io/pkg/mfx/man/logitmfx.html">logitmfx()</a></code></td>
</tr>
<tr class="odd">
<td><strong>Poisson</strong></td>
<td>Count</td>
<td><code><a href="https://rdrr.io/pkg/mfx/man/poissonmfx.html">poissonmfx()</a></code></td>
</tr>
<tr class="even">
<td><strong>Negative Binomial</strong></td>
<td>Count</td>
<td><code><a href="https://rdrr.io/pkg/mfx/man/negbinmfx.html">negbinmfx()</a></code></td>
</tr>
<tr class="odd">
<td><strong>Beta</strong></td>
<td>Rate</td>
<td><code><a href="https://rdrr.io/pkg/mfx/man/betamfx.html">betamfx()</a></code></td>
</tr>
</tbody>
</table></div>
<p><strong>Example: Poisson Regression</strong></p>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit a Poisson model and compute marginal effects</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/mfx/man/poissonmfx.html">poissonmfx</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">vs</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">*</span> <span class="va">cyl</span> <span class="op">*</span> <span class="va">disp</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; poissonmfx(formula = vs ~ mpg * cyl * disp, data = mtcars)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Marginal Effects:</span></span>
<span><span class="co">#&gt;                    dF/dx   Std. Err.       z  P&gt;|z|</span></span>
<span><span class="co">#&gt; mpg           1.4722e-03  8.7531e-03  0.1682 0.8664</span></span>
<span><span class="co">#&gt; cyl           6.6420e-03  3.9263e-02  0.1692 0.8657</span></span>
<span><span class="co">#&gt; disp          1.5899e-04  9.4555e-04  0.1681 0.8665</span></span>
<span><span class="co">#&gt; mpg:cyl      -3.4698e-04  2.0564e-03 -0.1687 0.8660</span></span>
<span><span class="co">#&gt; mpg:disp     -7.6794e-06  4.5545e-05 -0.1686 0.8661</span></span>
<span><span class="co">#&gt; cyl:disp     -3.3837e-05  1.9919e-04 -0.1699 0.8651</span></span>
<span><span class="co">#&gt; mpg:cyl:disp  1.6812e-06  9.8919e-06  0.1700 0.8650</span></span></code></pre></div>
<p>For more details, see the <a href="https://cran.rstudio.com/web/packages/mfx/vignettes/mfxarticle.pdf"><code>mfx</code> vignette</a>.</p>
</div>
<div id="comparison-of-packages" class="section level3" number="17.7.4">
<h3>
<span class="header-section-number">17.7.4</span> Comparison of Packages<a class="anchor" aria-label="anchor" href="#comparison-of-packages"><i class="fas fa-link"></i></a>
</h3>
<div class="inline-table"><table style="width:98%;" class="table table-sm">
<colgroup>
<col width="26%">
<col width="31%">
<col width="14%">
<col width="26%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>
<code>marginaleffects</code> ✅ (Recommended)</th>
<th><code>margins</code></th>
<th><code>mfx</code></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Computes AME</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
<td>❌ No</td>
</tr>
<tr class="even">
<td><strong>Computes MEM</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
<td>❌ No</td>
</tr>
<tr class="odd">
<td><strong>Computes MER</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
<td>❌ No</td>
</tr>
<tr class="even">
<td><strong>Supports GLM Models</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
<td>✅ Yes (but limited to <code>glm</code>)</td>
</tr>
<tr class="odd">
<td><strong>Works with Interactions</strong></td>
<td>✅ Yes</td>
<td>✅ Yes</td>
<td>❌ No</td>
</tr>
<tr class="even">
<td><strong>Fast and Efficient</strong></td>
<td>✅ Yes</td>
<td>❌ No (slower)</td>
<td>✅ Yes (for GLMs)</td>
</tr>
<tr class="odd">
<td><strong>Supports Counterfactuals</strong></td>
<td>✅ Yes</td>
<td>❌ No</td>
<td>❌ No</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="hypothesis-testing.html"><span class="header-section-number">16</span> Hypothesis Testing</a></div>
<div class="next"><a href="moderation.html"><span class="header-section-number">18</span> Moderation</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#sec-marginal-effects"><span class="header-section-number">17</span> Marginal Effects</a></li>
<li>
<a class="nav-link" href="#definition-of-marginal-effects"><span class="header-section-number">17.1</span> Definition of Marginal Effects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sec-analytical-derivation-of-marginal-effects"><span class="header-section-number">17.1.1</span> Analytical Derivation of Marginal Effects</a></li>
<li><a class="nav-link" href="#sec-numerical-approximation-of-marginal-effects"><span class="header-section-number">17.1.2</span> Numerical Approximation of Marginal Effects</a></li>
</ul>
</li>
<li><a class="nav-link" href="#marginal-effects-in-different-contexts"><span class="header-section-number">17.2</span> Marginal Effects in Different Contexts</a></li>
<li><a class="nav-link" href="#marginal-effects-interpretation"><span class="header-section-number">17.3</span> Marginal Effects Interpretation</a></li>
<li><a class="nav-link" href="#sec-delta-method"><span class="header-section-number">17.4</span> Delta Method</a></li>
<li>
<a class="nav-link" href="#comparison-delta-method-vs.-alternative-approaches"><span class="header-section-number">17.5</span> Comparison: Delta Method vs. Alternative Approaches</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#example-applying-the-delta-method-in-a-logistic-regression"><span class="header-section-number">17.5.1</span> Example: Applying the Delta Method in a logistic regression</a></li></ul>
</li>
<li>
<a class="nav-link" href="#types-of-marginal-effect"><span class="header-section-number">17.6</span> Types of Marginal Effect</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sec-average-marginal-effect"><span class="header-section-number">17.6.1</span> Average Marginal Effect</a></li>
<li><a class="nav-link" href="#sec-marginal-effects-at-the-mean"><span class="header-section-number">17.6.2</span> Marginal Effects at the Mean</a></li>
<li><a class="nav-link" href="#sec-marginal-effects-at-the-average"><span class="header-section-number">17.6.3</span> Marginal Effects at the Average</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#packages-for-marginal-effects"><span class="header-section-number">17.7</span> Packages for Marginal Effects</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#marginaleffects-package-recommended"><span class="header-section-number">17.7.1</span> marginaleffects Package (Recommended)</a></li>
<li><a class="nav-link" href="#margins-package"><span class="header-section-number">17.7.2</span> margins Package</a></li>
<li><a class="nav-link" href="#mfx-package"><span class="header-section-number">17.7.3</span> mfx Package</a></li>
<li><a class="nav-link" href="#comparison-of-packages"><span class="header-section-number">17.7.4</span> Comparison of Packages</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mikenguyen13/data_analysis/blob/main/17-marginal-effect.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mikenguyen13/data_analysis/edit/main/17-marginal-effect.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide on Data Analysis</strong>" was written by Mike Nguyen. It was last built on 2025-03-03.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
