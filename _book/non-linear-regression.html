<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Non-Linear Regression | A Guide on Data Analysis</title>
<meta name="author" content="Mike Nguyen">
<meta name="description" content="Non-linear regression models differ fundamentally from linear regression models in that the derivatives of the mean function with respect to parameters depend on one or more of the parameters....">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 6 Non-Linear Regression | A Guide on Data Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/mike/data_analysis/non-linear-regression.html">
<meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<meta property="og:description" content="Non-linear regression models differ fundamentally from linear regression models in that the derivatives of the mean function with respect to parameters depend on one or more of the parameters....">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 6 Non-Linear Regression | A Guide on Data Analysis">
<meta name="twitter:description" content="Non-linear regression models differ fundamentally from linear regression models in that the derivatives of the mean function with respect to parameters depend on one or more of the parameters....">
<meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DMNX2X65HQ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide on Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">2</span> Prerequisites</a></li>
<li class="book-part">I. BASIC</li>
<li><a class="" href="descriptive-statistics.html"><span class="header-section-number">3</span> Descriptive Statistics</a></li>
<li><a class="" href="basic-statistical-inference.html"><span class="header-section-number">4</span> Basic Statistical Inference</a></li>
<li class="book-part">II. REGRESSION</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></li>
<li><a class="active" href="non-linear-regression.html"><span class="header-section-number">6</span> Non-Linear Regression</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></li>
<li><a class="" href="sec-linear-mixed-models.html"><span class="header-section-number">8</span> Linear Mixed Models</a></li>
<li><a class="" href="sec-nonlinear-and-generalized-linear-mixed-models.html"><span class="header-section-number">9</span> Nonlinear and Generalized Linear Mixed Models</a></li>
<li><a class="" href="nonparametric-regression.html"><span class="header-section-number">10</span> Nonparametric Regression</a></li>
<li class="book-part">III. RAMIFICATIONS</li>
<li><a class="" href="data.html"><span class="header-section-number">11</span> Data</a></li>
<li><a class="" href="variable-transformation.html"><span class="header-section-number">12</span> Variable Transformation</a></li>
<li><a class="" href="imputation-missing-data.html"><span class="header-section-number">13</span> Imputation (Missing Data)</a></li>
<li><a class="" href="model-specification-tests.html"><span class="header-section-number">14</span> Model Specification Tests</a></li>
<li><a class="" href="variable-selection.html"><span class="header-section-number">15</span> Variable Selection</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">16</span> Hypothesis Testing</a></li>
<li><a class="" href="sec-marginal-effects.html"><span class="header-section-number">17</span> Marginal Effects</a></li>
<li><a class="" href="moderation.html"><span class="header-section-number">18</span> Moderation</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">19</span> Mediation</a></li>
<li><a class="" href="prediction-and-estimation.html"><span class="header-section-number">20</span> Prediction and Estimation</a></li>
<li class="book-part">IV. CAUSAL INFERENCE</li>
<li><a class="" href="sec-causal-inference.html"><span class="header-section-number">21</span> Causal Inference</a></li>
<li class="book-part">A. EXPERIMENTAL DESIGN</li>
<li><a class="" href="experimental-design.html"><span class="header-section-number">22</span> Experimental Design</a></li>
<li><a class="" href="sampling.html"><span class="header-section-number">23</span> Sampling</a></li>
<li><a class="" href="sec-analysis-of-variance-anova.html"><span class="header-section-number">24</span> Analysis of Variance</a></li>
<li><a class="" href="sec-multivariate-methods.html"><span class="header-section-number">25</span> Multivariate Methods</a></li>
<li class="book-part">B. QUASI-EXPERIMENTAL DESIGN</li>
<li><a class="" href="sec-quasi-experimental.html"><span class="header-section-number">26</span> Quasi-experimental</a></li>
<li><a class="" href="regression-discontinuity.html"><span class="header-section-number">27</span> Regression Discontinuity</a></li>
<li><a class="" href="synthetic-difference-in-differences.html"><span class="header-section-number">28</span> Synthetic Difference-in-Differences</a></li>
<li><a class="" href="difference-in-differences.html"><span class="header-section-number">29</span> Difference-in-differences</a></li>
<li><a class="" href="changes-in-changes.html"><span class="header-section-number">30</span> Changes-in-Changes</a></li>
<li><a class="" href="synthetic-control.html"><span class="header-section-number">31</span> Synthetic Control</a></li>
<li><a class="" href="event-studies.html"><span class="header-section-number">32</span> Event Studies</a></li>
<li><a class="" href="instrumental-variables.html"><span class="header-section-number">33</span> Instrumental Variables</a></li>
<li><a class="" href="matching-methods.html"><span class="header-section-number">34</span> Matching Methods</a></li>
<li><a class="" href="interrupted-time-series.html"><span class="header-section-number">35</span> Interrupted Time Series</a></li>
<li class="book-part">C. OTHER CONCERNS</li>
<li><a class="" href="endogeneity.html"><span class="header-section-number">36</span> Endogeneity</a></li>
<li><a class="" href="other-biases.html"><span class="header-section-number">37</span> Other Biases</a></li>
<li><a class="" href="controls.html"><span class="header-section-number">38</span> Controls</a></li>
<li><a class="" href="directed-acyclic-graph.html"><span class="header-section-number">39</span> Directed Acyclic Graph</a></li>
<li class="book-part">V. MISCELLANEOUS</li>
<li><a class="" href="report.html"><span class="header-section-number">40</span> Report</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">41</span> Exploratory Data Analysis</a></li>
<li><a class="" href="sensitivity-analysis-robustness-check.html"><span class="header-section-number">42</span> Sensitivity Analysis/ Robustness Check</a></li>
<li><a class="" href="replication-and-synthetic-data.html"><span class="header-section-number">43</span> Replication and Synthetic Data</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="appendix.html"><span class="header-section-number">A</span> Appendix</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">B</span> Bookdown cheat sheet</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mikenguyen13/data_analysis">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="non-linear-regression" class="section level1" number="6">
<h1>
<span class="header-section-number">6</span> Non-Linear Regression<a class="anchor" aria-label="anchor" href="#non-linear-regression"><i class="fas fa-link"></i></a>
</h1>
<p>Non-linear regression models differ fundamentally from linear regression models in that the derivatives of the mean function with respect to parameters depend on one or more of the parameters. This dependence adds complexity but also provides greater flexibility to model intricate relationships.</p>
<p><strong>Linear Regression:</strong></p>
<ul>
<li><p><strong>Model Form Example:</strong> A typical linear regression model looks like <span class="math inline">\(y = \beta_0 + \beta_1 x\)</span>, where <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> are the parameters.</p></li>
<li><p><strong>Parameter Effect:</strong> The influence of each parameter on <span class="math inline">\(y\)</span> is constant. For example, if <span class="math inline">\(\beta_1\)</span> increases by 1, the change in <span class="math inline">\(y\)</span> is always <span class="math inline">\(x\)</span>, regardless of the current value of <span class="math inline">\(\beta_1\)</span>.</p></li>
<li><p><strong>Derivatives:</strong> The partial derivatives of <span class="math inline">\(y\)</span> with respect to each parameter (e.g., <span class="math inline">\(\frac{\partial y}{\partial \beta_1} = x\)</span>) do not depend on the parameters <span class="math inline">\(\beta_0\)</span> or <span class="math inline">\(\beta_1\)</span> themselves—they only depend on the data <span class="math inline">\(x\)</span>. This makes the mathematics of finding the best-fit line straightforward.</p></li>
<li><p>Straightforward estimation via closed-form solutions like <a href="linear-regression.html#ordinary-least-squares">Ordinary Least Squares</a>.</p></li>
</ul>
<p><strong>Non-linear Regression:</strong></p>
<ul>
<li><p><strong>Model Form Example:</strong> Consider <span class="math inline">\(y = \alpha \cdot e^{\beta x}\)</span>. Here, <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> are parameters, but the relationship is not a straight line.</p></li>
<li><p><strong>Parameter Effect:</strong> The effect of changing <span class="math inline">\(\alpha\)</span> or <span class="math inline">\(\beta\)</span> on <span class="math inline">\(y\)</span> is not constant. For instance, if you change <span class="math inline">\(\beta\)</span>, the impact on <span class="math inline">\(y\)</span> depends on both <span class="math inline">\(x\)</span> and the current value of <span class="math inline">\(\beta\)</span>. This makes predictions and adjustments more complex.</p></li>
<li><p><strong>Derivatives:</strong> Taking the partial derivative with respect to <span class="math inline">\(\beta\)</span> gives <span class="math inline">\(\frac{\partial y}{\partial \beta} = \alpha x e^{\beta x}\)</span>. Notice this derivative depends on <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, and <span class="math inline">\(x\)</span>. Unlike linear regression, the sensitivity of <span class="math inline">\(y\)</span> to changes in <span class="math inline">\(\beta\)</span> changes as <span class="math inline">\(\beta\)</span> itself changes.</p></li>
<li><p>Estimation requires iterative algorithms like the <a href="#gauss-newton-algorithm-1">Gauss-Newton Algorithm</a>, as closed-form solutions are not feasible.</p></li>
</ul>
<div class="inline-table"><table class="table table-sm">
<caption>Summary Table: Linear vs. Non-Linear Regression</caption>
<colgroup>
<col width="28%">
<col width="33%">
<col width="37%">
</colgroup>
<thead><tr class="header">
<th>Feature</th>
<th>Linear Regression</th>
<th>Non-Linear Regression</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Relationship</td>
<td>Linear in parameters</td>
<td>Non-linear in parameters</td>
</tr>
<tr class="even">
<td>Interpretability</td>
<td>High</td>
<td>Often challenging</td>
</tr>
<tr class="odd">
<td>Estimation</td>
<td>Closed-form solutions</td>
<td>Iterative algorithms</td>
</tr>
<tr class="even">
<td>Computational Cost</td>
<td>Low</td>
<td>Higher</td>
</tr>
</tbody>
</table></div>
<p><strong>Key Features of Non-linear regression:</strong></p>
<ul>
<li>
<strong>Complex Functional Forms</strong>: Non-linear regression allows for relationships that are not straight lines or planes.</li>
<li>
<strong>Interpretability Challenges</strong>: Non-linear models can be difficult to interpret, especially if the functional forms are complex.</li>
<li>
<strong>Practical Use Cases</strong>:
<ul>
<li>Growth curves</li>
<li>High-order polynomials</li>
<li>Linear approximations (e.g., Taylor expansions)</li>
<li>Collections of locally linear models or basis functions (e.g., splines)</li>
</ul>
</li>
</ul>
<p>While these approaches can approximate data, they may suffer from interpretability issues or may not generalize well when data is sparse. Hence, intrinsically non-linear models are often preferred.</p>
<hr>
<p><strong>Intrinsically Non-Linear Models</strong></p>
<p>The general form of an intrinsically non-linear regression model is:</p>
<p><span class="math display">\[
Y_i = f(\mathbf{x}_i; \mathbf{\theta}) + \epsilon_i
\]</span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(f(\mathbf{x}_i; \mathbf{\theta})\)</span>: A <strong>non-linear function</strong> that relates <span class="math inline">\(E(Y_i)\)</span> to the independent variables <span class="math inline">\(\mathbf{x}_i\)</span>.</li>
<li>
<span class="math inline">\(\mathbf{x}_i\)</span>: A <span class="math inline">\(k \times 1\)</span> vector of independent variables (fixed).</li>
<li>
<span class="math inline">\(\mathbf{\theta}\)</span>: A <span class="math inline">\(p \times 1\)</span> vector of parameters.</li>
<li>
<span class="math inline">\(\epsilon_i\)</span>: Independent and identically distributed random errors, often assumed to have a mean of 0 and a constant variance <span class="math inline">\(\sigma^2\)</span>. In some cases, <span class="math inline">\(\epsilon_i \sim \mathcal{N}(0, \sigma^2)\)</span>.</li>
</ul>
<p>Example: Exponential Growth Model</p>
<p>A common non-linear model is the exponential growth function:</p>
<p><span class="math display">\[
y = \theta_1 e^{\theta_2 x} + \epsilon
\]</span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(\theta_1\)</span>: Initial value.</li>
<li>
<span class="math inline">\(\theta_2\)</span>: Growth rate.</li>
<li>
<span class="math inline">\(x\)</span>: Independent variable (e.g., time).</li>
<li>
<span class="math inline">\(\epsilon\)</span>: Random error.</li>
</ul>
<div id="inference" class="section level2" number="6.1">
<h2>
<span class="header-section-number">6.1</span> Inference<a class="anchor" aria-label="anchor" href="#inference"><i class="fas fa-link"></i></a>
</h2>
<p>Since <span class="math inline">\(Y_i = f(\mathbf{x}_i, \theta) + \epsilon_i\)</span>, where <span class="math inline">\(\epsilon_i \sim \text{iid}(0, \sigma^2)\)</span>, we can estimate parameters (<span class="math inline">\(\hat{\theta}\)</span>) by minimizing the sum of squared errors:</p>
<p><span class="math display">\[
\sum_{i=1}^{n} \big(Y_i - f(\mathbf{x}_i, \theta)\big)^2
\]</span></p>
<p>Let <span class="math inline">\(\hat{\theta}\)</span> be the minimizer, the variance of residuals is estimated as:</p>
<p><span class="math display">\[
s^2 = \hat{\sigma}^2_{\epsilon} = \frac{\sum_{i=1}^{n} \big(Y_i - f(\mathbf{x}_i, \hat{\theta})\big)^2}{n - p}
\]</span></p>
<p>where <span class="math inline">\(p\)</span> is the number of parameters in <span class="math inline">\(\mathbf{\theta}\)</span>, and <span class="math inline">\(n\)</span> is the number of observations.</p>
<hr>
<p><strong>Asymptotic Distribution</strong> of <span class="math inline">\(\hat{\theta}\)</span></p>
<p>Under regularity conditions—most notably that <span class="math inline">\(\epsilon_i \sim N(0, \sigma^2)\)</span> or that <span class="math inline">\(n\)</span> is sufficiently large for a central-limit-type argument—the parameter estimates <span class="math inline">\(\hat{\theta}\)</span> have the following asymptotic normal distribution:</p>
<p><span class="math display">\[
\hat{\theta} \sim AN(\mathbf{\theta}, \sigma^2[\mathbf{F}(\theta)'\mathbf{F}(\theta)]^{-1})
\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(AN\)</span> stands for “asymptotic normality.”</li>
<li>
<span class="math inline">\(\mathbf{F}(\theta)\)</span> is the <span class="math inline">\(n \times p\)</span> Jacobian matrix of partial derivatives of <span class="math inline">\(f(\mathbf{x}_i, \theta)\)</span> with respect to <span class="math inline">\(\mathbf{\theta}\)</span>, evaluated at <span class="math inline">\(\hat{\theta}\)</span>. Specifically,</li>
</ul>
<p><span class="math display">\[
\mathbf{F}(\theta) = \begin{pmatrix}
\frac{\partial f(\mathbf{x}_1, \boldsymbol{\theta})}{\partial \theta_1} &amp; \cdots &amp; \frac{\partial f(\mathbf{x}_1, \boldsymbol{\theta})}{\partial \theta_p} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial f(\mathbf{x}_n, \boldsymbol{\theta})}{\partial \theta_1} &amp; \cdots &amp; \frac{\partial f(\mathbf{x}_n, \boldsymbol{\theta})}{\partial \theta_p}
\end{pmatrix}
\]</span></p>
<p>Asymptotic normality means that as the sample size <span class="math inline">\(n\)</span> becomes large, the sampling distribution of <span class="math inline">\(\hat{\theta}\)</span> approaches a normal distribution, which enables inference on the parameters.</p>
<div id="linear-functions-of-the-parameters" class="section level3" number="6.1.1">
<h3>
<span class="header-section-number">6.1.1</span> Linear Functions of the Parameters<a class="anchor" aria-label="anchor" href="#linear-functions-of-the-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>A “linear function of the parameters” refers to a quantity that can be written as <span class="math inline">\(\mathbf{a}'\boldsymbol{\theta}\)</span>, where <span class="math inline">\(\mathbf{a}\)</span> is some (constant) contrast vector. Common examples include:</p>
<ul>
<li><p>A single parameter <span class="math inline">\(\theta_j\)</span> (using a vector <span class="math inline">\(\mathbf{a}\)</span> with 1 in the <span class="math inline">\(j\)</span>-th position and 0 elsewhere).</p></li>
<li><p>Differences, sums, or other contrasts, e.g. <span class="math inline">\(\theta_1 - \theta_2\)</span>.</p></li>
</ul>
<p>Suppose we are interested in a linear combination of the parameters, such as <span class="math inline">\(\theta_1 - \theta_2\)</span>. Define the contrast vector <span class="math inline">\(\mathbf{a}\)</span> as:</p>
<p><span class="math display">\[
\mathbf{a} = (0, 1, -1)'
\]</span></p>
<p>We then consider inference for <span class="math inline">\(\mathbf{a'\theta}\)</span> (<span class="math inline">\(\mathbf{a}\)</span> can be <span class="math inline">\(p\)</span>-dimensional vector). Using rules for the expectation and variance of a linear combination of a random vector <span class="math inline">\(\mathbf{Z}\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
E(\mathbf{a'Z}) &amp;= \mathbf{a'}E(\mathbf{Z}) \\
\text{Var}(\mathbf{a'Z}) &amp;= \mathbf{a'} \text{Var}(\mathbf{Z}) \mathbf{a}
\end{aligned}
\]</span></p>
<p>We have</p>
<p><span class="math display">\[
\begin{aligned}
E(\mathbf{a'\hat{\theta}}) &amp;= \mathbf{a'}E(\hat{\theta}) \approx \mathbf{a}' \theta \\
\text{Var}(\mathbf{a'} \hat{\theta}) &amp;= \mathbf{a'} \text{Var}(\hat{\theta}) \mathbf{a} \approx \sigma^2 \mathbf{a'[\mathbf{F}(\theta)'\mathbf{F}(\theta)]^{-1}a}
\end{aligned}
\]</span></p>
<p>Hence,</p>
<p><span class="math display">\[
\mathbf{a'\hat{\theta}} \sim AN\big(\mathbf{a'\theta}, \sigma^2 \mathbf{a'[\mathbf{F}(\theta)'\mathbf{F}(\theta)]^{-1}a}\big)
\]</span></p>
<hr>
<p>Confidence Intervals for Linear Contrasts</p>
<p>Since <span class="math inline">\(\mathbf{a'\hat{\theta}}\)</span> is asymptotically independent of <span class="math inline">\(s^2\)</span> (up to order <span class="math inline">\(O1/n\)</span>), a two-sided <span class="math inline">\(100(1-\alpha)\%\)</span> confidence interval for <span class="math inline">\(\mathbf{a'\theta}\)</span> is given by:</p>
<p><span class="math display">\[
\mathbf{a'\theta} \pm t_{(1-\alpha/2, n-p)} s \sqrt{\mathbf{a'[\mathbf{F}(\hat{\theta})'\mathbf{F}(\hat{\theta})]^{-1}a}}
\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(t_{(1-\alpha/2, n-p)}\)</span> is the critical value of the <span class="math inline">\(t\)</span>-distribution with <span class="math inline">\(n - p\)</span> degrees of freedom.</li>
<li>
<span class="math inline">\(s = \sqrt{\hat{\sigma^2}_\epsilon}\)</span> is the estimated standard deviation of residuals.</li>
</ul>
<p><strong>Special Case</strong>: A Single Parameter <span class="math inline">\(\theta_j\)</span></p>
<p>If we focus on a single parameter <span class="math inline">\(\theta_j\)</span>, let <span class="math inline">\(\mathbf{a'} = (0, \dots, 1, \dots, 0)\)</span> (with 1 at the <span class="math inline">\(j\)</span>-th position). Then, the confidence interval for <span class="math inline">\(\theta_j\)</span> becomes:</p>
<p><span class="math display">\[
\hat{\theta}_j \pm t_{(1-\alpha/2, n-p)} s \sqrt{\hat{c}^j}
\]</span></p>
<p>where <span class="math inline">\(\hat{c}^j\)</span> is the <span class="math inline">\(j\)</span>-th diagonal element of <span class="math inline">\([\mathbf{F}(\hat{\theta})'\mathbf{F}(\hat{\theta})]^{-1}\)</span>.</p>
<hr>
</div>
<div id="nonlinear-functions-of-parameters" class="section level3" number="6.1.2">
<h3>
<span class="header-section-number">6.1.2</span> Nonlinear Functions of Parameters<a class="anchor" aria-label="anchor" href="#nonlinear-functions-of-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>In many cases, we are interested in nonlinear functions of <span class="math inline">\(\boldsymbol{\theta}\)</span>. Let <span class="math inline">\(h(\boldsymbol{\theta})\)</span> be such a function (e.g., a ratio of parameters, a difference of exponentials, etc.).</p>
<p>When <span class="math inline">\(h(\theta)\)</span> is a nonlinear function of the parameters, we can use a <strong>Taylor series expansion</strong> about <span class="math inline">\(\theta\)</span> to approximate <span class="math inline">\(h(\hat{\theta})\)</span>:</p>
<p><span class="math display">\[
h(\hat{\theta}) \approx h(\theta) + \mathbf{h}' [\hat{\theta} - \theta]
\]</span></p>
<p>where</p>
<ul>
<li>
<span class="math inline">\(\mathbf{h} = \left( \frac{\partial h}{\partial \theta_1}, \frac{\partial h}{\partial \theta_2}, \dots, \frac{\partial h}{\partial \theta_p} \right)'\)</span> is the gradient vector of partial derivatives.</li>
</ul>
<p><strong>Key Approximations:</strong></p>
<ol style="list-style-type: decimal">
<li><p><strong>Expectation and Variance of</strong> <span class="math inline">\(\hat{\theta}\)</span> (using the asymptotic normality of <span class="math inline">\(\hat{\theta}\)</span>: <span class="math display">\[
\begin{aligned}
E(\hat{\theta}) &amp;\approx \theta, \\
\text{Var}(\hat{\theta}) &amp;\approx \sigma^2 [\mathbf{F}(\theta)' \mathbf{F}(\theta)]^{-1}.
\end{aligned}
\]</span></p></li>
<li><p><strong>Expectation and Variance of</strong> <span class="math inline">\(h(\hat{\theta})\)</span> (properties of expectation and variance of (approximately) linear transformations): <span class="math display">\[
\begin{aligned}
E(h(\hat{\theta})) &amp;\approx h(\theta), \\
\text{Var}(h(\hat{\theta})) &amp;\approx \sigma^2 \mathbf{h}'[\mathbf{F}(\theta)' \mathbf{F}(\theta)]^{-1} \mathbf{h}.
\end{aligned}\]</span></p></li>
</ol>
<p>Combining these results, we find:</p>
<p><span class="math display">\[
h(\hat{\theta}) \sim AN(h(\theta), \sigma^2 \mathbf{h}' [\mathbf{F}(\theta)' \mathbf{F}(\theta)]^{-1} \mathbf{h}),
\]</span></p>
<p>where <span class="math inline">\(AN\)</span> represents asymptotic normality.</p>
<p><strong>Confidence Interval for</strong> <span class="math inline">\(h(\theta)\)</span><strong>:</strong></p>
<p>An approximate <span class="math inline">\(100(1-\alpha)\%\)</span> confidence interval for <span class="math inline">\(h(\theta)\)</span> is:</p>
<p><span class="math display">\[
h(\hat{\theta}) \pm t_{(1-\alpha/2, n-p)} s \sqrt{\mathbf{h}'[\mathbf{F}(\theta)' \mathbf{F}(\theta)]^{-1} \mathbf{h}},
\]</span></p>
<p>where <span class="math inline">\(\mathbf{h}\)</span> and <span class="math inline">\(\mathbf{F}(\theta)\)</span> are evaluated at <span class="math inline">\(\hat{\theta}\)</span>.</p>
<hr>
<p>To compute a <strong>prediction interval</strong> for a new observation <span class="math inline">\(Y_0\)</span> at <span class="math inline">\(x = x_0\)</span>:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Model Definition</strong>: <span class="math display">\[
Y_0 = f(x_0; \theta) + \epsilon_0, \quad \epsilon_0 \sim N(0, \sigma^2),
\]</span> with the predicted value: <span class="math display">\[
\hat{Y}_0 = f(x_0, \hat{\theta}).
\]</span></p></li>
<li><p><strong>Approximation for</strong> <span class="math inline">\(\hat{Y}_0\)</span>: As <span class="math inline">\(n \to \infty\)</span>, <span class="math inline">\(\hat{\theta} \to \theta\)</span>, so we have: <span class="math display">\[
f(x_0, \hat{\theta}) \approx f(x_0, \theta) + \mathbf{f}_0(\theta)' [\hat{\theta} - \theta],
\]</span> where: <span class="math display">\[
\mathbf{f}_0(\theta) = \left( \frac{\partial f(x_0, \theta)}{\partial \theta_1}, \dots, \frac{\partial f(x_0, \theta)}{\partial \theta_p} \right)'.
\]</span></p></li>
<li><p><strong>Error Approximation</strong>: <span class="math display">\[
\begin{aligned}Y_0 - \hat{Y}_0 &amp;\approx Y_0  - f(x_0,\theta) - f_0(\theta)'[\hat{\theta}-\theta]  \\&amp;= \epsilon_0 - f_0(\theta)'[\hat{\theta}-\theta]\end{aligned}
\]</span></p></li>
<li><p><strong>Variance of</strong> <span class="math inline">\(Y_0 - \hat{Y}_0\)</span>: <span class="math display">\[
\begin{aligned}
\text{Var}(Y_0 - \hat{Y}_0) &amp;\approx \text{Var}(\epsilon_0 - \mathbf{f}_0(\theta)' [\hat{\theta} - \theta]) \\
&amp;= \sigma^2 + \sigma^2 \mathbf{f}_0(\theta)' [\mathbf{F}(\theta)' \mathbf{F}(\theta)]^{-1} \mathbf{f}_0(\theta) \\
&amp;= \sigma^2 \big(1 + \mathbf{f}_0(\theta)' [\mathbf{F}(\theta)' \mathbf{F}(\theta)]^{-1} \mathbf{f}_0(\theta)\big).
\end{aligned}
\]</span></p></li>
</ol>
<p>Hence, the prediction error <span class="math inline">\(Y_0 - \hat{Y}_0\)</span> follows an asymptotic normal distribution:</p>
<p><span class="math display">\[
Y_0 - \hat{Y}_0 \sim AN\big(0, \sigma^2 \big(1 + \mathbf{f}_0(\theta)' [\mathbf{F}(\theta)' \mathbf{F}(\theta)]^{-1} \mathbf{f}_0(\theta)\big)\big).
\]</span></p>
<p>A <span class="math inline">\(100(1-\alpha)\%\)</span> prediction interval for <span class="math inline">\(Y_0\)</span> is:</p>
<p><span class="math display">\[
\hat{Y}_0 \pm t_{(1-\alpha/2, n-p)} s \sqrt{1 + \mathbf{f}_0(\hat{\theta})' [\mathbf{F}(\hat{\theta})' \mathbf{F}(\hat{\theta})]^{-1} \mathbf{f}_0(\hat{\theta})}.
\]</span></p>
<p>where we substitute <span class="math inline">\(\hat{\theta}\)</span> into <span class="math inline">\(\mathbf{f}_0\)</span> and <span class="math inline">\(\mathbf{F}\)</span>. Recall <span class="math inline">\(s\)</span> is the estiamte of <span class="math inline">\(\sigma\)</span>.</p>
<hr>
<p>Sometimes we want a confidence interval for <span class="math inline">\(E(Y_i)\)</span> (i.e., the mean response at <span class="math inline">\(x_0\)</span>), rather than a prediction interval for an individual future observation. In that case, the variance term for the random error <span class="math inline">\(\epsilon_0\)</span> is not included. Hence, the formula is the same but without the “+1”:</p>
<p><span class="math display">\[
E(Y_0) \approx f(x_0; \theta),
\]</span></p>
<p>and the confidence interval is:</p>
<p><span class="math display">\[
f(x_0, \hat{\theta}) \pm t_{(1-\alpha/2, n-p)} s \sqrt{\mathbf{f}_0(\hat{\theta})' [\mathbf{F}(\hat{\theta})' \mathbf{F}(\hat{\theta})]^{-1} \mathbf{f}_0(\hat{\theta})}.
\]</span></p>
<p>Summary</p>
<ul>
<li><p><a href="non-linear-regression.html#linear-functions-of-the-parameters">Linear Functions of the Parameters</a>: A function <span class="math inline">\(f(x, \theta)\)</span> is linear in <span class="math inline">\(\theta\)</span> if it can be written in the form <span class="math display">\[f(x, \theta) = \theta_1 g_1(x) + \theta_2 g_2(x) + \dots + \theta_p g_p(x)\]</span> where <span class="math inline">\(g_j(x)\)</span> do not depend on <span class="math inline">\(\theta\)</span>. In this case, the Jacobian <span class="math inline">\(\mathbf{F}(\theta)\)</span> does not depend on <span class="math inline">\(\theta\)</span> itself (only on <span class="math inline">\(x_i\)</span>), and exact formulas often match what is familiar from linear regression.</p></li>
<li><p><a href="non-linear-regression.html#nonlinear-functions-of-parameters">Nonlinear Functions of Parameters</a>: If <span class="math inline">\(f(x, \theta)\)</span> depends on <span class="math inline">\(\theta\)</span> in a nonlinear way (e.g., <span class="math inline">\(\theta_1 e^{\theta_2 x}, \beta_1/\beta_2\)</span> or more complicated expressions), <span class="math inline">\(\mathbf{F}(\theta)\)</span> depends on <span class="math inline">\(\theta\)</span>. Estimation generally requires iterative numerical methods (e.g., Gauss–Newton, Levenberg–Marquardt), and the asymptotic results rely on evaluating partial derivatives at <span class="math inline">\(\hat{\theta}\)</span>. Nevertheless, the final inference formulas—confidence intervals, prediction intervals—have a similar form, thanks to the asymptotic normality arguments.</p></li>
</ul>
<hr>
</div>
</div>
<div id="non-linear-least-squares-estimation" class="section level2" number="6.2">
<h2>
<span class="header-section-number">6.2</span> Non-linear Least Squares Estimation<a class="anchor" aria-label="anchor" href="#non-linear-least-squares-estimation"><i class="fas fa-link"></i></a>
</h2>
<p>The least squares (LS) estimate of <span class="math inline">\(\theta\)</span>, denoted as <span class="math inline">\(\hat{\theta}\)</span>, minimizes the residual sum of squares:</p>
<p><span class="math display">\[
S(\hat{\theta}) = SSE(\hat{\theta}) = \sum_{i=1}^{n} \{Y_i - f(\mathbf{x}_i; \hat{\theta})\}^2
\]</span></p>
<p>To solve this, we consider the partial derivatives of <span class="math inline">\(S(\theta)\)</span> with respect to each <span class="math inline">\(\theta_j\)</span> and set them to zero, leading to the normal equations:</p>
<p><span class="math display">\[
\frac{\partial S(\theta)}{\partial \theta_j} = -2 \sum_{i=1}^{n} \{Y_i - f(\mathbf{x}_i; \theta)\} \frac{\partial f(\mathbf{x}_i; \theta)}{\partial \theta_j} = 0
\]</span></p>
<p>However, these equations are inherently non-linear and, in most cases, cannot be solved analytically. As a result, various estimation techniques are employed to approximate solutions efficiently. These approaches include:</p>
<ul>
<li>
<a href="non-linear-regression.html#iterative-optimization-nonlinear-regression">Iterative Optimization</a> – Methods that refine estimates through successive iterations to minimize error.</li>
<li>
<a href="non-linear-regression.html#derivative-free">Derivative-Free</a> Methods – Techniques that do not rely on gradient information, useful for complex or non-smooth functions.</li>
<li>
<a href="non-linear-regression.html#stochastic-heuristic-nolinear-regression">Stochastic Heuristic</a> – Algorithms that incorporate randomness, such as genetic algorithms or simulated annealing, to explore solution spaces.</li>
<li>
<a href="non-linear-regression.html#linearization-nonlinear-regression-optimization">Linearization</a>– Approximating non-linear models with linear ones to enable analytical or numerical solutions.</li>
<li>
<a href="non-linear-regression.html#hybrid-nonlinear-regression-optimization">Hybrid</a> Approaches – Combining multiple methods to leverage their respective strengths for improved estimation.</li>
</ul>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="30%">
<col width="15%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left"><strong>Category</strong></th>
<th align="left"><strong>Method</strong></th>
<th align="left"><strong>Best For</strong></th>
<th align="left"><strong>Derivative?</strong></th>
<th align="left"><strong>Optimization</strong></th>
<th align="left"><strong>Comp. Cost</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><a href="non-linear-regression.html#iterative-optimization-nonlinear-regression">Iterative Optimization</a></td>
<td align="left"><a href="non-linear-regression.html#steepest-descent">Steepest Descent (Gradient Descent)</a></td>
<td align="left">Simple problems, slow convergence</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">Low</td>
</tr>
<tr class="even">
<td align="left"><strong>Iterative Optimization</strong></td>
<td align="left"><a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a></td>
<td align="left">Faster than GD, ignores exact second-order info</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="odd">
<td align="left"><strong>Iterative Optimization</strong></td>
<td align="left"><a href="non-linear-regression.html#levenberg-marquardt">Levenberg-Marquardt Algorithm</a></td>
<td align="left">Balances GN &amp; GD, robust</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="even">
<td align="left"><strong>Iterative Optimization</strong></td>
<td align="left"><a href="non-linear-regression.html#newton-raphson">Newton-Raphson Method</a></td>
<td align="left">Quadratic convergence, needs Hessian</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">High</td>
</tr>
<tr class="odd">
<td align="left"><strong>Iterative Optimization</strong></td>
<td align="left"><a href="non-linear-regression.html#quasi-newton-method">Quasi-Newton Method</a></td>
<td align="left">Approximates Hessian for large problems</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="even">
<td align="left"><strong>Iterative Optimization</strong></td>
<td align="left"><a href="non-linear-regression.html#trust-region-reflective-algorithm">Trust-Region Reflective Algorithm</a></td>
<td align="left">Handles constraints, robust</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">High</td>
</tr>
<tr class="odd">
<td align="left"><a href="Techniques%20that%20do%20not%20rely%20on%20gradient%20information,%20useful%20for%20complex%20or%20non-smooth%20functions.">Derivative-Free</a></td>
<td align="left"><a href="non-linear-regression.html#secant-method">Secant Method</a></td>
<td align="left">Approximates derivative from function evaluations</td>
<td align="left">No</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="even">
<td align="left"><strong>Derivative-Free</strong></td>
<td align="left"><a href="non-linear-regression.html#nelder-mead">Nelder-Mead (Simplex)</a></td>
<td align="left">No derivatives, heuristic</td>
<td align="left">No</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="odd">
<td align="left"><strong>Derivative-Free</strong></td>
<td align="left"><a href="non-linear-regression.html#powells-method">Powell’s Method</a></td>
<td align="left">Line search, no explicit gradient</td>
<td align="left">No</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="even">
<td align="left"><strong>Derivative-Free</strong></td>
<td align="left"><a href="non-linear-regression.html#grid-search">Grid Search</a></td>
<td align="left">Exhaustive search (best in low dims)</td>
<td align="left">No</td>
<td align="left">Global</td>
<td align="left">Very High</td>
</tr>
<tr class="odd">
<td align="left"><strong>Derivative-Free</strong></td>
<td align="left"><a href="non-linear-regression.html#hooke-jeeves">Hooke-Jeeves Pattern Search</a></td>
<td align="left">Pattern-based, black-box optimization</td>
<td align="left">No</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="even">
<td align="left"><strong>Derivative-Free</strong></td>
<td align="left"><a href="non-linear-regression.html#bisection-method">Bisection Method</a></td>
<td align="left">Simple root/interval-based approach</td>
<td align="left">No</td>
<td align="left">Local</td>
<td align="left">Low</td>
</tr>
<tr class="odd">
<td align="left"><a href="non-linear-regression.html#stochastic-heuristic-nolinear-regression">Stochastic Heuristic</a></td>
<td align="left"><a href="non-linear-regression.html#simulated-annealing">Simulated Annealing</a></td>
<td align="left">Escapes local minima, non-smooth problems</td>
<td align="left">No</td>
<td align="left">Global</td>
<td align="left">High</td>
</tr>
<tr class="even">
<td align="left"><strong>Stochastic Heuristic</strong></td>
<td align="left"><a href="non-linear-regression.html#genetic-algorithm">Genetic Algorithm</a></td>
<td align="left">Large search spaces, evolving parameters</td>
<td align="left">No</td>
<td align="left">Global</td>
<td align="left">High</td>
</tr>
<tr class="odd">
<td align="left"><strong>Stochastic Heuristic</strong></td>
<td align="left"><a href="non-linear-regression.html#particle-swarm-optimization">Particle Swarm Optimization</a></td>
<td align="left">Swarm-based, often fast global convergence</td>
<td align="left">No</td>
<td align="left">Global</td>
<td align="left">Medium</td>
</tr>
<tr class="even">
<td align="left"><strong>Stochastic Heuristic</strong></td>
<td align="left"><a href="non-linear-regression.html#evolutionary-strategies">Evolutionary Strategies</a></td>
<td align="left">High-dimensional, adaptive step-size</td>
<td align="left">No</td>
<td align="left">Global</td>
<td align="left">High</td>
</tr>
<tr class="odd">
<td align="left"><strong>Stochastic Heuristic</strong></td>
<td align="left"><a href="non-linear-regression.html#differential-evolution-algorithm">Differential Evolution Algorithm</a></td>
<td align="left">Robust global optimizer, population-based</td>
<td align="left">No</td>
<td align="left">Global</td>
<td align="left">High</td>
</tr>
<tr class="even">
<td align="left"><strong>Stochastic Heuristic</strong></td>
<td align="left">Ant Colony Optimization (ACO)</td>
<td align="left">Discrete / combinatorial problems</td>
<td align="left">No</td>
<td align="left">Global</td>
<td align="left">High</td>
</tr>
<tr class="odd">
<td align="left"><a href="non-linear-regression.html#linearization-nonlinear-regression-optimization">Linearization</a></td>
<td align="left"><a href="non-linear-regression.html#taylor-series-approximation-nonlinear-optimization">Taylor Series Approximation</a></td>
<td align="left">Local approximation of non-linearity</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">Low</td>
</tr>
<tr class="even">
<td align="left"><strong>Linearization</strong></td>
<td align="left"><a href="non-linear-regression.html#log-linearization-nonlinear-optimization">Log-Linearization</a></td>
<td align="left">Transforms non-linear equations</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">Low</td>
</tr>
<tr class="odd">
<td align="left"><a href="non-linear-regression.html#hybrid-nonlinear-regression-optimization">Hybrid</a></td>
<td align="left"><a href="non-linear-regression.html#adaptive-levenberg-marquardt">Adaptive Levenberg-Marquardt</a></td>
<td align="left">Dynamically adjusts damping in LM</td>
<td align="left">Yes</td>
<td align="left">Local</td>
<td align="left">Medium</td>
</tr>
<tr class="even">
<td align="left"><strong>Hybrid</strong></td>
<td align="left">Hybrid Genetic Algorithm &amp; LM (GA-LM)</td>
<td align="left">GA for coarse search, LM for fine-tuning</td>
<td align="left">No</td>
<td align="left">Hybrid</td>
<td align="left">High</td>
</tr>
<tr class="odd">
<td align="left"><strong>Hybrid</strong></td>
<td align="left">Neural Network-Based NLLS</td>
<td align="left">Deep learning for complex non-linear least squares</td>
<td align="left">No</td>
<td align="left">Hybrid</td>
<td align="left">Very High</td>
</tr>
</tbody>
</table></div>
<div id="iterative-optimization-nonlinear-regression" class="section level3" number="6.2.1">
<h3>
<span class="header-section-number">6.2.1</span> Iterative Optimization<a class="anchor" aria-label="anchor" href="#iterative-optimization-nonlinear-regression"><i class="fas fa-link"></i></a>
</h3>
<div id="gauss-newton-algorithm" class="section level4" number="6.2.1.1">
<h4>
<span class="header-section-number">6.2.1.1</span> Gauss-Newton Algorithm<a class="anchor" aria-label="anchor" href="#gauss-newton-algorithm"><i class="fas fa-link"></i></a>
</h4>
<p>The Gauss-Newton Algorithm is an iterative optimization method used to estimate parameters in nonlinear least squares problems. It refines parameter estimates by approximating the Hessian matrix using first-order derivatives, making it computationally efficient for many practical applications (e.g., regression models in finance and marketing analytics). The objective is to minimize the Sum of Squared Errors (SSE):</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} [Y_i - f_i(\theta)]^2,
\]</span></p>
<p>where <span class="math inline">\(\mathbf{Y} = [Y_1, \dots, Y_n]'\)</span> are the observed responses, and <span class="math inline">\(f_i(\theta)\)</span> are the model-predicted values.</p>
<hr>
<p><strong>Iterative Refinement via Taylor Expansion</strong></p>
<p>The Gauss-Newton algorithm iteratively refines an initial estimate <span class="math inline">\(\hat{\theta}^{(0)}\)</span> using the <strong>Taylor series expansion</strong> of <span class="math inline">\(f(\mathbf{x}_i; \theta)\)</span> about <span class="math inline">\(\hat{\theta}^{(0)}\)</span>. We start with the observation model:</p>
<p><span class="math display">\[
Y_i = f(\mathbf{x}_i; \theta) + \epsilon_i.
\]</span></p>
<p>By expanding <span class="math inline">\(f(\mathbf{x}_i; \theta)\)</span> around <span class="math inline">\(\hat{\theta}^{(0)}\)</span> and ignoring higher-order terms (assuming the remainder is small), we get:</p>
<p><span class="math display">\[
\begin{aligned}
Y_i &amp;\approx f(\mathbf{x}_i; \hat{\theta}^{(0)})
+ \sum_{j=1}^{p} \frac{\partial f(\mathbf{x}_i; \theta)}{\partial \theta_j} \bigg|_{\theta = \hat{\theta}^{(0)}}
\bigl(\theta_j - \hat{\theta}_j^{(0)}\bigr)
+ \epsilon_i.
\end{aligned}
\]</span></p>
<p>In <strong>matrix form</strong>, let</p>
<p><span class="math display">\[
\mathbf{Y} =
\begin{bmatrix}
Y_1 \\ \vdots \\ Y_n
\end{bmatrix},
\quad
\mathbf{f}(\hat{\theta}^{(0)}) =
\begin{bmatrix}
f(\mathbf{x}_1, \hat{\theta}^{(0)}) \\ \vdots \\ f(\mathbf{x}_n, \hat{\theta}^{(0)})
\end{bmatrix},
\]</span></p>
<p>and define the <strong>Jacobian matrix</strong> of partial derivatives</p>
<p><span class="math display">\[
\mathbf{F}(\hat{\theta}^{(0)}) =
\begin{bmatrix}
\frac{\partial f(\mathbf{x}_1, \theta)}{\partial \theta_1} &amp; \cdots &amp; \frac{\partial f(\mathbf{x}_1, \theta)}{\partial \theta_p} \\
\vdots &amp; \ddots &amp; \vdots \\
\frac{\partial f(\mathbf{x}_n, \theta)}{\partial \theta_1} &amp; \cdots &amp; \frac{\partial f(\mathbf{x}_n, \theta)}{\partial \theta_p}
\end{bmatrix}_{\theta = \hat{\theta}^{(0)}}.
\]</span></p>
<p>Then,</p>
<p><span class="math display">\[
\mathbf{Y} \approx \mathbf{f}(\hat{\theta}^{(0)})
+ \mathbf{F}(\hat{\theta}^{(0)})\,(\theta - \hat{\theta}^{(0)}) + \epsilon,
\]</span></p>
<p>with <span class="math inline">\(\epsilon = [\epsilon_1, \dots, \epsilon_n]'\)</span> assumed i.i.d. with mean <span class="math inline">\(0\)</span> and variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>From this linear approximation,</p>
<p><span class="math display">\[
\mathbf{Y} - \mathbf{f}(\hat{\theta}^{(0)})
\approx \mathbf{F}(\hat{\theta}^{(0)})\,(\theta - \hat{\theta}^{(0)}).
\]</span></p>
<p>Solving for <span class="math inline">\(\theta - \hat{\theta}^{(0)}\)</span> in the <strong>least squares</strong> sense gives the Gauss increment <span class="math inline">\(\hat{\delta}^{(1)}\)</span>, so we can update:</p>
<p><span class="math display">\[
\hat{\theta}^{(1)} = \hat{\theta}^{(0)} + \hat{\delta}^{(1)}.
\]</span></p>
<hr>
<p><strong>Step-by-Step Procedure</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Initialize</strong>: Start with an initial estimate <span class="math inline">\(\hat{\theta}^{(0)}\)</span> and set <span class="math inline">\(j = 0\)</span>.<br>
</li>
<li>
<strong>Compute Taylor Expansion</strong>: Calculate <span class="math inline">\(\mathbf{f}(\hat{\theta}^{(j)})\)</span> and <span class="math inline">\(\mathbf{F}(\hat{\theta}^{(j)})\)</span>.<br>
</li>
<li>
<strong>Solve for Increment</strong>: Treating <span class="math inline">\(\mathbf{Y} - \mathbf{f}(\hat{\theta}^{(j)}) \approx \mathbf{F}(\hat{\theta}^{(j)})\, (\theta - \hat{\theta}^{(j)})\)</span> as a linear model, use Ordinary Least Squares to compute <span class="math inline">\(\hat{\delta}^{(j+1)}\)</span>.<br>
</li>
<li>
<strong>Update Parameters</strong>: Set <span class="math inline">\(\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} + \hat{\delta}^{(j+1)}\)</span>.<br>
</li>
<li>
<strong>Check for Convergence</strong>: If the convergence criteria are met (see below), stop; otherwise, return to Step 2.<br>
</li>
<li>
<strong>Estimate Variance</strong>: After convergence, we assume <span class="math inline">\(\epsilon \sim (\mathbf{0}, \sigma^2 \mathbf{I})\)</span>. The variance <span class="math inline">\(\sigma^2\)</span> can be estimated by</li>
</ol>
<p><span class="math display">\[
\hat{\sigma}^2 = \frac{1}{n-p} \bigl(\mathbf{Y} - \mathbf{f}(\mathbf{x}; \hat{\theta})\bigr)' \bigl(\mathbf{Y} - \mathbf{f}(\mathbf{x}; \hat{\theta})\bigr).
\]</span></p>
<hr>
<p><strong>Convergence Criteria</strong></p>
<p>Common criteria for deciding when to stop iterating include:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Objective Function Change</strong>: <span class="math display">\[
\frac{\bigl|SSE(\hat{\theta}^{(j+1)}) - SSE(\hat{\theta}^{(j)})\bigr|}{SSE(\hat{\theta}^{(j)})} &lt; \gamma_1.
\]</span>
</li>
<li>
<strong>Parameter Change</strong>: <span class="math display">\[
\bigl|\hat{\theta}^{(j+1)} - \hat{\theta}^{(j)}\bigr| &lt; \gamma_2.
\]</span>
</li>
<li>
<strong>Residual Projection Criterion</strong>: The residuals satisfy convergence as defined in <span class="citation">(<a href="references.html#ref-bates1981relative">D. M. Bates and Watts 1981</a>)</span>.</li>
</ol>
<hr>
<p>Another way to see the update step is by viewing the <strong>necessary condition for a minimum</strong>: the gradient of <span class="math inline">\(SSE(\theta)\)</span> with respect to <span class="math inline">\(\theta\)</span> should be zero. For</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} [Y_i - f_i(\theta)]^2,
\]</span></p>
<p>the gradient is</p>
<p><span class="math display">\[
\frac{\partial SSE(\theta)}{\partial \theta}
= 2\,\mathbf{F}(\theta)' \bigl[\mathbf{Y} - \mathbf{f}(\theta)\bigr].
\]</span></p>
<p>Using the Gauss-Newton update rule from iteration <span class="math inline">\(j\)</span> to <span class="math inline">\(j+1\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\theta}^{(j+1)}
&amp;= \hat{\theta}^{(j)} + \hat{\delta}^{(j+1)} \\
&amp;= \hat{\theta}^{(j)} + \bigl[\mathbf{F}(\hat{\theta}^{(j)})' \,\mathbf{F}(\hat{\theta}^{(j)})\bigr]^{-1}
\,\mathbf{F}(\hat{\theta}^{(j)})' \bigl[\mathbf{Y} - \mathbf{f}(\hat{\theta}^{(j)})\bigr] \\
&amp;= \hat{\theta}^{(j)}
- \frac{1}{2} \bigl[\mathbf{F}(\hat{\theta}^{(j)})' \,\mathbf{F}(\hat{\theta}^{(j)})\bigr]^{-1}
\, \frac{\partial SSE(\hat{\theta}^{(j)})}{\partial \theta},
\end{aligned}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\frac{\partial SSE(\hat{\theta}^{(j)})}{\partial \theta}\)</span> is the <strong>gradient vector</strong>, pointing in the direction of <strong>steepest ascent</strong> of SSE.<br>
</li>
<li>
<span class="math inline">\(\bigl[\mathbf{F}(\hat{\theta}^{(j)})'\mathbf{F}(\hat{\theta}^{(j)})\bigr]^{-1}\)</span> determines the <strong>step size</strong>, controlling how far to move in the direction of improvement.<br>
</li>
<li>The factor <span class="math inline">\(-\tfrac{1}{2}\)</span> ensures movement in the <strong>direction of steepest descent</strong>, helping to <strong>minimize</strong> the SSE.</li>
</ul>
<p>The Gauss-Newton method works well when the nonlinear model can be approximated accurately by a <strong>first-order Taylor expansion</strong> near the solution. If the assumption of near-linearity in the residual function <span class="math inline">\(\mathbf{r}(\theta) = \mathbf{Y} - \mathbf{f}(\theta)\)</span> is violated, convergence may be slow or fail altogether. In such cases, more robust methods like <a href="non-linear-regression.html#levenberg-marquardt">Levenberg-Marquardt Algorithm</a> (which modifies Gauss-Newton with a damping parameter) are often preferred.</p>
<hr>
<div class="sourceCode" id="cb199"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">minpack.lm</span><span class="op">)</span>  <span class="co"># Provides nonlinear least squares functions</span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (exponential model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># theta is a vector of parameters: theta[1] = A, theta[2] = B</span></span>
<span>    <span class="co"># x is the independent variable</span></span>
<span>    <span class="co"># The model is A * exp(B * x)</span></span>
<span>    <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define SSE function for clarity</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># SSE = sum of squared errors between actual y and model predictions</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>                     <span class="co"># for reproducibility</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># 100 points from 0 to 10</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span><span class="op">)</span>           <span class="co"># true parameter values</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display the first few data points</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;           x        y</span></span>
<span><span class="co">#&gt; 1 0.0000000 1.719762</span></span>
<span><span class="co">#&gt; 2 0.1010101 1.946445</span></span>
<span><span class="co">#&gt; 3 0.2020202 2.904315</span></span>
<span><span class="co">#&gt; 4 0.3030303 2.225593</span></span>
<span><span class="co">#&gt; 5 0.4040404 2.322373</span></span>
<span><span class="co">#&gt; 6 0.5050505 3.184724</span></span>
<span></span>
<span><span class="co"># Gauss-Newton optimization using nls.lm (Levenberg-Marquardt as extension).</span></span>
<span><span class="co"># Initial guess for theta: c(1, 0.1)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minpack.lm/man/nls.lm.html">nls.lm</a></span><span class="op">(</span></span>
<span>    par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>        <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B):</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.9934188 0.3008742</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>We defined the model “nonlinear_model(theta, x)” which returns A<em>exp(B</em>x).</li>
<li>We generated synthetic data using the “true_theta” values and added random noise.</li>
<li>We used <code>nls.lm(...)</code> from the <code>minpack.lm</code> package to fit the data:
<ul>
<li>
<code>par = c(1, 0.1)</code> is our initial parameter guess.</li>
<li>
<code>fn = function(theta) y - nonlinear_model(theta, x)</code> is the residual function, i.e., observed minus predicted.</li>
</ul>
</li>
<li>The <code>fit$par</code> provides the estimated parameters after the algorithm converges.</li>
</ol>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize the data and the fitted model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Data and Fitted Curve (Gauss-Newton/Levenberg-Marquardt)"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>  <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">par</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  to <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">"topleft"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-2-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="modified-gauss-newton-algorithm" class="section level4" number="6.2.1.2">
<h4>
<span class="header-section-number">6.2.1.2</span> Modified Gauss-Newton Algorithm<a class="anchor" aria-label="anchor" href="#modified-gauss-newton-algorithm"><i class="fas fa-link"></i></a>
</h4>
<p>The Modified Gauss-Newton Algorithm introduces a learning rate <span class="math inline">\(\alpha_j\)</span> to control step size and prevent overshooting the local minimum. The standard <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a> assumes that the full step direction <span class="math inline">\(\hat{\delta}^{(j+1)}\)</span> is optimal, but in practice, especially for highly nonlinear problems, it can overstep the minimum or cause numerical instability. The modification introduces a step size reduction, making it more robust.</p>
<p>We redefine the update step as:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} + \alpha_j \hat{\delta}^{(j+1)}, \quad 0 &lt; \alpha_j &lt; 1,
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\alpha_j\)</span> is a <strong>learning rate</strong>, controlling how much of the step <span class="math inline">\(\hat{\delta}^{(j+1)}\)</span> is taken.</li>
<li>If <span class="math inline">\(\alpha_j = 1\)</span>, we recover the standard Gauss-Newton method.</li>
<li>If <span class="math inline">\(\alpha_j\)</span> is too small, convergence is slow; if too large, the algorithm may diverge.</li>
</ul>
<p>This learning rate <span class="math inline">\(\alpha_j\)</span> allows for <strong>adaptive step size adjustments</strong>, helping prevent excessive parameter jumps and ensuring that SSE decreases at each iteration.</p>
<hr>
<p>A common approach to determine <span class="math inline">\(\alpha_j\)</span> is <strong>step halving</strong>, ensuring that each iteration moves in a direction that reduces SSE. Instead of using a fixed <span class="math inline">\(\alpha_j\)</span>, we iteratively reduce the step size until SSE decreases:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} + \frac{1}{2^k}\hat{\delta}^{(j+1)},
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(k\)</span> is the smallest non-negative integer such that</li>
</ul>
<p><span class="math display">\[
SSE(\hat{\theta}^{(j)} + \frac{1}{2^k} \hat{\delta}^{(j+1)}) &lt; SSE(\hat{\theta}^{(j)}).
\]</span></p>
<p>This means we start with the full step <span class="math inline">\(\hat{\delta}^{(j+1)}\)</span>, then try <span class="math inline">\(\hat{\delta}^{(j+1)}/2\)</span>, then <span class="math inline">\(\hat{\delta}^{(j+1)}/4\)</span>, and so on, until SSE is reduced.</p>
<p><strong>Algorithm for Step Halving:</strong></p>
<ol style="list-style-type: decimal">
<li>Compute the Gauss-Newton step <span class="math inline">\(\hat{\delta}^{(j+1)}\)</span>.</li>
<li>Set an initial <span class="math inline">\(\alpha_j = 1\)</span>.</li>
<li>If the updated parameters <span class="math inline">\(\hat{\theta}^{(j)} + \alpha_j \hat{\delta}^{(j+1)}\)</span> increase SSE, divide <span class="math inline">\(\alpha_j\)</span> by 2.</li>
<li>Repeat until SSE decreases.</li>
</ol>
<p>This <strong>ensures monotonic SSE reduction</strong>, preventing divergence due to an overly aggressive step.</p>
<hr>
<p><strong>Generalized Form of the Modified Algorithm</strong></p>
<p>A more general form of the update rule, incorporating step size control and a matrix <span class="math inline">\(\mathbf{A}_j\)</span>, is:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j \mathbf{A}_j \frac{\partial Q(\hat{\theta}^{(j)})}{\partial \theta},
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{A}_j\)</span> is a <strong>positive definite matrix</strong> that preconditions the update direction.</li>
<li>
<span class="math inline">\(\alpha_j\)</span> is the <strong>learning rate</strong>.</li>
<li>
<span class="math inline">\(\frac{\partial Q(\hat{\theta}^{(j)})}{\partial \theta}\)</span> is the <strong>gradient</strong> of the objective function <span class="math inline">\(Q(\theta)\)</span>, typically SSE in nonlinear regression.</li>
</ul>
<hr>
<p><strong>Connection to the Modified Gauss-Newton Algorithm</strong></p>
<p>The <strong>Modified Gauss-Newton Algorithm</strong> fits this framework:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j [\mathbf{F}(\hat{\theta}^{(j)})' \mathbf{F}(\hat{\theta}^{(j)})]^{-1} \frac{\partial SSE(\hat{\theta}^{(j)})}{\partial \theta}.
\]</span></p>
<p>Here, we recognize:</p>
<ul>
<li>
<strong>Objective function</strong>: <span class="math inline">\(Q = SSE\)</span>.</li>
<li>
<strong>Preconditioner matrix</strong>: <span class="math inline">\([\mathbf{F}(\hat{\theta}^{(j)})' \mathbf{F}(\hat{\theta}^{(j)})]^{-1} = \mathbf{A}\)</span>.</li>
</ul>
<p>Thus, the standard Gauss-Newton method can be interpreted as a special case of this broader optimization framework, with a preconditioned gradient descent approach.</p>
<hr>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">minpack.lm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (exponential model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Gauss-Newton with Step Halving</span></span>
<span><span class="va">gauss_newton_modified</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">theta_init</span>,</span>
<span>           <span class="va">x</span>,</span>
<span>           <span class="va">y</span>,</span>
<span>           <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>           <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_init</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Compute Jacobian matrix numerically</span></span>
<span>      <span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span>      <span class="va">F_matrix</span> <span class="op">&lt;-</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta_perturb</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>        <span class="va">theta_perturb</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span>        <span class="va">F_matrix</span><span class="op">[</span>, <span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>          <span class="op">(</span><span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta_perturb</span>, <span class="va">x</span><span class="op">)</span><span class="op">-</span><span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="va">epsilon</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="co"># Compute residuals</span></span>
<span>      <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># Compute Gauss-Newton step</span></span>
<span>      <span class="va">delta</span> <span class="op">&lt;-</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">F_matrix</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">F_matrix</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">F_matrix</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">residuals</span></span>
<span>      </span>
<span>      <span class="co"># Step Halving Implementation</span></span>
<span>      <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>      <span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>      <span class="kw">while</span> <span class="op">(</span><span class="fu">sse</span><span class="op">(</span><span class="va">theta</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">delta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span>
<span>             <span class="va">k</span> <span class="op">&lt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>        <span class="va">k</span> <span class="op">&lt;-</span> <span class="va">k</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="co"># Update theta</span></span>
<span>      <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">delta</span></span>
<span>      </span>
<span>      <span class="co"># Check for convergence</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw">break</span></span>
<span>      <span class="op">}</span></span>
<span>      </span>
<span>      <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># Run Modified Gauss-Newton Algorithm</span></span>
<span><span class="va">theta_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Initial parameter guess</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">gauss_newton_modified</span><span class="op">(</span><span class="va">theta_init</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B) with Modified Gauss-Newton:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B) with Modified Gauss-Newton:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,] 1.9934188</span></span>
<span><span class="co">#&gt; [2,] 0.3008742</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Modified Gauss-Newton: Data &amp; Fitted Curve"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>  <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  from <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  to <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">"topleft"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-3-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="steepest-descent" class="section level4" number="6.2.1.3">
<h4>
<span class="header-section-number">6.2.1.3</span> Steepest Descent (Gradient Descent)<a class="anchor" aria-label="anchor" href="#steepest-descent"><i class="fas fa-link"></i></a>
</h4>
<p>The Steepest Descent Method, commonly known as Gradient Descent, is a fundamental iterative optimization technique used for finding parameter estimates that minimize an objective function <span class="math inline">\(\mathbf{Q}(\theta)\)</span>. It is a special case of the <a href="non-linear-regression.html#modified-gauss-newton-algorithm">Modified Gauss-Newton Algorithm</a>, where the preconditioning matrix <span class="math inline">\(\mathbf{A}_j\)</span> is replaced by the identity matrix.</p>
<p>The update rule is given by:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j \mathbf{I}_{p \times p}\frac{\partial \mathbf{Q}(\hat{\theta}^{(j)})}{\partial \theta},
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\alpha_j\)</span> is the <strong>learning rate</strong>, determining the step size.</li>
<li>
<span class="math inline">\(\mathbf{I}_{p \times p}\)</span> is the <strong>identity matrix</strong>, meaning updates occur in the direction of the <strong>negative gradient</strong>.</li>
<li>
<span class="math inline">\(\frac{\partial \mathbf{Q}(\hat{\theta}^{(j)})}{\partial \theta}\)</span> is the <strong>gradient vector</strong>, which provides the direction of <strong>steepest ascent</strong>; its negation ensures movement toward the minimum.</li>
</ul>
<p>Characteristics of Steepest Descent</p>
<ul>
<li>
<strong>Slow to converge:</strong> The algorithm moves in the direction of the gradient but does not take into account curvature, which may result in slow convergence, especially in ill-conditioned problems.</li>
<li>
<strong>Moves rapidly initially:</strong> The method can exhibit <strong>fast initial progress</strong>, but as it approaches the minimum, step sizes become small, leading to slow convergence.</li>
<li>
<strong>Useful for initialization:</strong> Due to its simplicity and ease of implementation, it is often used to obtain <strong>starting values</strong> for more advanced methods like <strong>Newton’s method</strong> or <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a>.</li>
</ul>
<hr>
<p>Comparison with Gauss-Newton</p>
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="20%">
<col width="38%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Update Rule</th>
<th>Advantages</th>
<th>Disadvantages</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Steepest Descent</strong></td>
<td><span class="math inline">\(\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j \mathbf{I} \nabla Q(\theta)\)</span></td>
<td>Simple, requires only first derivatives</td>
<td>Slow convergence, sensitive to <span class="math inline">\(\alpha_j\)</span>
</td>
</tr>
<tr class="even">
<td><strong>Gauss-Newton</strong></td>
<td><span class="math inline">\(\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \mathbf{H}^{-1} \nabla Q(\theta)\)</span></td>
<td>Uses curvature, faster near solution</td>
<td>Requires Jacobian computation, may diverge</td>
</tr>
</tbody>
</table></div>
<p>The <strong>key difference</strong> is that Steepest Descent <strong>only</strong> considers the gradient direction, while Gauss-Newton and Newton’s method incorporate curvature information.</p>
<hr>
<p>Choosing the Learning Rate <span class="math inline">\(\alpha_j\)</span></p>
<p>A well-chosen <strong>learning rate</strong> is crucial for the success of gradient descent:</p>
<ul>
<li>
<strong>Too large</strong>: The algorithm may overshoot the minimum and diverge.</li>
<li>
<strong>Too small</strong>: Convergence is <strong>very slow</strong>.</li>
<li>
<strong>Adaptive strategies</strong>:
<ul>
<li>
<strong>Fixed step size</strong>: <span class="math inline">\(\alpha_j\)</span> is constant.</li>
<li>
<strong>Step size decay</strong>: <span class="math inline">\(\alpha_j\)</span> decreases over iterations (e.g., <span class="math inline">\(\alpha_j = \frac{1}{j}\)</span>).</li>
<li>
<strong>Line search</strong>: Choose <span class="math inline">\(\alpha_j\)</span> by minimizing <span class="math inline">\(\mathbf{Q}(\theta^{(j+1)})\)</span> along the gradient direction.</li>
</ul>
</li>
</ul>
<p>A common approach is <strong>backtracking line search</strong>, where <span class="math inline">\(\alpha_j\)</span> is reduced iteratively until a decrease in <span class="math inline">\(\mathbf{Q}(\theta)\)</span> is observed.</p>
<hr>
<div class="sourceCode" id="cb202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define the nonlinear function (exponential model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define Gradient of SSE w.r.t theta (computed numerically)</span></span>
<span><span class="va">gradient_sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Partial derivative w.r.t theta_1</span></span>
<span>    <span class="va">grad_1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Partial derivative w.r.t theta_2</span></span>
<span>    <span class="va">grad_2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">grad_1</span>, <span class="va">grad_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Safe Gradient Descent Implementation</span></span>
<span><span class="va">gradient_descent</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">theta_init</span>,</span>
<span>             <span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_init</span></span>
<span>        <span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu">gradient_sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Check for NaN or Inf values in the gradient (prevents divergence)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">grad</span><span class="op">)</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.infinite</a></span><span class="op">(</span><span class="va">grad</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Numerical instability detected at iteration"</span>,</span>
<span>                    <span class="va">j</span>,</span>
<span>                    <span class="st">"\n"</span><span class="op">)</span></span>
<span>                <span class="kw">break</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Update step</span></span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">grad</span></span>
<span>            <span class="va">sse_values</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta_new</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Check for convergence</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html">is.finite</a></span><span class="op">(</span><span class="va">sse_values</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Divergence detected at iteration"</span>, <span class="va">j</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>                <span class="kw">break</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Converged in"</span>, <span class="va">j</span>, <span class="st">"iterations.\n"</span><span class="op">)</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta_new</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Run Gradient Descent with a Safe Implementation</span></span>
<span><span class="va">theta_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Initial guess</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.001</span>           <span class="co"># Learning rate</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">gradient_descent</span><span class="op">(</span><span class="va">theta_init</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt; Divergence detected at iteration 1</span></span>
<span></span>
<span><span class="co"># Extract results</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">theta</span></span>
<span><span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">sse_values</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B) using Gradient Descent:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B) using Gradient Descent:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.0 0.1</span></span>
<span></span>
<span><span class="co"># Plot convergence of SSE over iterations</span></span>
<span><span class="co"># Ensure sse_values has valid data</span></span>
<span><span class="va">sse_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">sse_values</span><span class="op">)</span>,</span>
<span>  SSE <span class="op">=</span> <span class="va">sse_values</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate improved plot using ggplot()</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sse_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iteration</span>, y <span class="op">=</span> <span class="va">SSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Gradient Descent Convergence"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Iteration"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"SSE"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-4-1.png" width="90%" style="display: block; margin: auto;"></div>
<ol style="list-style-type: decimal">
<li>
<a href="non-linear-regression.html#steepest-descent">Steepest Descent (Gradient Descent)</a> moves in the direction of steepest descent, which can lead to zigzagging behavior.</li>
<li>Slow convergence occurs when the curvature of the function varies significantly across dimensions.</li>
<li>Learning rate tuning is critical:
<ul>
<li><p>If too large, the algorithm diverges.</p></li>
<li><p>If too small, progress is very slow.</p></li>
</ul>
</li>
<li>Useful for initialization: It is often used to get close to the optimal solution before switching to more advanced methods like <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a> or Newton’s method.</li>
</ol>
<p>Several advanced techniques improve the performance of steepest descent:</p>
<ul>
<li><p><strong>Momentum Gradient Descent</strong>: Adds a momentum term to smooth updates, reducing oscillations.</p></li>
<li>
<p><strong>Adaptive Learning Rates</strong>:</p>
<ul>
<li><p>AdaGrad: Adjusts <span class="math inline">\(\alpha_j\)</span> per parameter based on historical gradients.</p></li>
<li><p>RMSprop: Uses a moving average of past gradients to scale updates.</p></li>
<li><p>Adam (Adaptive Moment Estimation): Combines momentum and adaptive learning rates.</p></li>
</ul>
</li>
</ul>
<p>In practice, Adam is widely used in machine learning and deep learning, while Newton-based methods (including Gauss-Newton) are preferred for nonlinear regression.</p>
</div>
<div id="levenberg-marquardt" class="section level4" number="6.2.1.4">
<h4>
<span class="header-section-number">6.2.1.4</span> Levenberg-Marquardt Algorithm<a class="anchor" aria-label="anchor" href="#levenberg-marquardt"><i class="fas fa-link"></i></a>
</h4>
<p>The Levenberg-Marquardt Algorithm is a widely used optimization method for solving nonlinear least squares problems. It is an adaptive technique that blends the <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a> and <a href="non-linear-regression.html#steepest-descent">Steepest Descent (Gradient Descent)</a>, dynamically switching between them based on problem conditions.</p>
<p>The update rule is:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j [\mathbf{F}(\hat{\theta}^{(j)})' \mathbf{F}(\hat{\theta}^{(j)}) + \tau \mathbf{I}_{p \times p}]\frac{\partial \mathbf{Q}(\hat{\theta}^{(j)})}{\partial \theta}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\tau\)</span> is the <strong>damping parameter</strong>, controlling whether the step behaves like <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a> or <a href="non-linear-regression.html#steepest-descent">Steepest Descent (Gradient Descent)</a>.</li>
<li>
<span class="math inline">\(\mathbf{I}_{p \times p}\)</span> is the <strong>identity matrix</strong>, ensuring numerical stability.</li>
<li>
<span class="math inline">\(\mathbf{F}(\hat{\theta}^{(j)})\)</span> is the <strong>Jacobian matrix</strong> of partial derivatives.</li>
<li>
<span class="math inline">\(\frac{\partial \mathbf{Q}(\hat{\theta}^{(j)})}{\partial \theta}\)</span> is the <strong>gradient vector</strong>.</li>
<li>
<span class="math inline">\(\alpha_j\)</span> is the <strong>learning rate</strong>, determining step size.</li>
</ul>
<p>The Levenberg-Marquardt algorithm is particularly useful when the Jacobian matrix <span class="math inline">\(\mathbf{F}(\hat{\theta}^{(j)})\)</span> is nearly singular, meaning that <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a> alone may fail.</p>
<ul>
<li>When <span class="math inline">\(\tau\)</span> is large, the method behaves like Steepest Descent, ensuring stability.</li>
<li>When <span class="math inline">\(\tau\)</span> is small, it behaves like Gauss-Newton, accelerating convergence.</li>
<li>Adaptive control of <span class="math inline">\(\tau\)</span>:
<ul>
<li>If <span class="math inline">\(SSE(\hat{\theta}^{(j+1)}) &lt; SSE(\hat{\theta}^{(j)})\)</span>, reduce <span class="math inline">\(\tau\)</span>: <span class="math display">\[
\tau \gets \tau / 10
\]</span>
</li>
<li>Otherwise, increase <span class="math inline">\(\tau\)</span> to stabilize: <span class="math display">\[
\tau \gets 10\tau
\]</span>
</li>
</ul>
</li>
</ul>
<p>This adjustment ensures that the algorithm moves efficiently while avoiding instability.</p>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">minpack.lm</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (exponential model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define SSE function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Robust Levenberg-Marquardt Optimization Implementation</span></span>
<span><span class="va">levenberg_marquardt</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">theta_init</span>,</span>
<span>             <span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">500</span>,</span>
<span>             <span class="va">tau_init</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_init</span></span>
<span>        <span class="va">tau</span> <span class="op">&lt;-</span> <span class="va">tau_init</span></span>
<span>        <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">1e-8</span>  <span class="co"># Small regularization term</span></span>
<span>        <span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="co"># Compute Jacobian matrix numerically</span></span>
<span>            <span class="va">epsilon</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span>            <span class="va">F_matrix</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">theta_perturb</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>                <span class="va">theta_perturb</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">+</span> <span class="va">epsilon</span></span>
<span>                <span class="va">F_matrix</span><span class="op">[</span>, <span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>                    <span class="op">(</span><span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta_perturb</span>, <span class="va">x</span><span class="op">)</span> </span>
<span>                     <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">epsilon</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Compute residuals</span></span>
<span>            <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Compute Levenberg-Marquardt update</span></span>
<span>            <span class="va">A</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">F_matrix</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">F_matrix</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> </span>
<span>            <span class="op">+</span> <span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Regularized A</span></span>
<span>            <span class="va">delta</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">F_matrix</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">residuals</span>,</span>
<span>                error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Singular matrix detected at iteration"</span>,</span>
<span>                        <span class="va">j</span>,</span>
<span>                        <span class="st">"- Increasing tau\n"</span><span class="op">)</span></span>
<span>                    <span class="va">tau</span> <span class="op">&lt;&lt;-</span> <span class="va">tau</span> <span class="op">*</span> <span class="fl">10</span>  <span class="co"># Increase tau to stabilize</span></span>
<span>                    <span class="co"># Return zero delta to avoid NaN updates</span></span>
<span>                    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  </span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">)</span></span>
<span>            </span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">+</span> <span class="va">delta</span></span>
<span>            </span>
<span>            <span class="co"># Compute new SSE</span></span>
<span>            <span class="va">sse_values</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta_new</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Adjust tau dynamically</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">sse_values</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="co"># Reduce tau but prevent it from going too low</span></span>
<span>                <span class="va">tau</span> <span class="op">&lt;-</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">tau</span> <span class="op">/</span> <span class="fl">10</span>, <span class="fl">1e-8</span><span class="op">)</span>  </span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                <span class="va">tau</span> <span class="op">&lt;-</span> <span class="va">tau</span> <span class="op">*</span> <span class="fl">10</span>  <span class="co"># Increase tau if SSE increases</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Check for convergence</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Converged in"</span>, <span class="va">j</span>, <span class="st">"iterations.\n"</span><span class="op">)</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta_new</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Run Levenberg-Marquardt</span></span>
<span><span class="va">theta_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Initial guess</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">levenberg_marquardt</span><span class="op">(</span><span class="va">theta_init</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; Singular matrix detected at iteration 11 - Increasing tau</span></span>
<span><span class="co">#&gt; Converged in 11 iterations.</span></span>
<span></span>
<span><span class="co"># Extract results</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">theta</span></span>
<span><span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">sse_values</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B) using Levenberg-Marquardt:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B) using Levenberg-Marquardt:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt;               [,1]</span></span>
<span><span class="co">#&gt; [1,] -6.473440e-09</span></span>
<span><span class="co">#&gt; [2,]  1.120637e+01</span></span>
<span></span>
<span><span class="co"># Plot convergence of SSE over iterations</span></span>
<span><span class="va">sse_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">sse_values</span><span class="op">)</span>, SSE <span class="op">=</span> <span class="va">sse_values</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sse_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iteration</span>, y <span class="op">=</span> <span class="va">SSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, linewidth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Levenberg-Marquardt Convergence"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Iteration"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"SSE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-5-1.png" width="90%" style="display: block; margin: auto;"></div>
<ul>
<li>
<p>Early Stability (Flat SSE)</p>
<ul>
<li><p>The SSE remains near zero for the first few iterations, which suggests that the algorithm is initially behaving stably.</p></li>
<li><p>This might indicate that the initial parameter guess is reasonable, or that the updates are too small to significantly affect SSE.</p></li>
</ul>
</li>
<li>
<p>Sudden Explosion in SSE (Iteration ~8-9)</p>
<ul>
<li><p>The sharp spike in SSE at iteration 9 indicates a numerical instability or divergence in the optimization process.</p></li>
<li>
<p>This could be due to:</p>
<ul>
<li><p>An ill-conditioned Jacobian matrix: The step direction is poorly estimated, leading to an unstable jump.</p></li>
<li><p>A sudden large update (<code>delta</code>): The damping parameter (<code>tau</code>) might have been reduced too aggressively, causing an uncontrolled step.</p></li>
<li><p>Floating-point issues: If <code>A</code> becomes nearly singular, solving <code>A \ delta = residuals</code> may produce excessively large values.</p></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Return to Stability (After Iteration 9)</p>
<ul>
<li><p>The SSE immediately returns to a low value after the spike, which suggests that the damping parameter (<code>tau</code>) might have been increased after detecting instability.</p></li>
<li>
<p>This is consistent with the adaptive nature of Levenberg-Marquardt:</p>
<ul>
<li><p>If a step leads to a bad SSE increase, the algorithm increases <code>tau</code> to make the next step more conservative.</p></li>
<li><p>If the next step stabilizes, <code>tau</code> may be reduced again.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div id="newton-raphson" class="section level4" number="6.2.1.5">
<h4>
<span class="header-section-number">6.2.1.5</span> Newton-Raphson Algorithm<a class="anchor" aria-label="anchor" href="#newton-raphson"><i class="fas fa-link"></i></a>
</h4>
<p>The Newton-Raphson method is a second-order optimization technique used for nonlinear least squares problems. Unlike first-order methods (such as <a href="non-linear-regression.html#steepest-descent">Steepest Descent (Gradient Descent)</a> and <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a>), Newton-Raphson uses both first and second derivatives of the objective function for faster convergence.</p>
<p>The update rule is:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j \left[\frac{\partial^2 Q(\hat{\theta}^{(j)})}{\partial \theta \partial \theta'}\right]^{-1} \frac{\partial Q(\hat{\theta}^{(j)})}{\partial \theta}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\frac{\partial Q(\hat{\theta}^{(j)})}{\partial \theta}\)</span> is the <strong>gradient vector</strong> (first derivative of the objective function).</li>
<li>
<span class="math inline">\(\frac{\partial^2 Q(\hat{\theta}^{(j)})}{\partial \theta \partial \theta'}\)</span> is the <strong>Hessian matrix</strong> (second derivative of the objective function).</li>
<li>
<span class="math inline">\(\alpha_j\)</span> is the <strong>learning rate</strong>, controlling step size.</li>
</ul>
<p>The <strong>Hessian matrix</strong> in nonlinear least squares problems is:</p>
<p><span class="math display">\[
\frac{\partial^2 Q(\hat{\theta}^{(j)})}{\partial \theta \partial \theta'} = 2 \mathbf{F}(\hat{\theta}^{(j)})' \mathbf{F}(\hat{\theta}^{(j)}) - 2\sum_{i=1}^{n} [Y_i - f(x_i;\theta)] \frac{\partial^2 f(x_i;\theta)}{\partial \theta \partial \theta'}
\]</span></p>
<p>where:</p>
<ul>
<li>The first term <span class="math inline">\(2 \mathbf{F}(\hat{\theta}^{(j)})' \mathbf{F}(\hat{\theta}^{(j)})\)</span> is the same as in the <a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a>.</li>
<li>The second term <span class="math inline">\(-2\sum_{i=1}^{n} [Y_i - f(x_i;\theta)] \frac{\partial^2 f(x_i;\theta)}{\partial \theta \partial \theta'}\)</span> contains second-order derivatives.</li>
</ul>
<p><strong>Key Observations</strong></p>
<ul>
<li>Gauss-Newton vs. Newton-Raphson:
<ul>
<li>Gauss-Newton approximates the Hessian by ignoring the second term.</li>
<li>Newton-Raphson explicitly incorporates second-order derivatives, making it more precise but computationally expensive.</li>
</ul>
</li>
<li>Challenges:
<ul>
<li>The Hessian matrix may be singular, making it impossible to invert.</li>
<li>Computing second derivatives is often difficult for complex functions.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (exponential model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define SSE function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute Gradient (First Derivative) of SSE</span></span>
<span><span class="va">gradient_sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Partial derivative w.r.t theta_1</span></span>
<span>    <span class="va">grad_1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Partial derivative w.r.t theta_2</span></span>
<span>    <span class="va">grad_2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">grad_1</span>, <span class="va">grad_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute Hessian (Second Derivative) of SSE</span></span>
<span><span class="va">hessian_sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Compute second derivatives</span></span>
<span>    <span class="va">H_11</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">H_12</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">H_21</span> <span class="op">&lt;-</span> <span class="va">H_12</span></span>
<span>    </span>
<span>    <span class="va">term1</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">term2</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">H_22</span> <span class="op">&lt;-</span> <span class="va">term1</span> <span class="op">-</span> <span class="va">term2</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">H_11</span>, <span class="va">H_12</span>, <span class="va">H_21</span>, <span class="va">H_22</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Newton-Raphson Optimization Implementation</span></span>
<span><span class="va">newton_raphson</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">theta_init</span>,</span>
<span>             <span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_init</span></span>
<span>        <span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu">gradient_sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            <span class="va">hessian</span> <span class="op">&lt;-</span> <span class="fu">hessian_sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Check if Hessian is invertible</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Matrix-class.html">det</a></span><span class="op">(</span><span class="va">hessian</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Hessian is singular at iteration"</span>,</span>
<span>                    <span class="va">j</span>,</span>
<span>                    <span class="st">"- Using identity matrix instead.\n"</span><span class="op">)</span></span>
<span>                <span class="co"># Replace with identity matrix if singular</span></span>
<span>                <span class="va">hessian</span> <span class="op">&lt;-</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span>  </span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Compute Newton update</span></span>
<span>            <span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">hessian</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">grad</span></span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">-</span> <span class="va">delta</span></span>
<span>            <span class="va">sse_values</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta_new</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Check for convergence</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Converged in"</span>, <span class="va">j</span>, <span class="st">"iterations.\n"</span><span class="op">)</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta_new</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Run Newton-Raphson</span></span>
<span><span class="va">theta_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Initial guess</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">newton_raphson</span><span class="op">(</span><span class="va">theta_init</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; Converged in 222 iterations.</span></span>
<span></span>
<span><span class="co"># Extract results</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">theta</span></span>
<span><span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">sse_values</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B) using Newton-Raphson:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B) using Newton-Raphson:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]</span></span>
<span><span class="co">#&gt; [1,] 1.9934188</span></span>
<span><span class="co">#&gt; [2,] 0.3008742</span></span>
<span></span>
<span><span class="co"># Plot convergence of SSE over iterations</span></span>
<span><span class="va">sse_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">sse_values</span><span class="op">)</span>, SSE <span class="op">=</span> <span class="va">sse_values</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sse_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iteration</span>, y <span class="op">=</span> <span class="va">SSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Newton-Raphson Convergence"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Iteration"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"SSE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-6-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="quasi-newton-method" class="section level4" number="6.2.1.6">
<h4>
<span class="header-section-number">6.2.1.6</span> Quasi-Newton Method<a class="anchor" aria-label="anchor" href="#quasi-newton-method"><i class="fas fa-link"></i></a>
</h4>
<p>The Quasi-Newton method is an optimization technique that approximates Newton’s method without requiring explicit computation of the Hessian matrix. Instead, it iteratively constructs an approximation <span class="math inline">\(\mathbf{H}_j\)</span> to the Hessian based on the first derivative information.</p>
<p>The update rule is:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j \mathbf{H}_j^{-1}\frac{\partial \mathbf{Q}(\hat{\theta}^{(j)})}{\partial \theta}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{H}_j\)</span> is a <strong>symmetric positive definite approximation</strong> to the <strong>Hessian matrix</strong>.</li>
<li>As <span class="math inline">\(j \to \infty\)</span>, <span class="math inline">\(\mathbf{H}_j\)</span> gets closer to the <strong>true Hessian</strong>.</li>
<li>
<span class="math inline">\(\frac{\partial Q(\hat{\theta}^{(j)})}{\partial \theta}\)</span> is the <strong>gradient vector</strong>.</li>
<li>
<span class="math inline">\(\alpha_j\)</span> is the <strong>learning rate</strong>, controlling step size.</li>
</ul>
<p>Why Use Quasi-Newton Instead of <a href="non-linear-regression.html#newton-raphson">Newton-Raphson Method</a>?</p>
<ul>
<li>Newton-Raphson requires computing the Hessian matrix explicitly, which is computationally expensive and may be singular.</li>
<li>Quasi-Newton avoids computing the Hessian directly by approximating it iteratively.</li>
<li>Among first-order methods (which only require gradients, not Hessians), Quasi-Newton methods perform best.</li>
</ul>
<hr>
<p><strong>Hessian Approximation</strong></p>
<p>Instead of directly computing the Hessian <span class="math inline">\(\mathbf{H}_j\)</span>, Quasi-Newton methods update an approximation <span class="math inline">\(\mathbf{H}_j\)</span> iteratively.</p>
<p>One of the most widely used formulas is the <strong>Broyden-Fletcher-Goldfarb-Shanno (BFGS) update</strong>:</p>
<p><span class="math display">\[
\mathbf{H}_{j+1} = \mathbf{H}_j + \frac{(\mathbf{s}_j \mathbf{s}_j')}{\mathbf{s}_j' \mathbf{y}_j} - \frac{\mathbf{H}_j \mathbf{y}_j \mathbf{y}_j' \mathbf{H}_j}{\mathbf{y}_j' \mathbf{H}_j \mathbf{y}_j}
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\mathbf{s}_j = \hat{\theta}^{(j+1)} - \hat{\theta}^{(j)}\)</span> (change in parameters).</li>
<li>
<span class="math inline">\(\mathbf{y}_j = \nabla Q(\hat{\theta}^{(j+1)}) - \nabla Q(\hat{\theta}^{(j)})\)</span> (change in gradient).</li>
<li>
<span class="math inline">\(\mathbf{H}_j\)</span> is the current <strong>inverse Hessian approximation</strong>.</li>
</ul>
<hr>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (exponential model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define SSE function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run BFGS Optimization using `optim()`</span></span>
<span><span class="va">theta_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Initial guess</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span></span>
<span>    par <span class="op">=</span> <span class="va">theta_init</span>,</span>
<span>    fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>,  <span class="co"># Minimize SSE</span></span>
<span>    method <span class="op">=</span> <span class="st">"BFGS"</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>  <span class="co"># Suppress optimization progress</span></span>
<span>    <span class="co"># control = list(trace = 1, REPORT = 1)  # Print optimization progress</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract results</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="va">sse_final</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">value</span></span>
<span><span class="va">convergence_status</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">convergence</span>  <span class="co"># 0 means successful convergence</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\n=== Optimization Results ===\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === Optimization Results ===</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B) using Quasi-Newton BFGS:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B) using Quasi-Newton BFGS:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.9954216 0.3007569</span></span>
<span></span>
<span><span class="co"># Display final SSE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nFinal SSE:"</span>, <span class="va">sse_final</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Final SSE: 20.3227</span></span></code></pre></div>
</div>
<div id="trust-region-reflective-algorithm" class="section level4" number="6.2.1.7">
<h4>
<span class="header-section-number">6.2.1.7</span> Trust-Region Reflective Algorithm<a class="anchor" aria-label="anchor" href="#trust-region-reflective-algorithm"><i class="fas fa-link"></i></a>
</h4>
<p>The Trust-Region Reflective (TRR) algorithm is an optimization technique used for nonlinear least squares problems. Unlike Newton’s method and gradient-based approaches, TRR dynamically restricts updates to a trust region, ensuring stability and preventing overshooting.</p>
<p>The goal is to minimize the objective function <span class="math inline">\(Q(\theta)\)</span> (e.g., Sum of Squared Errors, SSE):</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} Q(\theta)
\]</span></p>
<p>Instead of taking a full Newton step, TRR solves the following <strong>quadratic subproblem</strong>:</p>
<p><span class="math display">\[
\min_{\delta} m_j(\delta) = Q(\hat{\theta}^{(j)}) + \nabla Q(\hat{\theta}^{(j)})' \delta + \frac{1}{2} \delta' \mathbf{H}_j \delta
\]</span></p>
<p>subject to:</p>
<p><span class="math display">\[
\|\delta\| \leq \Delta_j
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\mathbf{H}_j\)</span> is an <strong>approximation of the Hessian matrix</strong>.</p></li>
<li><p><span class="math inline">\(\nabla Q(\hat{\theta}^{(j)})\)</span> is the <strong>gradient vector</strong>.</p></li>
<li><p><span class="math inline">\(\Delta_j\)</span> is the <strong>trust-region radius</strong>, which is adjusted dynamically.</p></li>
</ul>
<hr>
<p><strong>Trust-Region Adjustments</strong></p>
<p>The algorithm <strong>modifies the step size dynamically</strong> based on the ratio <span class="math inline">\(\rho_j\)</span>:</p>
<p><span class="math display">\[
\rho_j = \frac{Q(\hat{\theta}^{(j)}) - Q(\hat{\theta}^{(j)} + \delta)}{m_j(0) - m_j(\delta)}
\]</span></p>
<ul>
<li><p><strong>If</strong> <span class="math inline">\(\rho_j &gt; 0.75\)</span> and <span class="math inline">\(\|\delta\| = \Delta_j\)</span>, then expand the trust region: <span class="math display">\[
\Delta_{j+1} = 2 \Delta_j
\]</span></p></li>
<li><p><strong>If</strong> <span class="math inline">\(\rho_j &lt; 0.25\)</span>, shrink the trust region: <span class="math display">\[
\Delta_{j+1} = \frac{1}{2} \Delta_j
\]</span></p></li>
<li><p><strong>If</strong> <span class="math inline">\(\rho_j &gt; 0\)</span>, accept the step; otherwise, reject it.</p></li>
</ul>
<p>If a step <strong>violates a constraint</strong>, it is <strong>reflected back</strong> into the feasible region:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \max(\hat{\theta}^{(j)} + \delta, \theta_{\min})
\]</span></p>
<p>This ensures that the optimization <strong>respects parameter bounds</strong>.</p>
<hr>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (exponential model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define SSE function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute Gradient (First Derivative) of SSE</span></span>
<span><span class="va">gradient_sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Partial derivative w.r.t theta_1</span></span>
<span>    <span class="va">grad_1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Partial derivative w.r.t theta_2</span></span>
<span>    <span class="va">grad_2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">grad_1</span>, <span class="va">grad_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Compute Hessian Approximation of SSE</span></span>
<span><span class="va">hessian_sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Compute second derivatives</span></span>
<span>    <span class="va">H_11</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">H_12</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">H_21</span> <span class="op">&lt;-</span> <span class="va">H_12</span></span>
<span>    </span>
<span>    <span class="va">term1</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">term2</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residuals</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">H_22</span> <span class="op">&lt;-</span> <span class="va">term1</span> <span class="op">-</span> <span class="va">term2</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">H_11</span>, <span class="va">H_12</span>, <span class="va">H_21</span>, <span class="va">H_22</span><span class="op">)</span>,</span>
<span>        nrow <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        byrow <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Manual Trust-Region Reflective Optimization Implementation</span></span>
<span><span class="va">trust_region_reflective</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">theta_init</span>,</span>
<span>             <span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">500</span>,</span>
<span>             <span class="va">delta_max</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_init</span></span>
<span>        <span class="va">delta_j</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># Initial trust-region size</span></span>
<span>        <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>        <span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu">gradient_sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            <span class="va">hessian</span> <span class="op">&lt;-</span> <span class="fu">hessian_sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Check if Hessian is invertible</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Matrix-class.html">det</a></span><span class="op">(</span><span class="va">hessian</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Hessian is singular at iteration"</span>,</span>
<span>                    <span class="va">j</span>,</span>
<span>                    <span class="st">"- Using identity matrix instead.\n"</span><span class="op">)</span></span>
<span>                <span class="va">hessian</span> <span class="op">&lt;-</span></span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>  <span class="co"># Replace with identity matrix if singular</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Compute Newton step</span></span>
<span>            <span class="va">delta_full</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">hessian</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">grad</span></span>
<span>            </span>
<span>            <span class="co"># Apply trust-region constraint</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">delta_full</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">&gt;</span> <span class="va">delta_j</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="co"># Scale step</span></span>
<span>                <span class="va">delta</span> <span class="op">&lt;-</span></span>
<span>                    <span class="op">(</span><span class="va">delta_j</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">delta_full</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">delta_full</span>  </span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                <span class="va">delta</span> <span class="op">&lt;-</span> <span class="va">delta_full</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Compute new theta and ensure it respects constraints</span></span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">theta</span> <span class="op">+</span> <span class="va">delta</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">-</span><span class="cn">Inf</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Reflect to lower bound</span></span>
<span>            <span class="va">sse_new</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta_new</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Compute agreement ratio (rho_j)</span></span>
<span>            <span class="va">predicted_reduction</span> <span class="op">&lt;-</span></span>
<span>                <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">grad</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">delta</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">hessian</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">delta</span></span>
<span>            <span class="va">actual_reduction</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="va">sse_new</span></span>
<span>            <span class="va">rho_j</span> <span class="op">&lt;-</span> <span class="va">actual_reduction</span> <span class="op">/</span> <span class="va">predicted_reduction</span></span>
<span>            </span>
<span>            <span class="co"># Adjust trust region size</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">rho_j</span> <span class="op">&lt;</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">delta_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">delta_j</span> <span class="op">/</span> <span class="fl">2</span>, <span class="fl">1e-4</span><span class="op">)</span>  <span class="co"># Shrink</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">rho_j</span> <span class="op">&gt;</span> <span class="fl">0.75</span> <span class="op">&amp;&amp;</span></span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">delta</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="va">delta_j</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">delta_j</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">delta_j</span>, <span class="va">delta_max</span><span class="op">)</span>  <span class="co"># Expand</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Accept or reject step</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">rho_j</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span>  <span class="co"># Accept step</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Step rejected at iteration"</span>, <span class="va">j</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="va">sse_values</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Check for convergence</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">delta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Converged in"</span>, <span class="va">j</span>, <span class="st">"iterations.\n"</span><span class="op">)</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">j</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta</span>, sse_values <span class="op">=</span> <span class="va">sse_values</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Run Manual Trust-Region Reflective Algorithm</span></span>
<span><span class="va">theta_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>  <span class="co"># Initial guess</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">trust_region_reflective</span><span class="op">(</span><span class="va">theta_init</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract results</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">theta</span></span>
<span><span class="va">sse_values</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">sse_values</span></span>
<span></span>
<span><span class="co"># Plot convergence of SSE over iterations</span></span>
<span><span class="va">sse_df</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Iteration <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">sse_values</span><span class="op">)</span>, SSE <span class="op">=</span> <span class="va">sse_values</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sse_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Iteration</span>, y <span class="op">=</span> <span class="va">SSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Trust-Region Reflective Convergence"</span>,</span>
<span>         x <span class="op">=</span> <span class="st">"Iteration"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"SSE"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-8-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="derivative-free" class="section level3" number="6.2.2">
<h3>
<span class="header-section-number">6.2.2</span> Derivative-Free<a class="anchor" aria-label="anchor" href="#derivative-free"><i class="fas fa-link"></i></a>
</h3>
<div id="secant-method" class="section level4" number="6.2.2.1">
<h4>
<span class="header-section-number">6.2.2.1</span> Secant Method<a class="anchor" aria-label="anchor" href="#secant-method"><i class="fas fa-link"></i></a>
</h4>
<p>The Secant Method is a root-finding algorithm that approximates the derivative using finite differences, making it a derivative-free alternative to Newton’s method. It is particularly useful when the exact gradient (or Jacobian in the case of optimization problems) is unavailable or expensive to compute.</p>
<p>In nonlinear optimization, we apply the Secant Method to iteratively refine parameter estimates without explicitly computing second-order derivatives.</p>
<hr>
<p>In one dimension, the Secant Method approximates the derivative as:</p>
<p><span class="math display">\[
f'(\theta) \approx \frac{f(\theta_{j}) - f(\theta_{j-1})}{\theta_{j} - \theta_{j-1}}.
\]</span></p>
<p>Using this approximation, the <strong>update step</strong> in the Secant Method follows:</p>
<p><span class="math display">\[
\theta_{j+1} = \theta_j - f(\theta_j) \frac{\theta_j - \theta_{j-1}}{f(\theta_j) - f(\theta_{j-1})}.
\]</span></p>
<p>Instead of computing the exact derivative (as in Newton’s method), we use the difference between the last two iterates to approximate it. This makes the Secant Method <strong>more efficient</strong> in cases where gradient computation is expensive or infeasible.</p>
<hr>
<p>In <strong>higher dimensions</strong>, the Secant Method extends to an approximate <a href="non-linear-regression.html#quasi-newton-method">Quasi-Newton Method</a>, often referred to as <strong>Broyden’s Method</strong>. We iteratively approximate the inverse Hessian matrix using past updates.</p>
<p>The update formula for a vector-valued function <span class="math inline">\(F(\theta)\)</span> is:</p>
<p><span class="math display">\[
\theta^{(j+1)} = \theta^{(j)} - \mathbf{B}^{(j)} F(\theta^{(j)}),
\]</span></p>
<p>where <span class="math inline">\(\mathbf{B}^{(j)}\)</span> is an approximation of the inverse Jacobian matrix, updated at each step using:</p>
<p><span class="math display">\[
\mathbf{B}^{(j+1)} = \mathbf{B}^{(j)} + \frac{(\Delta \theta^{(j)} - \mathbf{B}^{(j)} \Delta F^{(j)}) (\Delta \theta^{(j)})'}{(\Delta \theta^{(j)})' \Delta F^{(j)}},
\]</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\(\Delta \theta^{(j)} = \theta^{(j+1)} - \theta^{(j)}\)</span>,</li>
<li>
<span class="math inline">\(\Delta F^{(j)} = F(\theta^{(j+1)}) - F(\theta^{(j)})\)</span>.</li>
</ul>
<p>This <strong>secant-based update</strong> approximates the behavior of the <strong>true Jacobian inverse</strong>, reducing computational cost compared to full Newton’s method.</p>
<hr>
<p><strong>Algorithm: Secant Method for Nonlinear Optimization</strong></p>
<p>The <strong>Secant Method</strong> for nonlinear optimization follows these steps:</p>
<ol style="list-style-type: decimal">
<li>Initialize parameters <span class="math inline">\(\theta^{(0)}\)</span> and <span class="math inline">\(\theta^{(1)}\)</span> (two starting points).</li>
<li>Compute the function values <span class="math inline">\(F(\theta^{(0)})\)</span> and <span class="math inline">\(F(\theta^{(1)})\)</span>.</li>
<li>Use the Secant update formula to compute the next iterate <span class="math inline">\(\theta^{(j+1)}\)</span>.</li>
<li>Update the approximate inverse Jacobian <span class="math inline">\(\mathbf{B}^{(j)}\)</span>.</li>
<li>Repeat until convergence.</li>
</ol>
<hr>
<div class="sourceCode" id="cb207"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/">numDeriv</a></span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (logistic model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Improved Secant Method with Line Search</span></span>
<span><span class="va">secant_method_improved</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">theta0</span>,</span>
<span>             <span class="va">theta1</span>,</span>
<span>             <span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta_prev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">theta0</span><span class="op">)</span>  <span class="co"># Convert to column vector</span></span>
<span>        <span class="va">theta_curr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">theta1</span><span class="op">)</span></span>
<span>        </span>
<span>        <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co"># Initial step size</span></span>
<span>        <span class="va">step_reduction_factor</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># Reduce step if SSE increases</span></span>
<span>        <span class="va">B_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta0</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Identity matrix initialization</span></span>
<span>        </span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="co"># Compute function values using numerical gradient</span></span>
<span>            <span class="va">F_prev</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>                    <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="va">theta_prev</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="va">F_curr</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>                    <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="va">theta_curr</span><span class="op">)</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Compute secant step update (convert to column vectors)</span></span>
<span>            <span class="va">delta_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">theta_curr</span> <span class="op">-</span> <span class="va">theta_prev</span><span class="op">)</span></span>
<span>            <span class="va">delta_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">F_curr</span> <span class="op">-</span> <span class="va">F_prev</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Prevent division by zero</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">delta_F</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-8</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Gradient diff is too small, stopping optimization.\n"</span><span class="op">)</span></span>
<span>                <span class="kw">break</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Ensure correct dimensions for Broyden update</span></span>
<span>            <span class="va">numerator</span> <span class="op">&lt;-</span></span>
<span>                <span class="op">(</span><span class="va">delta_theta</span> <span class="op">-</span> <span class="va">B_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">delta_F</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">delta_theta</span><span class="op">)</span></span>
<span>            <span class="co"># Convert scalar to numeric</span></span>
<span>            <span class="va">denominator</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">delta_theta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">delta_F</span><span class="op">)</span>  </span>
<span>            </span>
<span>            <span class="co"># Updated inverse Jacobian approximation</span></span>
<span>            <span class="va">B_inv</span> <span class="op">&lt;-</span></span>
<span>                <span class="va">B_inv</span> <span class="op">+</span> <span class="va">numerator</span> <span class="op">/</span> <span class="va">denominator</span>  </span>
<span>            </span>
<span>            <span class="co"># Compute next theta using secant update</span></span>
<span>            <span class="va">theta_next</span> <span class="op">&lt;-</span> <span class="va">theta_curr</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">B_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">F_curr</span></span>
<span>            </span>
<span>            <span class="co"># Line search: Reduce step size if SSE increases</span></span>
<span>            <span class="kw">while</span> <span class="op">(</span><span class="fu">sse</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">theta_next</span><span class="op">)</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fu">sse</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">theta_curr</span><span class="op">)</span>, </span>
<span>                                                          <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">step_reduction_factor</span></span>
<span>                <span class="va">theta_next</span> <span class="op">&lt;-</span> <span class="va">theta_curr</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">B_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">F_curr</span></span>
<span>                </span>
<span>                <span class="co"># Print progress</span></span>
<span>                <span class="co"># cat("Reducing step size to", alpha, "\n")</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Print intermediate results for debugging</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span></span>
<span>                    <span class="st">"Iteration %d: Theta = (%.4f, %.4f, %.4f), Alpha = %.4f\n"</span>,</span>
<span>                    <span class="va">j</span>,</span>
<span>                    <span class="va">theta_next</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                    <span class="va">theta_next</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                    <span class="va">theta_next</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                    <span class="va">alpha</span></span>
<span>                <span class="op">)</span></span>
<span>            <span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Check convergence</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_next</span> <span class="op">-</span> <span class="va">theta_curr</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Converged successfully.\n"</span><span class="op">)</span></span>
<span>                <span class="kw">break</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Update iterates</span></span>
<span>            <span class="va">theta_prev</span> <span class="op">&lt;-</span> <span class="va">theta_curr</span></span>
<span>            <span class="va">theta_curr</span> <span class="op">&lt;-</span> <span class="va">theta_next</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">theta_curr</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Convert back to numeric vector</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Adjusted initial parameter guesses</span></span>
<span><span class="va">theta0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.8</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span>   <span class="co"># Closer to true parameters</span></span>
<span><span class="va">theta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.2</span>,<span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>  <span class="co"># Slightly refined</span></span>
<span></span>
<span><span class="co"># Run Improved Secant Method</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">secant_method_improved</span><span class="op">(</span><span class="va">theta0</span>, <span class="va">theta1</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; Iteration 1: Theta = (3.8521, 1.3054, 0.0057), Alpha = 0.0156</span></span>
<span><span class="co">#&gt; Iteration 2: Theta = (3.8521, 1.3054, 0.0057), Alpha = 0.0000</span></span>
<span><span class="co">#&gt; Converged successfully.</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Secant Method:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Secant Method:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3.85213912 1.30538435 0.00566417</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Secant Method: Data &amp; Fitted Curve"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>,</span>
<span>    to <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-9-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="grid-search" class="section level4" number="6.2.2.2">
<h4>
<span class="header-section-number">6.2.2.2</span> Grid Search<a class="anchor" aria-label="anchor" href="#grid-search"><i class="fas fa-link"></i></a>
</h4>
<p>Grid Search (GS) is a brute-force optimization method that systematically explores a grid of possible parameter values to identify the combination that minimizes the residual sum of squares (RSS). Unlike gradient-based optimization, which moves iteratively towards a minimum, grid search evaluates all predefined parameter combinations, making it robust but computationally expensive.</p>
<p>Grid search is particularly useful when:</p>
<ul>
<li><p><strong>The function is highly nonlinear</strong>, making gradient methods unreliable.</p></li>
<li><p><strong>The parameter space is small</strong>, allowing exhaustive search.</p></li>
<li><p><strong>A global minimum is needed</strong>, and prior knowledge about parameter ranges exists.</p></li>
</ul>
<hr>
<p>The goal of Grid Search is to find an optimal parameter set <span class="math inline">\(\hat{\theta}\)</span> that minimizes the Sum of Squared Errors (SSE):</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta \in \Theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p>Grid search <strong>discretizes</strong> the search space <span class="math inline">\(\Theta\)</span> into a finite set of candidate values for each parameter:</p>
<p><span class="math display">\[
\Theta = \theta_1 \times \theta_2 \times \dots \times \theta_p.
\]</span></p>
<p>The <strong>accuracy</strong> of the solution depends on the <strong>grid resolution</strong>—a finer grid leads to <strong>better accuracy</strong> but <strong>higher computational cost</strong>.</p>
<hr>
<p><strong>Grid Search Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Define a grid of possible values for each parameter.</li>
<li>Evaluate SSE for each combination of parameters.</li>
<li>Select the parameter set that minimizes SSE.</li>
</ol>
<hr>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Grid Search Optimization</span></span>
<span><span class="va">grid_search_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">grid_size</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Define grid of parameter values</span></span>
<span>    <span class="va">A_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, length.out <span class="op">=</span> <span class="va">grid_size</span><span class="op">)</span></span>
<span>    <span class="va">B_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">3</span>, length.out <span class="op">=</span> <span class="va">grid_size</span><span class="op">)</span></span>
<span>    <span class="va">C_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="va">grid_size</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Generate all combinations of parameters</span></span>
<span>    <span class="va">param_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">A_values</span>, B <span class="op">=</span> <span class="va">B_values</span>, C <span class="op">=</span> <span class="va">C_values</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Evaluate SSE for each parameter combination</span></span>
<span>    <span class="va">param_grid</span><span class="op">$</span><span class="va">SSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">param_grid</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">sse</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Select the best parameter set</span></span>
<span>    <span class="va">best_params</span> <span class="op">&lt;-</span> <span class="va">param_grid</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">param_grid</span><span class="op">$</span><span class="va">SSE</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">best_params</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Grid Search</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">grid_search_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, grid_size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Grid Search:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Grid Search:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.1052632 1.4210526 0.1052632</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Grid Search: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-10-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="nelder-mead" class="section level4" number="6.2.2.3">
<h4>
<span class="header-section-number">6.2.2.3</span> Nelder-Mead (Simplex)<a class="anchor" aria-label="anchor" href="#nelder-mead"><i class="fas fa-link"></i></a>
</h4>
<p>The Nelder-Mead algorithm, also known as the Simplex method, is a derivative-free optimization algorithm that iteratively adjusts a geometric shape (simplex) to find the minimum of an objective function. It is particularly useful for nonlinear regression when gradient-based methods fail due to non-differentiability or noisy function evaluations.</p>
<p>Nelder-Mead is particularly useful when:</p>
<ul>
<li><p>The function is non-differentiable or noisy.</p></li>
<li><p>Gradient-based methods are unreliable.</p></li>
<li><p>The parameter space is low-dimensional.</p></li>
</ul>
<hr>
<p>The goal of Nelder-Mead is to find an optimal parameter set <span class="math inline">\(\hat{\theta}\)</span> that minimizes the Sum of Squared Errors (SSE):</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>1. Simplex Representation</strong></p>
<p>The algorithm maintains a simplex, a geometric shape with <span class="math inline">\(p+1\)</span> vertices for a <span class="math inline">\(p\)</span>-dimensional parameter space.</p>
<p>Each vertex represents a parameter vector:</p>
<p><span class="math display">\[
S = \{ \theta_1, \theta_2, \dots, \theta_{p+1} \}.
\]</span></p>
<p><strong>2. Simplex Operations</strong></p>
<p>At each iteration, the algorithm <strong>updates the simplex</strong> based on the objective function values at each vertex:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Reflection</strong>: Reflect the worst point <span class="math inline">\(\theta_h\)</span> across the centroid.</p>
<p><span class="math display">\[
\theta_r = \theta_c + \alpha (\theta_c - \theta_h)
\]</span></p>
</li>
<li>
<p><strong>Expansion</strong>: If reflection improves the objective, expand the step.</p>
<p><span class="math display">\[
\theta_e = \theta_c + \gamma (\theta_r - \theta_c)
\]</span></p>
</li>
<li>
<p><strong>Contraction</strong>: If reflection worsens the objective, contract towards the centroid.</p>
<p><span class="math display">\[
\theta_c = \theta_c + \rho (\theta_h - \theta_c)
\]</span></p>
</li>
<li>
<p><strong>Shrink</strong>: If contraction fails, shrink the simplex.</p>
<p><span class="math display">\[
\theta_i = \theta_1 + \sigma (\theta_i - \theta_1), \quad \forall i &gt; 1
\]</span></p>
</li>
</ol>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\alpha = 1\)</span> (reflection coefficient),</p></li>
<li><p><span class="math inline">\(\gamma = 2\)</span> (expansion coefficient),</p></li>
<li><p><span class="math inline">\(\rho = 0.5\)</span> (contraction coefficient),</p></li>
<li><p><span class="math inline">\(\sigma = 0.5\)</span> (shrink coefficient).</p></li>
</ul>
<p>The process continues until convergence.</p>
<hr>
<p><strong>Nelder-Mead Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize a simplex with <span class="math inline">\(p+1\)</span> vertices.</li>
<li>Evaluate SSE at each vertex.</li>
<li>Perform reflection, expansion, contraction, or shrink operations.</li>
<li>Repeat until convergence.</li>
</ol>
<hr>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Nelder-Mead Optimization</span></span>
<span><span class="va">nelder_mead_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Initial guess for parameters</span></span>
<span>    <span class="va">initial_guess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Run Nelder-Mead optimization</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span></span>
<span>        par <span class="op">=</span> <span class="va">initial_guess</span>,</span>
<span>        fn <span class="op">=</span> <span class="va">sse</span>,</span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">y</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"Nelder-Mead"</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>  <span class="co"># Return optimized parameters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Nelder-Mead Optimization</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">nelder_mead_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Nelder-Mead:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Nelder-Mead:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.06873116 1.42759898 0.01119379</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Nelder-Mead: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="powells-method" class="section level4" number="6.2.2.4">
<h4>
<span class="header-section-number">6.2.2.4</span> Powell’s Method<a class="anchor" aria-label="anchor" href="#powells-method"><i class="fas fa-link"></i></a>
</h4>
<p>Powell’s Method is a derivative-free optimization algorithm that minimizes a function without using gradients. It works by iteratively refining a set of search directions to efficiently navigate the parameter space. Unlike <a href="non-linear-regression.html#nelder-mead">Nelder-Mead (Simplex)</a>, which adapts a simplex, Powell’s method builds an orthogonal basis of search directions.</p>
<p>Powell’s method is particularly useful when:</p>
<ul>
<li><p>The function is non-differentiable or noisy.</p></li>
<li><p>Gradient-based methods are unreliable.</p></li>
<li><p>The parameter space is low-to-moderate dimensional.</p></li>
</ul>
<hr>
<p>The goal of Powell’s Method is to find an optimal parameter set <span class="math inline">\(\hat{\theta}\)</span> that minimizes the Sum of Squared Errors (SSE):</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>1. Search Directions</strong></p>
<p>Powell’s method <strong>maintains a set of search directions</strong> <span class="math inline">\(\mathbf{d}_1, \mathbf{d}_2, \dots, \mathbf{d}_p\)</span>:</p>
<p><span class="math display">\[
D = \{ \mathbf{d}_1, \mathbf{d}_2, ..., \mathbf{d}_p \}.
\]</span></p>
<p>Initially, these directions are chosen as <strong>unit basis vectors</strong> (each optimizing a single parameter independently).</p>
<p><strong>2. Line Minimization</strong></p>
<p>For each direction <span class="math inline">\(\mathbf{d}_j\)</span>, Powell’s method <strong>performs a 1D optimization</strong>:</p>
<p><span class="math display">\[
\theta' = \theta + \lambda \mathbf{d}_j,
\]</span></p>
<p>where <span class="math inline">\(\lambda\)</span> is chosen to minimize <span class="math inline">\(SSE(\theta')\)</span>.</p>
<p><strong>3. Updating Search Directions</strong></p>
<p>After optimizing along all directions:</p>
<ol style="list-style-type: decimal">
<li>The <strong>largest improvement</strong> direction <span class="math inline">\(\mathbf{d}_{\max}\)</span> is replaced with:</li>
</ol>
<p><span class="math display">\[
\mathbf{d}_{\text{new}} = \theta_{\text{final}} - \theta_{\text{initial}}.
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>The <strong>new direction set is orthogonalized</strong> using Gram-Schmidt.</li>
</ol>
<p>This ensures <strong>efficient exploration</strong> of the parameter space.</p>
<p><strong>4. Convergence Criteria</strong></p>
<p>Powell’s method <strong>stops when function improvement is below a tolerance level</strong>:</p>
<p><span class="math display">\[
|SSE(\theta_{t+1}) - SSE(\theta_t)| &lt; \epsilon.
\]</span></p>
<hr>
<p><strong>Powell’s Method Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize search directions (standard basis vectors).</li>
<li>Perform 1D line searches along each direction.</li>
<li>Update the search directions based on the largest improvement.</li>
<li>Repeat until convergence.</li>
</ol>
<hr>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Powell's Method Optimization</span></span>
<span><span class="va">powell_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Initial guess for parameters</span></span>
<span>    <span class="va">initial_guess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Run Powell’s optimization (via BFGS without gradient)</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span></span>
<span>        par <span class="op">=</span> <span class="va">initial_guess</span>,</span>
<span>        fn <span class="op">=</span> <span class="va">sse</span>,</span>
<span>        x <span class="op">=</span> <span class="va">x</span>,</span>
<span>        y <span class="op">=</span> <span class="va">y</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"BFGS"</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>,</span>
<span>        gr <span class="op">=</span> <span class="cn">NULL</span>  <span class="co"># No gradient used</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>  <span class="co"># Return optimized parameters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Powell's Method Optimization</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">powell_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Powell’s Method:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Powell’s Method:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.06876538 1.42765687 0.01128753</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Powell's Method: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-12-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="random-search" class="section level4" number="6.2.2.5">
<h4>
<span class="header-section-number">6.2.2.5</span> Random Search<a class="anchor" aria-label="anchor" href="#random-search"><i class="fas fa-link"></i></a>
</h4>
<p>Random Search (RS) is a simple yet effective optimization algorithm that explores the search space by randomly sampling candidate solutions. Unlike <a href="non-linear-regression.html#grid-search">grid search</a>, which evaluates all predefined parameter combinations, random search selects a random subset, reducing computational cost.</p>
<p>Random search is particularly useful when:</p>
<ul>
<li><p>The search space is large, making grid search impractical.</p></li>
<li><p>Gradient-based methods fail due to non-differentiability or noisy data.</p></li>
<li><p>The optimal region is unknown, making global exploration essential.</p></li>
</ul>
<hr>
<p>The goal of Random Search is to find an optimal parameter set <span class="math inline">\(\hat{\theta}\)</span> that minimizes the Sum of Squared Errors (SSE):</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta \in \Theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p>Unlike <a href="non-linear-regression.html#grid-search">grid search</a>, <strong>random search does not evaluate all parameter combinations</strong> but instead <strong>randomly samples a subset</strong>:</p>
<p><span class="math display">\[
\Theta_{\text{sampled}} \subset \Theta.
\]</span></p>
<p>The <strong>accuracy</strong> of the solution depends on the <strong>number of random samples</strong>—a higher number increases <strong>the likelihood of finding a good solution</strong>.</p>
<hr>
<p><strong>Random Search Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Define a random sampling range for each parameter.</li>
<li>Randomly sample <span class="math inline">\(N\)</span> parameter sets.</li>
<li>Evaluate SSE for each sampled set.</li>
<li>Select the parameter set that minimizes SSE.</li>
</ol>
<hr>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Random Search Optimization</span></span>
<span><span class="va">random_search_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">num_samples</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Define parameter ranges</span></span>
<span>  <span class="va">A_range</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_samples</span>, <span class="fl">2</span>, <span class="fl">6</span><span class="op">)</span>   <span class="co"># Random values between 2 and 6</span></span>
<span>  <span class="va">B_range</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_samples</span>, <span class="fl">0.5</span>, <span class="fl">3</span><span class="op">)</span> <span class="co"># Random values between 0.5 and 3</span></span>
<span>  <span class="va">C_range</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">num_samples</span>,<span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>  <span class="co"># Random values between -2 and 2</span></span>
<span>  </span>
<span>  <span class="co"># Initialize best parameters</span></span>
<span>  <span class="va">best_theta</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span>  </span>
<span>  <span class="co"># Evaluate randomly sampled parameter sets</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_samples</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">A_range</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">B_range</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">C_range</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">current_sse</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">current_sse</span> <span class="op">&lt;</span> <span class="va">best_sse</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="va">current_sse</span></span>
<span>      <span class="va">best_theta</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">best_theta</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Random Search</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">random_search_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, num_samples <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Random Search:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Random Search:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.0893431 1.4687456 0.1024474</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Random Search: Nonlinear Regression Optimization"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>  <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">"topleft"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-13-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="hooke-jeeves" class="section level4" number="6.2.2.6">
<h4>
<span class="header-section-number">6.2.2.6</span> Hooke-Jeeves Pattern Search<a class="anchor" aria-label="anchor" href="#hooke-jeeves"><i class="fas fa-link"></i></a>
</h4>
<p>Hooke-Jeeves Pattern Search is a derivative-free optimization algorithm that searches for an optimal solution by exploring and adjusting parameter values iteratively. Unlike gradient-based methods, it does not require differentiability, making it effective for non-smooth and noisy functions.</p>
<p>Hooke-Jeeves is particularly useful when:</p>
<ul>
<li><p>The function is non-differentiable or noisy.</p></li>
<li><p>Gradient-based methods are unreliable.</p></li>
<li><p>The parameter space is low-to-moderate dimensional.</p></li>
</ul>
<hr>
<p>The goal of Hooke-Jeeves Pattern Search is to find an optimal parameter set <span class="math inline">\(\hat{\theta}\)</span> that minimizes the Sum of Squared Errors (SSE):</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>1. Exploratory Moves</strong></p>
<p>At each iteration, the algorithm <strong>perturbs each parameter</strong> to find a lower SSE:</p>
<p><span class="math display">\[
\theta' = \theta \pm \delta.
\]</span></p>
<p>If a new parameter <span class="math inline">\(\theta'\)</span> reduces SSE, it becomes the new base point.</p>
<p><strong>2. Pattern Moves</strong></p>
<p>After an improvement, the algorithm <strong>accelerates movement</strong> in the promising direction:</p>
<p><span class="math display">\[
\theta_{\text{new}} = \theta_{\text{old}} + (\theta_{\text{old}} - \theta_{\text{prev}}).
\]</span></p>
<p>This <strong>speeds up convergence</strong> towards an optimum.</p>
<p><strong>3. Step Size Adaptation</strong></p>
<p>If no improvement is found, the step size <span class="math inline">\(\delta\)</span> is reduced:</p>
<p><span class="math display">\[
\delta_{\text{new}} = \beta \cdot \delta.
\]</span></p>
<p>where <span class="math inline">\(\beta &lt; 1\)</span> is a reduction factor.</p>
<p><strong>4. Convergence Criteria</strong></p>
<p>The algorithm <strong>stops when step size is sufficiently small</strong>:</p>
<p><span class="math display">\[
\delta &lt; \epsilon.
\]</span></p>
<hr>
<p><strong>Hooke-Jeeves Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize a starting point <span class="math inline">\(\theta\)</span> and step size <span class="math inline">\(\delta\)</span>.</li>
<li>Perform exploratory moves in each parameter direction.</li>
<li>If improvement is found, perform pattern moves.</li>
<li>Reduce step size if no improvement is found.</li>
<li>Repeat until convergence.</li>
</ol>
<hr>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Hooke-Jeeves Pattern Search Optimization</span></span>
<span><span class="va">hooke_jeeves_optimization</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">step_size</span> <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># Initial guess for parameters</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>        <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>        <span class="va">step</span> <span class="op">&lt;-</span> <span class="va">step_size</span></span>
<span>        <span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>        </span>
<span>        <span class="kw">while</span> <span class="op">(</span><span class="va">step</span> <span class="op">&gt;</span> <span class="va">tol</span> <span class="op">&amp;</span> <span class="va">iter</span> <span class="op">&lt;</span> <span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">iter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>            <span class="va">improved</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>            <span class="va">new_theta</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>            </span>
<span>            <span class="co"># Exploratory move in each parameter direction</span></span>
<span>            <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="kw">for</span> <span class="op">(</span><span class="va">delta</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">step</span>,<span class="op">-</span><span class="va">step</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                    <span class="va">theta_test</span> <span class="op">&lt;-</span> <span class="va">new_theta</span></span>
<span>                    <span class="va">theta_test</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">theta_test</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">delta</span></span>
<span>                    <span class="va">sse_test</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta_test</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>                    </span>
<span>                    <span class="kw">if</span> <span class="op">(</span><span class="va">sse_test</span> <span class="op">&lt;</span> <span class="va">best_sse</span><span class="op">)</span> <span class="op">{</span></span>
<span>                        <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="va">sse_test</span></span>
<span>                        <span class="va">new_theta</span> <span class="op">&lt;-</span> <span class="va">theta_test</span></span>
<span>                        <span class="va">improved</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>                    <span class="op">}</span></span>
<span>                <span class="op">}</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Pattern move if improvement found</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">improved</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">new_theta</span> <span class="op">-</span> <span class="va">theta</span></span>
<span>                <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                <span class="va">step</span> <span class="op">&lt;-</span> <span class="va">step</span> <span class="op">/</span> <span class="fl">2</span>  <span class="co"># Reduce step size</span></span>
<span>            <span class="op">}</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Hooke-Jeeves Optimization</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">hooke_jeeves_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Hooke-Jeeves:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Hooke-Jeeves:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4 1 0</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Hooke-Jeeves: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-14-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="bisection-method" class="section level4" number="6.2.2.7">
<h4>
<span class="header-section-number">6.2.2.7</span> Bisection Method<a class="anchor" aria-label="anchor" href="#bisection-method"><i class="fas fa-link"></i></a>
</h4>
<p>The <strong>Bisection Method</strong> is a fundamental numerical technique primarily used for <strong>root finding</strong>, but it can also be adapted for <strong>optimization problems</strong> where the goal is to minimize or maximize a nonlinear function.</p>
<p>In nonlinear regression, optimization often involves <strong>finding the parameter values that minimize the sum of squared errors (SSE)</strong>:</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} SSE(\theta)
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} \left( y_i - f(x_i; \theta) \right)^2.
\]</span></p>
<p>Since the minimum of a function occurs where the derivative equals zero, we apply the <strong>Bisection Method</strong> to the <strong>derivative of the SSE function</strong>:</p>
<p><span class="math display">\[
\frac{d}{d\theta} SSE(\theta) = 0.
\]</span></p>
<p>This transforms the <strong>optimization problem</strong> into a <strong>root-finding problem</strong>.</p>
<hr>
<p>The <strong>Bisection Method</strong> is based on the <strong>Intermediate Value Theorem</strong>, which states:</p>
<blockquote>
<p>If a continuous function <span class="math inline">\(f(\theta)\)</span> satisfies <span class="math inline">\(f(\theta_a) \cdot f(\theta_b) &lt; 0\)</span>,<br>
then there exists at least one root in the interval <span class="math inline">\((\theta_a, \theta_b)\)</span>.</p>
</blockquote>
<p>For <strong>optimization</strong>, we apply this principle to the <strong>first derivative</strong> of the objective function <span class="math inline">\(Q(\theta)\)</span>:</p>
<p><span class="math display">\[
Q'(\theta) = 0.
\]</span></p>
<p><strong>Step-by-Step Algorithm for Optimization</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Choose an interval</strong> <span class="math inline">\([\theta_a, \theta_b]\)</span> such that: <span class="math display">\[ Q'(\theta_a) \cdot Q'(\theta_b) &lt; 0. \]</span>
</li>
<li>
<strong>Compute the midpoint</strong>: <span class="math display">\[
\theta_m = \frac{\theta_a + \theta_b}{2}.
\]</span>
</li>
<li>
<strong>Evaluate</strong> <span class="math inline">\(Q'(\theta_m)\)</span>:
<ul>
<li>If <span class="math inline">\(Q'(\theta_m) = 0\)</span>, then <span class="math inline">\(\theta_m\)</span> is the optimal point.</li>
<li>If <span class="math inline">\(Q'(\theta_a) \cdot Q'(\theta_m) &lt; 0\)</span>, set <span class="math inline">\(\theta_b = \theta_m\)</span>.</li>
<li>Otherwise, set <span class="math inline">\(\theta_a = \theta_m\)</span>.</li>
</ul>
</li>
<li>
<strong>Repeat</strong> until convergence: <span class="math display">\[
|\theta_b - \theta_a| &lt; \epsilon.
\]</span>
</li>
</ol>
<p><strong>Determining the Nature of the Critical Point</strong></p>
<p>Since the Bisection Method finds a <strong>stationary point</strong>, we use the <strong>second derivative test</strong> to classify it:</p>
<ul>
<li>If <span class="math inline">\(Q''(\theta) &gt; 0\)</span>, the point is a <strong>local minimum</strong>.</li>
<li>If <span class="math inline">\(Q''(\theta) &lt; 0\)</span>, the point is a <strong>local maximum</strong>.</li>
</ul>
<p>For <strong>nonlinear regression</strong>, we expect <span class="math inline">\(Q(\theta) = SSE(\theta)\)</span>, so the solution found by Bisection should be a <strong>minimum</strong>.</p>
<hr>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function for optimization</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Optimize all three parameters simultaneously</span></span>
<span><span class="va">find_optimal_parameters</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Initial guess for parameters (based on data)</span></span>
<span>    <span class="va">initial_guess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  </span>
<span></span>
<span>    <span class="co"># Bounds for parameters</span></span>
<span>    <span class="va">lower_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Ensure positive scaling</span></span>
<span>    <span class="va">upper_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run optim() with L-BFGS-B (bounded optimization)</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span></span>
<span>        par <span class="op">=</span> <span class="va">initial_guess</span>,</span>
<span>        fn <span class="op">=</span> <span class="va">sse</span>,</span>
<span>        x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>        lower <span class="op">=</span> <span class="va">lower_bounds</span>,</span>
<span>        upper <span class="op">=</span> <span class="va">upper_bounds</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>  <span class="co"># Extract optimized parameters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Find optimal parameters using optim()</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">find_optimal_parameters</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using optim():\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using optim():</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.06876536 1.42765688 0.01128756</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Optim(): Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-15-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="stochastic-heuristic-nolinear-regression" class="section level3" number="6.2.3">
<h3>
<span class="header-section-number">6.2.3</span> Stochastic Heuristic<a class="anchor" aria-label="anchor" href="#stochastic-heuristic-nolinear-regression"><i class="fas fa-link"></i></a>
</h3>
<div id="differential-evolution-algorithm" class="section level4" number="6.2.3.1">
<h4>
<span class="header-section-number">6.2.3.1</span> Differential Evolution Algorithm<a class="anchor" aria-label="anchor" href="#differential-evolution-algorithm"><i class="fas fa-link"></i></a>
</h4>
<p>The <strong>Differential Evolution (DE) Algorithm</strong> is a <strong>stochastic, population-based optimization algorithm</strong> that is widely used for solving complex <strong>global optimization problems</strong>. Unlike gradient-based methods such as Newton’s method or the <a href="non-linear-regression.html#secant-method">Secant method</a>, DE does not require derivatives and is well-suited for optimizing <strong>non-differentiable, nonlinear, and multimodal functions</strong>.</p>
<hr>
<p><strong>Key Features of Differential Evolution</strong></p>
<ul>
<li>
<strong>Population-based approach:</strong> Maintains a population of candidate solutions instead of a single point.</li>
<li>
<strong>Mutation and crossover:</strong> Introduces variations to explore the search space.</li>
<li>
<strong>Selection mechanism:</strong> Retains the best candidates for the next generation.</li>
<li>
<strong>Global optimization:</strong> Avoids local minima by using <strong>stochastic search strategies</strong>.</li>
</ul>
<hr>
<p><strong>Mathematical Formulation of Differential Evolution</strong></p>
<p>Differential Evolution operates on a <strong>population</strong> of candidate solutions <span class="math inline">\(\{\theta_i\}\)</span>, where each <span class="math inline">\(\theta_i\)</span> is a <strong>vector of parameters</strong>. The algorithm iteratively updates the population using three main operations:</p>
<p><strong>1. Mutation</strong></p>
<p>For each candidate solution <span class="math inline">\(\theta_i\)</span>, a <strong>mutant vector</strong> <span class="math inline">\(\mathbf{v}_i^{(j)}\)</span> is generated as:</p>
<p><span class="math display">\[
\mathbf{v}_i^{(j)} = \mathbf{\theta}_{r_1}^{(j)} + F \cdot (\mathbf{\theta}_{r_2}^{(j)} - \mathbf{\theta}_{r_3}^{(j)})
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\mathbf{\theta}_{r_1}, \mathbf{\theta}_{r_2}, \mathbf{\theta}_{r_3}\)</span> are <strong>randomly selected distinct vectors</strong> from the population.</p></li>
<li><p><span class="math inline">\(F \in (0,2)\)</span> is the <strong>mutation factor</strong> controlling the step size.</p></li>
</ul>
<p><strong>2. Crossover</strong></p>
<p>A trial vector <span class="math inline">\(\mathbf{u}_i^{(j)}\)</span> is generated by combining the mutant vector <span class="math inline">\(\mathbf{v}_i^{(j)}\)</span> with the original solution <span class="math inline">\(\mathbf{\theta}_i^{(j)}\)</span>:</p>
<p><span class="math display">\[
u_{i,k}^{(j)} =
\begin{cases}
v_{i,k}^{(j)}  &amp; \text{if } rand_k \leq C_r \text{ or } k = k_{\text{rand}}, \\
\theta_{i,k}^{(j)}  &amp; \text{otherwise}.
\end{cases}
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(C_r \in (0,1)\)</span> is the <strong>crossover probability</strong>.</p></li>
<li><p><span class="math inline">\(rand_k\)</span> is a <strong>random value between 0 and 1</strong>.</p></li>
<li><p><span class="math inline">\(k_{\text{rand}}\)</span> ensures at least <strong>one parameter is mutated</strong>.</p></li>
</ul>
<p><strong>3. Selection</strong></p>
<p>The new candidate solution is accepted only if it improves the objective function:</p>
<p><span class="math display">\[
\mathbf{\theta}_i^{(j+1)} =
\begin{cases}
\mathbf{u}_i^{(j)} &amp; \text{if } Q(\mathbf{u}_i^{(j)}) &lt; Q(\mathbf{\theta}_i^{(j)}), \\
\mathbf{\theta}_i^{(j)} &amp; \text{otherwise}.
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(Q(\theta)\)</span> is the <strong>objective function</strong> (e.g., sum of squared errors in regression problems).</p>
<hr>
<p><strong>Algorithm: Differential Evolution for Nonlinear Optimization</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize a population of candidate solutions.</li>
<li>Evaluate the objective function for each candidate.</li>
<li>Mutate individuals using a difference strategy.</li>
<li>Apply crossover to create trial solutions.</li>
<li>Select individuals based on their fitness (objective function value).</li>
<li>Repeat until convergence (or a stopping criterion is met).</li>
</ol>
<hr>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArdiaD/DEoptim">DEoptim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a nonlinear function (logistic model)</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the objective function for DEoptim</span></span>
<span><span class="va">objective_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define parameter bounds</span></span>
<span><span class="va">lower_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">upper_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Differential Evolution Algorithm</span></span>
<span><span class="va">de_result</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.html">DEoptim</a></span><span class="op">(</span></span>
<span>        <span class="va">objective_function</span>,</span>
<span>        <span class="va">lower_bounds</span>,</span>
<span>        <span class="va">upper_bounds</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.control.html">DEoptim.control</a></span><span class="op">(</span></span>
<span>            NP <span class="op">=</span> <span class="fl">50</span>,</span>
<span>            itermax <span class="op">=</span> <span class="fl">100</span>,</span>
<span>            F <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>            CR <span class="op">=</span> <span class="fl">0.9</span>, </span>
<span>            trace <span class="op">=</span> <span class="cn">F</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract optimized parameters</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="va">de_result</span><span class="op">$</span><span class="va">optim</span><span class="op">$</span><span class="va">bestmem</span></span>
<span></span>
<span><span class="co"># Display estimated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Differential Evolution:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Differential Evolution:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt;       par1       par2       par3 </span></span>
<span><span class="co">#&gt; 4.06876562 1.42765614 0.01128768</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Differential Evolution: Data &amp; Fitted Curve"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>,</span>
<span>    to <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-16-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="simulated-annealing" class="section level4" number="6.2.3.2">
<h4>
<span class="header-section-number">6.2.3.2</span> Simulated Annealing<a class="anchor" aria-label="anchor" href="#simulated-annealing"><i class="fas fa-link"></i></a>
</h4>
<p>Simulated Annealing (SA) is a probabilistic global optimization algorithm inspired by annealing in metallurgy, where a material is heated and slowly cooled to remove defects. In optimization, SA gradually refines a solution by exploring the search space, allowing occasional jumps to escape local minima, before converging to an optimal solution.</p>
<p>Simulated Annealing is particularly useful when:</p>
<ul>
<li><p>The function is highly nonlinear and multimodal.</p></li>
<li><p>Gradient-based methods struggle due to non-differentiability or poor initialization.</p></li>
<li><p>A global minimum is needed, rather than a local one.</p></li>
</ul>
<hr>
<p><strong>1. Energy Function (Objective Function)</strong></p>
<p>The goal of SA is to minimize an objective function <span class="math inline">\(Q(\theta)\)</span>. For nonlinear regression, this is the Sum of Squared Errors (SSE):</p>
<p><span class="math display">\[
Q(\theta) = SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>2. Probability of Acceptance</strong></p>
<p>At each step, SA randomly perturbs the parameters <span class="math inline">\(\theta\)</span> to create a <strong>new candidate solution</strong> <span class="math inline">\(\theta'\)</span> and evaluates the change in SSE:</p>
<p><span class="math display">\[
\Delta Q = Q(\theta') - Q(\theta).
\]</span></p>
<p>The <strong>Metropolis Criterion</strong> determines whether to accept the new solution:</p>
<p><span class="math display">\[
P(\text{accept}) =
\begin{cases}
1, &amp; \text{if } \Delta Q &lt; 0 \quad \text{(new solution improves fit)} \\
\exp\left( -\frac{\Delta Q}{T} \right), &amp; \text{if } \Delta Q \geq 0 \quad \text{(accept with probability)}.
\end{cases}
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(T\)</span> is the <strong>temperature</strong> that <strong>gradually decreases</strong> over iterations.</p></li>
<li><p><strong>Worse solutions</strong> are accepted <strong>with small probability</strong> to escape local minima.</p></li>
</ul>
<p><strong>3. Cooling Schedule</strong></p>
<p>The <strong>temperature</strong> follows a cooling schedule:</p>
<p><span class="math display">\[
T_k = \alpha T_{k-1},
\]</span></p>
<p>where <span class="math inline">\(\alpha \in (0,1)\)</span> is a decay factor that controls cooling speed.</p>
<hr>
<p><strong>Simulated Annealing Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize parameters <span class="math inline">\(\theta\)</span> randomly.</li>
<li>Set an initial temperature <span class="math inline">\(T_0\)</span> and cooling rate <span class="math inline">\(\alpha\)</span>.</li>
<li>Repeat for max iterations:
<ul>
<li>Generate perturbed candidate <span class="math inline">\(\theta'\)</span>.</li>
<li>Compute <span class="math inline">\(\Delta Q = Q(\theta') - Q(\theta)\)</span>.</li>
<li>Accept if <span class="math inline">\(\Delta Q &lt; 0\)</span> or with probability <span class="math inline">\(\exp(-\Delta Q / T)\)</span>.</li>
<li>Reduce temperature: <span class="math inline">\(T \leftarrow \alpha T\)</span>.</li>
</ul>
</li>
<li>Return the best solution found.</li>
</ol>
<hr>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Simulated Annealing Algorithm</span></span>
<span><span class="va">simulated_annealing</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">initial_theta</span>,</span>
<span>             <span class="va">T_init</span> <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>             <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.99</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># Initialize parameters</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">initial_theta</span></span>
<span>        <span class="va">best_theta</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>        <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>        <span class="cn">T</span> <span class="op">&lt;-</span> <span class="va">T_init</span>  <span class="co"># Initial temperature</span></span>
<span>        </span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">iter</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="co"># Generate new candidate solution (small random perturbation)</span></span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Compute new SSE</span></span>
<span>            <span class="va">sse_new</span> <span class="op">&lt;-</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta_new</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Compute change in SSE</span></span>
<span>            <span class="va">delta_Q</span> <span class="op">&lt;-</span> <span class="va">sse_new</span> <span class="op">-</span> <span class="va">best_sse</span></span>
<span>            </span>
<span>            <span class="co"># Acceptance criteria</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="va">delta_Q</span> <span class="op">&lt;</span> <span class="fl">0</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">delta_Q</span> <span class="op">/</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>                <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="va">sse_new</span></span>
<span>                <span class="va">best_theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Reduce temperature</span></span>
<span>            <span class="cn">T</span> <span class="op">&lt;-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="cn">T</span></span>
<span>            </span>
<span>            <span class="co"># Stopping condition (very low temperature)</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="cn">T</span> <span class="op">&lt;</span> <span class="fl">1e-6</span><span class="op">)</span></span>
<span>                <span class="kw">break</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">best_theta</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initial guess</span></span>
<span><span class="va">initial_theta</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Simulated Annealing</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">simulated_annealing</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">initial_theta</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Simulated Annealing:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Simulated Annealing:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.07180419 1.41457906 0.01422147</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Simulated Annealing: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-17-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="genetic-algorithm" class="section level4" number="6.2.3.3">
<h4>
<span class="header-section-number">6.2.3.3</span> Genetic Algorithm<a class="anchor" aria-label="anchor" href="#genetic-algorithm"><i class="fas fa-link"></i></a>
</h4>
<p>Genetic Algorithms (GA) are a class of evolutionary algorithms inspired by the principles of natural selection and genetics. Unlike deterministic optimization techniques, GA evolves a population of candidate solutions over multiple generations, using genetic operators such as selection, crossover, and mutation.</p>
<p>GA is particularly useful when:</p>
<ul>
<li><p>The function is nonlinear, non-differentiable, or highly multimodal.</p></li>
<li><p>Gradient-based methods fail due to rugged function landscapes.</p></li>
<li><p>A global minimum is required, rather than a local one.</p></li>
</ul>
<p>The goal of a Genetic Algorithm is to find an optimal solution $\hat{\theta}$ that minimizes an objective function:</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>1. Population Representation</strong></p>
<p>Each candidate solution (individual) is represented as a <strong>chromosome</strong>, which is simply a vector of parameters: <span class="math display">\[
\theta = (\theta_1, \theta_2, \theta_3)
\]</span></p>
<p>An entire <strong>population</strong> consists of multiple such solutions.</p>
<p><strong>2. Selection</strong></p>
<p>Each individual’s fitness is evaluated using:</p>
<p><span class="math display">\[
\text{Fitness}(\theta) = -SSE(\theta)
\]</span></p>
<p>We use <strong>Tournament Selection</strong> or <strong>Roulette Wheel Selection</strong> to choose parents for reproduction.</p>
<p><strong>3. Crossover (Recombination)</strong></p>
<p>A new solution <span class="math inline">\(\theta'\)</span> is generated by <strong>combining</strong> two parents:</p>
<p><span class="math display">\[\theta' = \alpha \theta_{\text{parent1}} + (1 - \alpha) \theta_{\text{parent2}}, \quad \alpha \sim U(0,1).\]</span></p>
<p><strong>4. Mutation</strong></p>
<p>Random small changes are introduced to <strong>increase diversity</strong>:</p>
<p><span class="math display">\[\theta_i' = \theta_i + \mathcal{N}(0, \sigma),\]</span></p>
<p>where <span class="math inline">\(\mathcal{N}(0, \sigma)\)</span> is a <strong>small Gaussian perturbation</strong>.</p>
<p><strong>5. Evolutionary Cycle</strong></p>
<p>The <strong>algorithm iterates</strong> through:</p>
<ol style="list-style-type: decimal">
<li><p>Selection</p></li>
<li><p>Crossover</p></li>
<li><p>Mutation</p></li>
<li><p>Survival of the fittest</p></li>
<li><p>Termination when convergence is reached.</p></li>
</ol>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://luca-scr.github.io/GA/">GA</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function for optimization</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Genetic Algorithm for Optimization</span></span>
<span><span class="va">ga_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Define fitness function (negative SSE for maximization)</span></span>
<span>    <span class="va">fitness_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># GA maximizes fitness, so we use negative SSE</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">-</span><span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>  </span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Set parameter bounds</span></span>
<span>    <span class="va">lower_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Ensure positive scaling</span></span>
<span>    <span class="va">upper_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Run GA optimization</span></span>
<span>    <span class="va">ga_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://github.com/luca-scr/GA/reference/ga.html">ga</a></span><span class="op">(</span></span>
<span>        type <span class="op">=</span> <span class="st">"real-valued"</span>,</span>
<span>        fitness <span class="op">=</span> <span class="va">fitness_function</span>,</span>
<span>        lower <span class="op">=</span> <span class="va">lower_bounds</span>,</span>
<span>        upper <span class="op">=</span> <span class="va">upper_bounds</span>,</span>
<span>        popSize <span class="op">=</span> <span class="fl">50</span>,</span>
<span>        <span class="co"># Population size</span></span>
<span>        maxiter <span class="op">=</span> <span class="fl">200</span>,</span>
<span>        <span class="co"># Max generations</span></span>
<span>        pmutation <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>        <span class="co"># Mutation probability</span></span>
<span>        monitor <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">ga_result</span><span class="op">@</span><span class="va">solution</span><span class="op">)</span>  <span class="co"># Return optimized parameters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Genetic Algorithm</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">ga_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Genetic Algorithm:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Genetic Algorithm:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt;            x1       x2         x3</span></span>
<span><span class="co">#&gt; [1,] 4.066144 1.433886 0.00824126</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Genetic Algorithm: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-18-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="particle-swarm-optimization" class="section level4" number="6.2.3.4">
<h4>
<span class="header-section-number">6.2.3.4</span> Particle Swarm Optimization<a class="anchor" aria-label="anchor" href="#particle-swarm-optimization"><i class="fas fa-link"></i></a>
</h4>
<p>Particle Swarm Optimization (PSO) is a population-based global optimization algorithm inspired by the social behavior of birds and fish schools. Instead of using genetic operators (like in Genetic Algorithms), PSO models particles (solutions) flying through the search space, adjusting their position based on their own experience and the experience of their neighbors.</p>
<p>PSO is particularly useful when:</p>
<ul>
<li><p>The function is nonlinear, noisy, or lacks smooth gradients.</p></li>
<li><p>Gradient-based methods struggle due to non-differentiability.</p></li>
<li><p>A global minimum is needed, rather than a local one.</p></li>
</ul>
<hr>
<p>The goal of PSO is to find an optimal solution <span class="math inline">\(\hat{\theta}\)</span> that minimizes an objective function:</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>1. Particle Representation</strong></p>
<p>Each <strong>particle</strong> represents a candidate solution:</p>
<p><span class="math display">\[
\theta_i = (\theta_{i1}, \theta_{i2}, \theta_{i3})
\]</span></p>
<p>where <span class="math inline">\(\theta_{ij}\)</span> is the <span class="math inline">\(j^{th}\)</span> parameter of particle <span class="math inline">\(i\)</span>.</p>
<p><strong>2. Particle Velocity and Position Updates</strong></p>
<p>Each particle moves in the search space with <strong>velocity</strong> <span class="math inline">\(v_i\)</span>, which is updated as:</p>
<p><span class="math display">\[
v_i^{(t+1)} = \omega v_i^{(t)} + c_1 r_1 (p_i - \theta_i^{(t)}) + c_2 r_2 (g - \theta_i^{(t)})
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\omega\)</span> is the <strong>inertia weight</strong> (controls exploration vs. exploitation),</p></li>
<li><p><span class="math inline">\(c_1, c_2\)</span> are <strong>acceleration coefficients</strong>,</p></li>
<li><p><span class="math inline">\(r_1, r_2 \sim U(0,1)\)</span> are random numbers,</p></li>
<li><p><span class="math inline">\(p_i\)</span> is the <strong>particle’s personal best position</strong>,</p></li>
<li><p><span class="math inline">\(g\)</span> is the <strong>global best position</strong>.</p></li>
</ul>
<p>Then, the <strong>position update</strong> is:</p>
<p><span class="math display">\[
\theta_i^{(t+1)} = \theta_i^{(t)} + v_i^{(t+1)}
\]</span></p>
<p>This process continues until <strong>convergence criteria</strong> (like a max number of iterations or minimum error) is met.</p>
<hr>
<p><strong>Particle Swarm Optimization Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize particles randomly within search bounds.</li>
<li>Set random initial velocities.</li>
<li>Evaluate SSE for each particle.</li>
<li>Update the personal and global best solutions.</li>
<li>Update velocities and positions using the update equations.</li>
<li>Repeat until convergence.</li>
</ol>
<hr>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pso</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function for optimization</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Particle Swarm Optimization (PSO) for Nonlinear Regression</span></span>
<span><span class="va">pso_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Define fitness function (minimize SSE)</span></span>
<span>    <span class="va">fitness_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co"># Set parameter bounds</span></span>
<span>    <span class="va">lower_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Ensure positive scaling</span></span>
<span>    <span class="va">upper_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Run PSO optimization</span></span>
<span>    <span class="va">pso_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pso/man/psoptim.html">psoptim</a></span><span class="op">(</span></span>
<span>        par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>        <span class="co"># Initial guess</span></span>
<span>        fn <span class="op">=</span> <span class="va">fitness_function</span>,</span>
<span>        lower <span class="op">=</span> <span class="va">lower_bounds</span>,</span>
<span>        upper <span class="op">=</span> <span class="va">upper_bounds</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">200</span>, s <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>  <span class="co"># 200 iterations, 50 particles</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">pso_result</span><span class="op">$</span><span class="va">par</span><span class="op">)</span>  <span class="co"># Return optimized parameters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Particle Swarm Optimization</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">pso_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Particle Swarm Optimization:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Particle Swarm Optimization:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.06876562 1.42765613 0.01128767</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Particle Swarm Optimization: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-19-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="evolutionary-strategies" class="section level4" number="6.2.3.5">
<h4>
<span class="header-section-number">6.2.3.5</span> Evolutionary Strategies<a class="anchor" aria-label="anchor" href="#evolutionary-strategies"><i class="fas fa-link"></i></a>
</h4>
<p>Evolutionary Strategies (ES) are a class of evolutionary optimization algorithms that improve solutions by mutating and selecting individuals based on fitness. Unlike <a href="non-linear-regression.html#genetic-algorithm">Genetic Algorithm</a>, ES focuses on self-adaptive mutation rates and selection pressure rather than crossover. This makes ES particularly robust for continuous optimization problems like nonlinear regression.</p>
<p>ES is particularly useful when:</p>
<ul>
<li><p>The function is complex, noisy, or lacks smooth gradients.</p></li>
<li><p>Gradient-based methods fail due to non-differentiability.</p></li>
<li><p>An adaptive approach to exploration and exploitation is needed.</p></li>
</ul>
<hr>
<p>The goal of ES is to find an optimal solution <span class="math inline">\(\hat{\theta}\)</span> that minimizes an objective function:</p>
<p><span class="math display">\[
\hat{\theta} = \arg\min_{\theta} SSE(\theta),
\]</span></p>
<p>where:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>1. Population Representation</strong></p>
<p>Each <strong>individual</strong> is a solution <span class="math inline">\(\theta_i\)</span> in the parameter space:</p>
<p><span class="math display">\[
\theta_i = (\theta_{i1}, \theta_{i2}, \theta_{i3}).
\]</span></p>
<p>The <strong>population</strong> consists of multiple individuals, each representing different candidate parameters.</p>
<p><strong>2. Mutation</strong></p>
<p>New candidate solutions are generated by <strong>adding random noise</strong>:</p>
<p><span class="math display">\[
\theta'_i = \theta_i + \sigma \mathcal{N}(0, I),
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\sigma\)</span> is the <strong>mutation step size</strong>, which adapts over time.</p></li>
<li><p><span class="math inline">\(\mathcal{N}(0, I)\)</span> is a standard normal distribution.</p></li>
</ul>
<p><strong>3. Selection</strong></p>
<p>ES employs <span class="math inline">\((\mu, \lambda)\)</span>-selection:</p>
<ul>
<li><p><span class="math inline">\((\mu, \lambda)\)</span>-ES: Select the best <span class="math inline">\(\mu\)</span> solutions from <span class="math inline">\(\lambda\)</span> offspring.</p></li>
<li><p><span class="math inline">\((\mu + \lambda)\)</span>-ES: Combine parents and offspring, selecting the top <span class="math inline">\(\mu\)</span>.</p></li>
</ul>
<p><strong>4. Step-Size Adaptation</strong></p>
<p>Mutation strength <span class="math inline">\(\sigma\)</span> <strong>self-adapts</strong> using the <strong>1/5 success rule</strong>:</p>
<p><span class="math display">\[
\sigma_{t+1} =
\begin{cases}
\sigma_t / c, &amp; \text{if success rate } &gt; 1/5 \\
\sigma_t \cdot c, &amp; \text{if success rate } &lt; 1/5
\end{cases}
\]</span></p>
<p>where <span class="math inline">\(c &gt; 1\)</span> is a scaling factor.</p>
<hr>
<p><strong>Evolutionary Strategies Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize a population of <span class="math inline">\(\lambda\)</span> solutions with random parameters.</li>
<li>Set mutation step size <span class="math inline">\(\sigma\)</span>.</li>
<li>Repeat for max iterations:
<ul>
<li>Generate <span class="math inline">\(\lambda\)</span> offspring by mutating parent solutions.</li>
<li>Evaluate fitness (SSE) of each offspring.</li>
<li>Select the best <span class="math inline">\(\mu\)</span> solutions for the next generation.</li>
<li>Adapt mutation step size based on success rate.</li>
</ul>
</li>
<li>Return the best solution found.</li>
</ol>
<hr>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArdiaD/DEoptim">DEoptim</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function for optimization</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Evolutionary Strategies Optimization (Using Differential Evolution)</span></span>
<span><span class="va">es_optimization</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Define fitness function (minimize SSE)</span></span>
<span>    <span class="va">fitness_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Set parameter bounds</span></span>
<span>    <span class="va">lower_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Ensure positive scaling</span></span>
<span>    <span class="va">upper_bounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>, <span class="fl">10</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Run Differential Evolution (mimicking ES)</span></span>
<span>    <span class="va">es_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.html">DEoptim</a></span><span class="op">(</span></span>
<span>        fn <span class="op">=</span> <span class="va">fitness_function</span>,</span>
<span>        lower <span class="op">=</span> <span class="va">lower_bounds</span>,</span>
<span>        upper <span class="op">=</span> <span class="va">upper_bounds</span>,</span>
<span>        <span class="co"># 50 individuals, 200 generations, suppress iteration output</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.control.html">DEoptim.control</a></span><span class="op">(</span>NP <span class="op">=</span> <span class="fl">50</span>, itermax <span class="op">=</span> <span class="fl">200</span>, trace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span>  </span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">es_result</span><span class="op">$</span><span class="va">optim</span><span class="op">$</span><span class="va">bestmem</span><span class="op">)</span>  <span class="co"># Return optimized parameters</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Evolutionary Strategies Optimization</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">es_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Evolutionary Strategies:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Evolutionary Strategies:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt;       par1       par2       par3 </span></span>
<span><span class="co">#&gt; 4.06876561 1.42765613 0.01128767</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>, <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Evolutionary Strategies: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-20-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="linearization-nonlinear-regression-optimization" class="section level3" number="6.2.4">
<h3>
<span class="header-section-number">6.2.4</span> Linearization<a class="anchor" aria-label="anchor" href="#linearization-nonlinear-regression-optimization"><i class="fas fa-link"></i></a>
</h3>
<div id="taylor-series-approximation-nonlinear-optimization" class="section level4" number="6.2.4.1">
<h4>
<span class="header-section-number">6.2.4.1</span> Taylor Series Approximation<a class="anchor" aria-label="anchor" href="#taylor-series-approximation-nonlinear-optimization"><i class="fas fa-link"></i></a>
</h4>
<p>Taylor Series Approximation is a fundamental tool in nonlinear optimization, enabling local approximation of complex functions using polynomial expansions. It is widely used to linearize nonlinear models, facilitate derivative-based optimization, and derive Newton-type methods.</p>
<p>Taylor series approximation is particularly useful when:</p>
<ul>
<li><p>A nonlinear function is difficult to compute directly.</p></li>
<li><p>Optimization requires local gradient and curvature information.</p></li>
<li><p>A simpler, polynomial-based approximation improves computational efficiency.</p></li>
</ul>
<hr>
<p>Given a differentiable function <span class="math inline">\(f(\theta)\)</span>, its <strong>Taylor series expansion</strong> around a point <span class="math inline">\(\theta_0\)</span> is:</p>
<p><span class="math display">\[
f(\theta) = f(\theta_0) + f'(\theta_0)(\theta - \theta_0) + \frac{1}{2} f''(\theta_0)(\theta - \theta_0)^2 + \mathcal{O}((\theta - \theta_0)^3).
\]</span></p>
<p>For optimization, we often use:</p>
<ol style="list-style-type: decimal">
<li>
<strong>First-order approximation (Linear Approximation):</strong> <span class="math display">\[
   f(\theta) \approx f(\theta_0) + f'(\theta_0)(\theta - \theta_0).
   \]</span>
</li>
<li>
<strong>Second-order approximation (Quadratic Approximation):</strong> <span class="math display">\[
f(\theta) \approx f(\theta_0) + f'(\theta_0)(\theta - \theta_0) + \frac{1}{2} f''(\theta_0)(\theta - \theta_0)^2.
\]</span>
</li>
</ol>
<p>For <strong>gradient-based optimization</strong>, we use the <strong>Newton-Raphson update</strong>:</p>
<p><span class="math display">\[
\theta^{(k+1)} = \theta^{(k)} - [H_f(\theta^{(k)})]^{-1} \nabla f(\theta^{(k)}),
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\nabla f(\theta)\)</span> is the <strong>gradient</strong> (first derivative),</p></li>
<li><p><span class="math inline">\(H_f(\theta)\)</span> is the <strong>Hessian matrix</strong> (second derivative).</p></li>
</ul>
<hr>
<p>For nonlinear regression, we approximate the <strong>Sum of Squared Errors (SSE)</strong>:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p><strong>1. First-Order Approximation (Gradient Descent)</strong></p>
<p>The <strong>gradient</strong> of SSE w.r.t. parameters <span class="math inline">\(\theta\)</span> is:</p>
<p><span class="math display">\[
\nabla SSE(\theta) = -2 \sum_{i=1}^{n} (y_i - f(x_i; \theta)) \nabla f(x_i; \theta).
\]</span></p>
<p>Using <strong>first-order Taylor approximation</strong>, we update parameters via <strong>gradient descent</strong>:</p>
<p><span class="math display">\[
\theta^{(k+1)} = \theta^{(k)} - \alpha \nabla SSE(\theta^{(k)}),
\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is the <strong>learning rate</strong>.</p>
<p><strong>2. Second-Order Approximation (Newton’s Method)</strong></p>
<p>The <strong>Hessian matrix</strong> of SSE is:</p>
<p><span class="math display">\[
H_{SSE}(\theta) = 2 \sum_{i=1}^{n} \nabla f(x_i; \theta) \nabla f(x_i; \theta)^T - 2 \sum_{i=1}^{n} (y_i - f(x_i; \theta)) H_f(x_i; \theta).
\]</span></p>
<p>The <strong>Newton-Raphson update</strong> becomes:</p>
<p><span class="math display">\[
\theta^{(k+1)} = \theta^{(k)} - H_{SSE}(\theta)^{-1} \nabla SSE(\theta).
\]</span></p>
<hr>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/">numDeriv</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">|</span></span>
<span>                      <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Avoid NA errors</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># First-Order Approximation: Gradient Descent Optimization</span></span>
<span><span class="va">gradient_descent</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.005</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># Initial guess</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">grad_sse</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>                    <span class="fu">sse</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="va">theta</span><span class="op">)</span>  <span class="co"># Compute gradient</span></span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span></span>
<span>                <span class="va">theta</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">grad_sse</span>  <span class="co"># Update parameters</span></span>
<span>            </span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span></span>
<span>                <span class="kw">break</span>  <span class="co"># Check convergence</span></span>
<span>            <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Second-Order Approximation: Newton's Method with Regularization</span></span>
<span><span class="va">newton_method</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>,</span>
<span>             <span class="va">y</span>,</span>
<span>             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>,</span>
<span>             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>             <span class="va">lambda</span> <span class="op">=</span> <span class="fl">1e-4</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># Initial guess</span></span>
<span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">grad_sse</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>                    <span class="fu">sse</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="va">theta</span><span class="op">)</span>  <span class="co"># Compute gradient</span></span>
<span>            <span class="va">hessian_sse</span> <span class="op">&lt;-</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/hessian.html">hessian</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>                    <span class="fu">sse</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="va">theta</span><span class="op">)</span>  <span class="co"># Compute Hessian</span></span>
<span>            </span>
<span>            <span class="co"># Regularize Hessian to avoid singularity</span></span>
<span>            <span class="va">hessian_reg</span> <span class="op">&lt;-</span></span>
<span>                <span class="va">hessian_sse</span> <span class="op">+</span> <span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Ensure Hessian is invertible</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Matrix-class.html">det</a></span><span class="op">(</span><span class="va">hessian_reg</span><span class="op">)</span><span class="op">)</span> <span class="op">||</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Matrix-class.html">det</a></span><span class="op">(</span><span class="va">hessian_reg</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-10</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/message.html">message</a></span><span class="op">(</span><span class="st">"Singular Hessian found; increasing regularization."</span><span class="op">)</span></span>
<span>                <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">lambda</span> <span class="op">*</span> <span class="fl">10</span>  <span class="co"># Increase regularization</span></span>
<span>                <span class="kw">next</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Newton update</span></span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">hessian_reg</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">grad_sse</span></span>
<span>            </span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span></span>
<span>                <span class="kw">break</span>  <span class="co"># Check convergence</span></span>
<span>            <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>        <span class="op">}</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Gradient Descent</span></span>
<span><span class="va">estimated_theta_gd</span> <span class="op">&lt;-</span> <span class="fu">gradient_descent</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Newton's Method with Regularization</span></span>
<span><span class="va">estimated_theta_newton</span> <span class="op">&lt;-</span> <span class="fu">newton_method</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Gradient Descent:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Gradient Descent:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta_gd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.06876224 1.42766371 0.01128539</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Newton's Method:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Newton's Method:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta_newton</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]</span></span>
<span><span class="co">#&gt; [1,] 4.06876368</span></span>
<span><span class="co">#&gt; [2,] 1.42766047</span></span>
<span><span class="co">#&gt; [3,] 0.01128636</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Taylor Series Approximation: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta_gd</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    lty <span class="op">=</span> <span class="fl">2</span>  <span class="co"># Dashed line to differentiate Gradient Descent</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta_newton</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Gradient Descent"</span>, <span class="st">"Newton's Method (Regularized)"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-21-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="log-linearization-nonlinear-optimization" class="section level4" number="6.2.4.2">
<h4>
<span class="header-section-number">6.2.4.2</span> Log-Linearization<a class="anchor" aria-label="anchor" href="#log-linearization-nonlinear-optimization"><i class="fas fa-link"></i></a>
</h4>
<p>Log-Linearization is a mathematical technique used to transform nonlinear models into linear models by taking the logarithm of both sides. This transformation simplifies parameter estimation and enables the use of linear regression techniques on originally nonlinear functions.</p>
<p>Log-linearization is particularly useful when:</p>
<ul>
<li><p>The model exhibits exponential, power-law, or logistic growth behavior.</p></li>
<li><p>Linear regression methods are preferred over nonlinear optimization.</p></li>
<li><p>A linearized version provides better interpretability and computational efficiency.</p></li>
</ul>
<hr>
<p>A <strong>nonlinear model</strong> can often be expressed in the form:</p>
<p><span class="math display">\[
y = f(x; \theta).
\]</span></p>
<p>Applying a <strong>log transformation</strong>, we obtain:</p>
<p><span class="math display">\[
\log y = g(x; \theta),
\]</span></p>
<p>where <span class="math inline">\(g(x; \theta)\)</span> is now <strong>linear in parameters</strong>. We then estimate <span class="math inline">\(\theta\)</span> using <a href="linear-regression.html#ordinary-least-squares">Ordinary Least Squares</a>.</p>
<p><strong>Example 1: Exponential Model</strong></p>
<p>Consider an <strong>exponential growth model</strong>:</p>
<p><span class="math display">\[
y = A e^{Bx}.
\]</span></p>
<p>Taking the natural logarithm:</p>
<p><span class="math display">\[
\log y = \log A + Bx.
\]</span></p>
<p>This is now <strong>linear in</strong> <span class="math inline">\(\log y\)</span>, allowing estimation via <strong>linear regression</strong>.</p>
<p><strong>Example 2: Power Law Model</strong></p>
<p>For a <strong>power law function</strong>:</p>
<p><span class="math display">\[
y = A x^B.
\]</span></p>
<p>Taking logs:</p>
<p><span class="math display">\[
\log y = \log A + B \log x.
\]</span></p>
<p>Again, this is <strong>linearized</strong>, making it solvable via <strong>OLS regression</strong>.</p>
<hr>
<p><strong>Log-Linearization Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Apply the logarithm transformation to the dependent variable.</li>
<li>Transform the equation into a linear form.</li>
<li>Use linear regression (OLS) to estimate parameters.</li>
<li>Convert parameters back to original scale if necessary.</li>
</ol>
<hr>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate synthetic data for an exponential model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_A</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">true_B</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">true_A</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">true_B</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply logarithmic transformation</span></span>
<span><span class="va">log_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit linear regression model</span></span>
<span><span class="va">log_linear_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">log_y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract estimated parameters</span></span>
<span><span class="va">estimated_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">log_linear_model</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>  <span class="co"># Slope in log-space</span></span>
<span><span class="va">estimated_A</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">log_linear_model</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Intercept (back-transformed)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B) using Log-Linearization:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B) using Log-Linearization:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">estimated_A</span>, <span class="va">estimated_B</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; (Intercept)           x </span></span>
<span><span class="co">#&gt;   2.0012577   0.3001223</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Log-Linearization: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="va">estimated_A</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">estimated_B</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Log-Linear Model"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-22-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="hybrid-nonlinear-regression-optimization" class="section level3" number="6.2.5">
<h3>
<span class="header-section-number">6.2.5</span> Hybrid<a class="anchor" aria-label="anchor" href="#hybrid-nonlinear-regression-optimization"><i class="fas fa-link"></i></a>
</h3>
<div id="adaptive-levenberg-marquardt" class="section level4" number="6.2.5.1">
<h4>
<span class="header-section-number">6.2.5.1</span> Adaptive Levenberg-Marquardt<a class="anchor" aria-label="anchor" href="#adaptive-levenberg-marquardt"><i class="fas fa-link"></i></a>
</h4>
<p>The <strong>Levenberg-Marquardt Algorithm (LMA)</strong> is a powerful <strong>nonlinear least squares optimization method</strong> that adaptively combines:</p>
<ul>
<li><p><a href="non-linear-regression.html#gauss-newton-algorithm">Gauss-Newton Algorithm</a> for fast convergence near the solution.</p></li>
<li><p><a href="non-linear-regression.html#steepest-descent">Steepest Descent (Gradient Descent)</a> for stability when far from the solution.</p></li>
</ul>
<p>The Adaptive Levenberg-Marquardt Algorithm further adjusts the damping parameter <span class="math inline">\(\tau\)</span> dynamically, making it more efficient in practice.</p>
<hr>
<p>Given an objective function <strong>Sum of Squared Errors (SSE)</strong>:</p>
<p><span class="math display">\[
SSE(\theta) = \sum_{i=1}^{n} (y_i - f(x_i; \theta))^2.
\]</span></p>
<p>The <strong>update rule for LMA</strong> is:</p>
<p><span class="math display">\[
\hat{\theta}^{(j+1)} = \hat{\theta}^{(j)} - \alpha_j [\mathbf{F}(\hat{\theta}^{(j)})' \mathbf{F}(\hat{\theta}^{(j)}) + \tau \mathbf{I}_{p \times p}]\frac{\partial \mathbf{Q}(\hat{\theta}^{(j)})}{\partial \theta}.
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\tau\)</span> is the <strong>adaptive damping parameter</strong>.</p></li>
<li><p><span class="math inline">\(\mathbf{I}_{p \times p}\)</span> is the <strong>identity matrix</strong>.</p></li>
<li><p><span class="math inline">\(\mathbf{F}(\hat{\theta}^{(j)})\)</span> is the <strong>Jacobian matrix</strong> of partial derivatives.</p></li>
<li><p><span class="math inline">\(\frac{\partial \mathbf{Q}(\hat{\theta}^{(j)})}{\partial \theta}\)</span> is the <strong>gradient vector</strong>.</p></li>
<li><p><span class="math inline">\(\alpha_j\)</span> is the <strong>learning rate</strong>.</p></li>
</ul>
<p>The key <strong>adaptation rule for</strong> <span class="math inline">\(\tau\)</span>:</p>
<ul>
<li><p><strong>If the new step decreases SSE</strong>, <strong>reduce</strong> <span class="math inline">\(\tau\)</span>: <span class="math display">\[
  \tau \gets \tau / 10.
  \]</span></p></li>
<li><p><strong>Otherwise, increase</strong> <span class="math inline">\(\tau\)</span> to ensure stability: <span class="math display">\[
  \tau \gets 10\tau.
  \]</span></p></li>
</ul>
<p>This adjustment <strong>ensures a balance between stability and efficiency</strong>.</p>
<hr>
<p><strong>Adaptive Levenberg-Marquardt Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Initialize parameters <span class="math inline">\(\theta_0\)</span>, damping factor <span class="math inline">\(\tau\)</span>.</li>
<li>Compute Jacobian <span class="math inline">\(\mathbf{F}(\hat{\theta}^{(j)})\)</span>.</li>
<li>Compute step direction using modified Gauss-Newton update.</li>
<li>Adjust <span class="math inline">\(\tau\)</span> dynamically:
<ul>
<li>Decrease <span class="math inline">\(\tau\)</span> if SSE improves.</li>
<li>Increase <span class="math inline">\(\tau\)</span> if SSE worsens.</li>
</ul>
</li>
<li>Repeat until convergence.</li>
</ol>
<hr>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://optimizer.r-forge.r-project.org/">numDeriv</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define a numerically stable logistic function</span></span>
<span><span class="va">safe_exp</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">700</span>, <span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmin</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">700</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Prevent overflow</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the logistic growth model</span></span>
<span><span class="va">nonlinear_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">safe_exp</span><span class="op">(</span><span class="op">-</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define the Sum of Squared Errors (SSE) function</span></span>
<span><span class="va">sse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">predictions</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">predictions</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Adaptive Levenberg-Marquardt Optimization</span></span>
<span><span class="va">adaptive_lm_optimization</span> <span class="op">&lt;-</span></span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span>, <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># Initial parameter guess</span></span>
<span>        <span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">1e-3</span>  <span class="co"># Initial damping parameter</span></span>
<span>        <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co"># Step size scaling</span></span>
<span>        <span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>        </span>
<span>        <span class="kw">while</span> <span class="op">(</span><span class="va">iter</span> <span class="op">&lt;</span> <span class="va">max_iter</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">iter</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>            </span>
<span>            <span class="co"># Compute Jacobian numerically</span></span>
<span>            <span class="va">J</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/jacobian.html">jacobian</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span>
<span>                <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span><span class="op">)</span>, <span class="va">theta</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Compute gradient of SSE</span></span>
<span>            <span class="va">residuals</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>            <span class="va">grad_sse</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">residuals</span></span>
<span>            </span>
<span>            <span class="co"># Compute Hessian approximation</span></span>
<span>            <span class="va">H</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">J</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">J</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Compute parameter update step</span></span>
<span>            <span class="va">delta_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">H</span>, <span class="va">grad_sse</span><span class="op">)</span></span>
<span>            </span>
<span>            <span class="co"># Trial step</span></span>
<span>            <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">-</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">delta_theta</span></span>
<span>            </span>
<span>            <span class="co"># Compute SSE for new parameters</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu">sse</span><span class="op">(</span><span class="va">theta_new</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu">sse</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="co"># Accept step, decrease tau</span></span>
<span>                <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>                <span class="va">tau</span> <span class="op">&lt;-</span> <span class="va">tau</span> <span class="op">/</span> <span class="fl">10</span></span>
<span>            <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>                <span class="co"># Reject step, increase tau</span></span>
<span>                <span class="va">tau</span> <span class="op">&lt;-</span> <span class="va">tau</span> <span class="op">*</span> <span class="fl">10</span></span>
<span>            <span class="op">}</span></span>
<span>            </span>
<span>            <span class="co"># Check convergence</span></span>
<span>            <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">delta_theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span></span>
<span>                <span class="kw">break</span></span>
<span>        <span class="op">}</span></span>
<span>        </span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">true_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span>  <span class="co"># True parameters (A, B, C)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">true_theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run Adaptive Levenberg-Marquardt Optimization</span></span>
<span><span class="va">estimated_theta</span> <span class="op">&lt;-</span> <span class="fu">adaptive_lm_optimization</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Estimated parameters (A, B, C) using Adaptive Levenberg-Marquardt:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimated parameters (A, B, C) using Adaptive Levenberg-Marquardt:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">estimated_theta</span><span class="op">)</span></span>
<span><span class="co">#&gt;            [,1]</span></span>
<span><span class="co">#&gt; [1,] 4.06876562</span></span>
<span><span class="co">#&gt; [2,] 1.42765612</span></span>
<span><span class="co">#&gt; [3,] 0.01128767</span></span>
<span></span>
<span><span class="co"># Plot data and fitted curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>    <span class="va">x</span>,</span>
<span>    <span class="va">y</span>,</span>
<span>    main <span class="op">=</span> <span class="st">"Adaptive Levenberg-Marquardt: Nonlinear Regression Optimization"</span>,</span>
<span>    pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>    cex <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/curve.html">curve</a></span><span class="op">(</span></span>
<span>    <span class="fu">nonlinear_model</span><span class="op">(</span><span class="va">estimated_theta</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    add <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>    lwd <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>    <span class="st">"topleft"</span>,</span>
<span>    legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="st">"Fitted Curve"</span><span class="op">)</span>,</span>
<span>    pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-23-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="comparison-of-nonlinear-optimizers" class="section level3" number="6.2.6">
<h3>
<span class="header-section-number">6.2.6</span> Comparison of Nonlinear Optimizers<a class="anchor" aria-label="anchor" href="#comparison-of-nonlinear-optimizers"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ALL-IN-ONE R SCRIPT COMPARING MULTIPLE NONLINEAR-REGRESSION OPTIMIZERS</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">minpack.lm</span><span class="op">)</span> <span class="co"># nlsLM (Levenberg-Marquardt)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">dfoptim</span><span class="op">)</span>    <span class="co"># Powell (nmk), Hooke-Jeeves</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://astamm.github.io/nloptr/index.html">nloptr</a></span><span class="op">)</span>     <span class="co"># trust-region reflective</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://luca-scr.github.io/GA/">GA</a></span><span class="op">)</span>         <span class="co"># genetic algorithm</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ArdiaD/DEoptim">DEoptim</a></span><span class="op">)</span>    <span class="co"># differential evolution</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">GenSA</span><span class="op">)</span>      <span class="co"># simulated annealing</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">pso</span><span class="op">)</span>        <span class="co"># particle swarm</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>       <span class="co"># for ginv fallback</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/microbenchmark/">microbenchmark</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># -- 1) DEFINE MODELS (SIMPLE VS COMPLEX) ---</span></span>
<span></span>
<span><span class="co"># 3-parameter logistic</span></span>
<span><span class="va">f_logistic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">A</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">B</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sse_logistic</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">f_logistic</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4-parameter "extended" model</span></span>
<span><span class="va">f_complex</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">A</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">B</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span>  <span class="va">D</span> <span class="op">&lt;-</span> <span class="va">theta</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="va">A</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">B</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">D</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">sse_complex</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fu">f_complex</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate synthetic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">x_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length.out <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="co"># "simple" scenario</span></span>
<span><span class="va">true_theta_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.5</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">y_data_simple</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">f_logistic</span><span class="op">(</span><span class="va">true_theta_simple</span>, <span class="va">x_data</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="co"># "complex" scenario</span></span>
<span><span class="va">true_theta_complex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1.2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">y_data_complex</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">f_complex</span><span class="op">(</span><span class="va">true_theta_complex</span>, <span class="va">x_data</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># -- 2) OPTIMIZERS (EXCEPT BISECTION) ----</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># All methods share signature:</span></span>
<span><span class="co">#   FUN(par, x, y, sse_fn, model_fn, lower=NULL, upper=NULL, ...)</span></span>
<span><span class="co"># Some do not strictly use lower/upper if unconstrained.</span></span>
<span></span>
<span><span class="co"># 2.1 Gauss–Newton</span></span>
<span><span class="va">gauss_newton_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                             <span class="va">x</span>,</span>
<span>                             <span class="va">y</span>,</span>
<span>                             <span class="va">sse_fn</span>,</span>
<span>                             <span class="va">model_fn</span>,</span>
<span>                             <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                             <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">iter</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">eps</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span>    <span class="va">nP</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>    <span class="va">Fmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">nP</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">nP</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pert</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>      <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span></span>
<span>      <span class="va">Fmat</span><span class="op">[</span>, <span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>        <span class="op">(</span><span class="fu">model_fn</span><span class="op">(</span><span class="va">pert</span>, <span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu">model_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">eps</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">model_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">delta</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Fmat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">Fmat</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Fmat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">r</span><span class="op">)</span>,</span>
<span>      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># fallback to pseudoinverse</span></span>
<span>        <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/ginv.html">ginv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Fmat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">Fmat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Fmat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">r</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">+</span> <span class="va">delta</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">theta</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.2 Modified Gauss-Newton (with step halving)</span></span>
<span><span class="va">modified_gauss_newton_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                                      <span class="va">x</span>,</span>
<span>                                      <span class="va">y</span>,</span>
<span>                                      <span class="va">sse_fn</span>,</span>
<span>                                      <span class="va">model_fn</span>,</span>
<span>                                      <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                      <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">iter</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">eps</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span>    <span class="va">nP</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span></span>
<span>    <span class="va">Fmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">nP</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">nP</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pert</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>      <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span></span>
<span>      <span class="va">Fmat</span><span class="op">[</span>, <span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span></span>
<span>        <span class="op">(</span><span class="fu">model_fn</span><span class="op">(</span><span class="va">pert</span>, <span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fu">model_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="va">eps</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="fu">model_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">lhs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Fmat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">Fmat</span></span>
<span>    <span class="va">rhs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Fmat</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">r</span></span>
<span>    <span class="va">delta</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">lhs</span>, <span class="va">rhs</span><span class="op">)</span>,</span>
<span>      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span>        <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/ginv.html">ginv</a></span><span class="op">(</span><span class="va">lhs</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">rhs</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">sse_old</span> <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">new_sse</span> <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">theta</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">delta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="va">new_sse</span> <span class="op">&lt;</span> <span class="va">sse_old</span><span class="op">)</span></span>
<span>        <span class="kw">break</span></span>
<span>      <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">alpha</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">+</span> <span class="va">alpha</span> <span class="op">*</span> <span class="va">delta</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">theta</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.3 Steepest Descent (Gradient Descent)</span></span>
<span><span class="va">steepest_descent_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                                 <span class="va">x</span>,</span>
<span>                                 <span class="va">y</span>,</span>
<span>                                 <span class="va">sse_fn</span>,</span>
<span>                                 <span class="va">model_fn</span>,</span>
<span>                                 <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                 <span class="va">lr</span> <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                                 <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                                 <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">iter</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">eps</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span>    <span class="va">f0</span>  <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pert</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>      <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span></span>
<span>      <span class="va">grad</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">sse_fn</span><span class="op">(</span><span class="va">pert</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="va">f0</span><span class="op">)</span> <span class="op">/</span> <span class="va">eps</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">-</span> <span class="va">lr</span> <span class="op">*</span> <span class="va">grad</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">theta</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.4 Levenberg–Marquardt (nlsLM)</span></span>
<span><span class="va">lm_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                   <span class="va">x</span>,</span>
<span>                   <span class="va">y</span>,</span>
<span>                   <span class="va">sse_fn</span>,</span>
<span>                   <span class="va">model_fn</span>,</span>
<span>                   <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   <span class="va">form</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"simple"</span>, <span class="st">"complex"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.arg.html">match.arg</a></span><span class="op">(</span><span class="va">form</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">form</span> <span class="op">==</span> <span class="st">"simple"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minpack.lm/man/nlsLM.html">nlsLM</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">B</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                              B <span class="op">=</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                              C <span class="op">=</span> <span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/minpack.lm/man/nlsLM.html">nlsLM</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">A</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">B</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">D</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span>,</span>
<span>                 start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>                   A <span class="op">=</span> <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                   B <span class="op">=</span> <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                   C <span class="op">=</span> <span class="va">par</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>                   D <span class="op">=</span> <span class="va">par</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span></span>
<span>                 <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.5 Newton–Raphson (with numeric Hessian, fallback if singular)</span></span>
<span><span class="va">newton_raphson_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                               <span class="va">x</span>,</span>
<span>                               <span class="va">y</span>,</span>
<span>                               <span class="va">sse_fn</span>,</span>
<span>                               <span class="va">model_fn</span>,</span>
<span>                               <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                               <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                               <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                               <span class="va">tol</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">par</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">eps</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span>    <span class="va">f0</span>  <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">grad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pert</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>      <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pert</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span></span>
<span>      <span class="va">grad</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">sse_fn</span><span class="op">(</span><span class="va">pert</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="va">f0</span><span class="op">)</span> <span class="op">/</span> <span class="va">eps</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">Hess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pert_p</span> <span class="op">&lt;-</span> <span class="va">theta</span></span>
<span>      <span class="va">pert_p</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pert_p</span><span class="op">[</span><span class="va">p</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span></span>
<span>      <span class="va">f_p</span> <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pert_p</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>      <span class="kw">for</span> <span class="op">(</span><span class="va">q</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">pert_q</span> <span class="op">&lt;-</span> <span class="va">pert_p</span></span>
<span>        <span class="va">pert_q</span><span class="op">[</span><span class="va">q</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pert_q</span><span class="op">[</span><span class="va">q</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span></span>
<span>        <span class="va">Hess</span><span class="op">[</span><span class="va">p</span>, <span class="va">q</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">sse_fn</span><span class="op">(</span><span class="va">pert_q</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">-</span></span>
<span>                         <span class="va">f_p</span> <span class="op">-</span> <span class="op">(</span><span class="va">f0</span> <span class="op">-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">theta</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">eps</span> <span class="op">^</span></span>
<span>                                                                <span class="fl">2</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">delta</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="va">Hess</span>, <span class="va">grad</span><span class="op">)</span>,</span>
<span>      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span>        <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/ginv.html">ginv</a></span><span class="op">(</span><span class="va">Hess</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">grad</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">theta_new</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">-</span> <span class="va">delta</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">theta_new</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="va">tol</span><span class="op">)</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="va">theta</span> <span class="op">&lt;-</span> <span class="va">theta_new</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">theta</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.6 Quasi–Newton (BFGS via optim)</span></span>
<span><span class="va">quasi_newton_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                             <span class="va">x</span>,</span>
<span>                             <span class="va">y</span>,</span>
<span>                             <span class="va">sse_fn</span>,</span>
<span>                             <span class="va">model_fn</span>,</span>
<span>                             <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>    <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="va">par</span>, <span class="va">fn</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.7 Trust-region reflective (nloptr)</span></span>
<span><span class="va">trust_region_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                             <span class="va">x</span>,</span>
<span>                             <span class="va">y</span>,</span>
<span>                             <span class="va">sse_fn</span>,</span>
<span>                             <span class="va">model_fn</span>,</span>
<span>                             <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                             <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="co"># numeric gradient</span></span>
<span>  <span class="va">grad_numeric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span>, <span class="va">eps</span> <span class="op">=</span> <span class="fl">1e-6</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">g</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">f0</span> <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">pp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">p2</span> <span class="op">&lt;-</span> <span class="va">pp</span></span>
<span>      <span class="va">p2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">p2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">eps</span></span>
<span>      <span class="va">g</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu">sse_fn</span><span class="op">(</span><span class="va">p2</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="va">f0</span><span class="op">)</span> <span class="op">/</span> <span class="va">eps</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">g</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">eval_f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">gr</span>  <span class="op">&lt;-</span> <span class="fu">grad_numeric</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>objective <span class="op">=</span> <span class="va">val</span>, gradient <span class="op">=</span> <span class="va">gr</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">lb</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">else</span></span>
<span>    <span class="va">lower</span></span>
<span>  <span class="va">ub</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">else</span></span>
<span>    <span class="va">upper</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nloptr/man/nloptr.html">nloptr</a></span><span class="op">(</span></span>
<span>    x0 <span class="op">=</span> <span class="va">par</span>,</span>
<span>    eval_f <span class="op">=</span> <span class="va">eval_f</span>,</span>
<span>    lb <span class="op">=</span> <span class="va">lb</span>,</span>
<span>    ub <span class="op">=</span> <span class="va">ub</span>,</span>
<span>    opts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      algorithm <span class="op">=</span> <span class="st">"NLOPT_LD_TNEWTON"</span>,</span>
<span>      maxeval <span class="op">=</span> <span class="fl">500</span>,</span>
<span>      xtol_rel <span class="op">=</span> <span class="fl">1e-6</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">solution</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.8 Grid search</span></span>
<span><span class="va">grid_search_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                            <span class="va">x</span>,</span>
<span>                            <span class="va">y</span>,</span>
<span>                            <span class="va">sse_fn</span>,</span>
<span>                            <span class="va">model_fn</span>,</span>
<span>                            <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                            <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                            <span class="va">grid_defs</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">grid_defs</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"Must provide grid_defs for multi-parameter grid search."</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">grid_defs</span><span class="op">)</span></span>
<span>  <span class="va">g</span><span class="op">$</span><span class="va">SSE</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">g</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">rowp</span><span class="op">)</span></span>
<span>      <span class="fu">sse_fn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">rowp</span><span class="op">)</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">best_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">SSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="va">best_idx</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">grid_defs</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.9 Nelder-Mead</span></span>
<span><span class="va">nelder_mead_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                            <span class="va">x</span>,</span>
<span>                            <span class="va">y</span>,</span>
<span>                            <span class="va">sse_fn</span>,</span>
<span>                            <span class="va">model_fn</span>,</span>
<span>                            <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                            <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>    <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span><span class="va">par</span>, <span class="va">fn</span>, method <span class="op">=</span> <span class="st">"Nelder-Mead"</span><span class="op">)</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.10 Powell’s method (dfoptim::nmk for unconstrained)</span></span>
<span><span class="va">powell_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>           <span class="va">x</span>,</span>
<span>           <span class="va">y</span>,</span>
<span>           <span class="va">sse_fn</span>,</span>
<span>           <span class="va">model_fn</span>,</span>
<span>           <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>           <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>      <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="fu">dfoptim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dfoptim/man/nmkb.html">nmk</a></span><span class="op">(</span><span class="va">par</span>, <span class="va">fn</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.11 Hooke-Jeeves (dfoptim::hjkb)</span></span>
<span><span class="va">hooke_jeeves_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>           <span class="va">x</span>,</span>
<span>           <span class="va">y</span>,</span>
<span>           <span class="va">sse_fn</span>,</span>
<span>           <span class="va">model_fn</span>,</span>
<span>           <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>           <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>      <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="fu">dfoptim</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dfoptim/man/hookejeeves.html">hjkb</a></span><span class="op">(</span><span class="va">par</span>, <span class="va">fn</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.12 Random Search</span></span>
<span><span class="va">random_search_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                              <span class="va">x</span>,</span>
<span>                              <span class="va">y</span>,</span>
<span>                              <span class="va">sse_fn</span>,</span>
<span>                              <span class="va">model_fn</span>,</span>
<span>                              <span class="va">lower</span>,</span>
<span>                              <span class="va">upper</span>,</span>
<span>                              <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>                              <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">best_par</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span>  <span class="va">dimp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">max_iter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">candidate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="va">dimp</span>, min <span class="op">=</span> <span class="va">lower</span>, max <span class="op">=</span> <span class="va">upper</span><span class="op">)</span></span>
<span>    <span class="va">val</span> <span class="op">&lt;-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">candidate</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">val</span> <span class="op">&lt;</span> <span class="va">best_sse</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">best_sse</span> <span class="op">&lt;-</span> <span class="va">val</span></span>
<span>      <span class="va">best_par</span> <span class="op">&lt;-</span> <span class="va">candidate</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">best_par</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.13 Differential Evolution (DEoptim)</span></span>
<span><span class="va">diff_evo_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                         <span class="va">x</span>,</span>
<span>                         <span class="va">y</span>,</span>
<span>                         <span class="va">sse_fn</span>,</span>
<span>                         <span class="va">model_fn</span>,</span>
<span>                         <span class="va">lower</span>,</span>
<span>                         <span class="va">upper</span>,</span>
<span>                         <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                         <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span></span>
<span>    <span class="fu">sse_fn</span><span class="op">(</span><span class="va">v</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.html">DEoptim</a></span><span class="op">(</span><span class="va">fn</span>,</span>
<span>                 lower <span class="op">=</span> <span class="va">lower</span>,</span>
<span>                 upper <span class="op">=</span> <span class="va">upper</span>,</span>
<span>                 <span class="fu"><a href="https://rdrr.io/pkg/DEoptim/man/DEoptim.control.html">DEoptim.control</a></span><span class="op">(</span>NP <span class="op">=</span> <span class="fl">50</span>, itermax <span class="op">=</span> <span class="va">max_iter</span>, trace <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">optim</span><span class="op">$</span><span class="va">bestmem</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.14 Simulated Annealing (GenSA)</span></span>
<span><span class="va">sim_anneal_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                           <span class="va">x</span>,</span>
<span>                           <span class="va">y</span>,</span>
<span>                           <span class="va">sse_fn</span>,</span>
<span>                           <span class="va">model_fn</span>,</span>
<span>                           <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                           <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                           <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>    <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">lb</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">lower</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">else</span></span>
<span>    <span class="va">lower</span></span>
<span>  <span class="va">ub</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">upper</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">par</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">else</span></span>
<span>    <span class="va">upper</span></span>
<span>  <span class="co"># GenSA requires: GenSA(par, fn, lower, upper, control=list(...))</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/GenSA/man/GenSA.html">GenSA</a></span><span class="op">(</span></span>
<span>      <span class="va">par</span>,</span>
<span>      <span class="va">fn</span>,</span>
<span>      lower <span class="op">=</span> <span class="va">lb</span>,</span>
<span>      upper <span class="op">=</span> <span class="va">ub</span>,</span>
<span>      control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>max.call <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.15 Genetic Algorithm (GA)</span></span>
<span><span class="va">genetic_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                        <span class="va">x</span>,</span>
<span>                        <span class="va">y</span>,</span>
<span>                        <span class="va">sse_fn</span>,</span>
<span>                        <span class="va">model_fn</span>,</span>
<span>                        <span class="va">lower</span>,</span>
<span>                        <span class="va">upper</span>,</span>
<span>                        <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                        <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">fitness_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>    <span class="op">-</span> <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">gares</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://github.com/luca-scr/GA/reference/ga.html">ga</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"real-valued"</span>,</span>
<span>    fitness <span class="op">=</span> <span class="va">fitness_fun</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">lower</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">upper</span>,</span>
<span>    popSize <span class="op">=</span> <span class="fl">50</span>,</span>
<span>    maxiter <span class="op">=</span> <span class="va">max_iter</span>,</span>
<span>    run <span class="op">=</span> <span class="fl">50</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">gares</span><span class="op">@</span><span class="va">solution</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 2.16 Particle Swarm (pso)</span></span>
<span><span class="va">particle_swarm_fit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span>,</span>
<span>                               <span class="va">x</span>,</span>
<span>                               <span class="va">y</span>,</span>
<span>                               <span class="va">sse_fn</span>,</span>
<span>                               <span class="va">model_fn</span>,</span>
<span>                               <span class="va">lower</span>,</span>
<span>                               <span class="va">upper</span>,</span>
<span>                               <span class="va">max_iter</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                               <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pp</span><span class="op">)</span></span>
<span>    <span class="fu">sse_fn</span><span class="op">(</span><span class="va">pp</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pso/man/psoptim.html">psoptim</a></span><span class="op">(</span></span>
<span>    par <span class="op">=</span> <span class="op">(</span><span class="va">lower</span> <span class="op">+</span> <span class="va">upper</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>    fn <span class="op">=</span> <span class="va">fn</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">lower</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">upper</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="va">max_iter</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">res</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># -- 3) RUN METHOD WRAPPER ---</span></span>
<span><span class="va">run_method</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">method_name</span>,</span>
<span>                       <span class="va">FUN</span>,</span>
<span>                       <span class="va">par_init</span>,</span>
<span>                       <span class="va">x</span>,</span>
<span>                       <span class="va">y</span>,</span>
<span>                       <span class="va">sse_fn</span>,</span>
<span>                       <span class="va">model_fn</span>,</span>
<span>                       <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                       <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                       <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/microbenchmark/man/microbenchmark.html">microbenchmark</a></span><span class="op">(</span>result <span class="op">=</span> <span class="op">{</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">FUN</span><span class="op">(</span><span class="va">par_init</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">sse_fn</span>, <span class="va">model_fn</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">...</span><span class="op">)</span></span>
<span>    <span class="va">out</span></span>
<span>  <span class="op">}</span>, times <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">final_par</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu">FUN</span><span class="op">(</span><span class="va">par_init</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">sse_fn</span>, <span class="va">model_fn</span>, <span class="va">lower</span>, <span class="va">upper</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">final_par</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># e.g. placeholders that return NULL</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>      Method <span class="op">=</span> <span class="va">method_name</span>,</span>
<span>      Parameters <span class="op">=</span> <span class="st">"N/A"</span>,</span>
<span>      SSE <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>      Time_ms <span class="op">=</span> <span class="cn">NA</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Method     <span class="op">=</span> <span class="va">method_name</span>,</span>
<span>    Parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">final_par</span>, <span class="fl">4</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,</span>
<span>    SSE        <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">sse_fn</span><span class="op">(</span><span class="va">final_par</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>    Time_ms    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">mb</span><span class="op">$</span><span class="va">time</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># -- 4) MASTER FUNCTION TO COMPARE ALL METHODS (SIMPLE / COMPLEX) ---</span></span>
<span></span>
<span><span class="va">compare_all_methods</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">is_complex</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">is_complex</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># SIMPLE (3-param logistic)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x_data</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y_data_simple</span></span>
<span>    <span class="va">sse_fn</span>   <span class="op">&lt;-</span> <span class="va">sse_logistic</span></span>
<span>    <span class="va">model_fn</span> <span class="op">&lt;-</span> <span class="va">f_logistic</span></span>
<span>    <span class="va">init_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span>    <span class="va">grid_defs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>      C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>,<span class="op">-</span><span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">3</span>,  <span class="fl">3</span><span class="op">)</span></span>
<span>    <span class="va">lm_form</span> <span class="op">&lt;-</span> <span class="st">"simple"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># COMPLEX (4-param model)</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x_data</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y_data_complex</span></span>
<span>    <span class="va">sse_fn</span>   <span class="op">&lt;-</span> <span class="va">sse_complex</span></span>
<span>    <span class="va">model_fn</span> <span class="op">&lt;-</span> <span class="va">f_complex</span></span>
<span>    <span class="va">init_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>,<span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span>    <span class="va">grid_defs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, length.out <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      D <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>,<span class="op">-</span><span class="fl">3</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">3</span>,  <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">lm_form</span> <span class="op">&lt;-</span> <span class="st">"complex"</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># RUN each method</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Gauss-Newton"</span>,</span>
<span>      <span class="va">gauss_newton_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Modified Gauss-Newton"</span>,</span>
<span>      <span class="va">modified_gauss_newton_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Steepest Descent"</span>,</span>
<span>      <span class="va">steepest_descent_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Levenberg-Marquardt (nlsLM)"</span>,</span>
<span>      <span class="va">lm_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      form <span class="op">=</span> <span class="va">lm_form</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Newton-Raphson"</span>,</span>
<span>      <span class="va">newton_raphson_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Quasi-Newton (BFGS)"</span>,</span>
<span>      <span class="va">quasi_newton_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Trust-region Reflective"</span>,</span>
<span>      <span class="va">trust_region_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      <span class="va">lower</span>,</span>
<span>      <span class="va">upper</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Grid Search"</span>,</span>
<span>      <span class="va">grid_search_fit</span>,</span>
<span>      <span class="cn">NULL</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      grid_defs <span class="op">=</span> <span class="va">grid_defs</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Nelder-Mead"</span>,</span>
<span>      <span class="va">nelder_mead_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span><span class="st">"Powell's method"</span>,</span>
<span>               <span class="va">powell_fit</span>,</span>
<span>               <span class="va">init_par</span>,</span>
<span>               <span class="va">x</span>,</span>
<span>               <span class="va">y</span>,</span>
<span>               <span class="va">sse_fn</span>,</span>
<span>               <span class="va">model_fn</span><span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Hooke-Jeeves"</span>,</span>
<span>      <span class="va">hooke_jeeves_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Random Search"</span>,</span>
<span>      <span class="va">random_search_fit</span>,</span>
<span>      <span class="cn">NULL</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      <span class="va">lower</span>,</span>
<span>      <span class="va">upper</span>,</span>
<span>      max_iter <span class="op">=</span> <span class="fl">1000</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Differential Evolution"</span>,</span>
<span>      <span class="va">diff_evo_fit</span>,</span>
<span>      <span class="cn">NULL</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      <span class="va">lower</span>,</span>
<span>      <span class="va">upper</span>,</span>
<span>      max_iter <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Simulated Annealing"</span>,</span>
<span>      <span class="va">sim_anneal_fit</span>,</span>
<span>      <span class="va">init_par</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      <span class="va">lower</span>,</span>
<span>      <span class="va">upper</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Genetic Algorithm"</span>,</span>
<span>      <span class="va">genetic_fit</span>,</span>
<span>      <span class="cn">NULL</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      <span class="va">lower</span>,</span>
<span>      <span class="va">upper</span>,</span>
<span>      max_iter <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">run_method</span><span class="op">(</span></span>
<span>      <span class="st">"Particle Swarm"</span>,</span>
<span>      <span class="va">particle_swarm_fit</span>,</span>
<span>      <span class="cn">NULL</span>,</span>
<span>      <span class="va">x</span>,</span>
<span>      <span class="va">y</span>,</span>
<span>      <span class="va">sse_fn</span>,</span>
<span>      <span class="va">model_fn</span>,</span>
<span>      <span class="va">lower</span>,</span>
<span>      <span class="va">upper</span>,</span>
<span>      max_iter <span class="op">=</span> <span class="fl">50</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">out</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># -- 5) RUN &amp; VISUALIZE ----</span></span>
<span></span>
<span><span class="co"># Compare "simple" logistic (3 params)</span></span>
<span><span class="va">results_simple</span>  <span class="op">&lt;-</span> <span class="fu">compare_all_methods</span><span class="op">(</span>is_complex <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">results_simple</span><span class="op">$</span><span class="va">Problem</span> <span class="op">&lt;-</span> <span class="st">"Simple"</span></span>
<span></span>
<span><span class="co"># Compare "complex" (4 params)</span></span>
<span><span class="va">results_complex</span> <span class="op">&lt;-</span> <span class="fu">compare_all_methods</span><span class="op">(</span>is_complex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">results_complex</span><span class="op">$</span><span class="va">Problem</span> <span class="op">&lt;-</span> <span class="st">"Complex"</span></span>
<span></span>
<span><span class="co"># Combine</span></span>
<span><span class="va">all_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">results_simple</span>, <span class="va">results_complex</span><span class="op">)</span></span>
<span><span class="co"># print(all_results)</span></span>
<span><span class="co"># DT::datatable(all_results)</span></span>
<span></span>
<span><span class="co"># Example: SSE by method &amp; problem</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">all_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Method</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">SSE</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">Problem</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparison of SSE by Method &amp; Problem Complexity"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Log(Sum of Squared Errors)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-24-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Example: Time (ms) by method &amp; problem</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">all_results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Method</span>, y <span class="op">=</span> <span class="va">Time_ms</span>, fill <span class="op">=</span> <span class="va">Problem</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">11</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparison of Computation Time by Method &amp; Problem Complexity"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"Time (ms)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-24-2.png" width="90%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="practical-considerations-2" class="section level2" number="6.3">
<h2>
<span class="header-section-number">6.3</span> Practical Considerations<a class="anchor" aria-label="anchor" href="#practical-considerations-2"><i class="fas fa-link"></i></a>
</h2>
<p>For optimization algorithms to converge, they require good initial estimates of the parameters. The choice of starting values, constraints, and the complexity of the model all play a role in whether an optimization algorithm successfully finds a suitable solution.</p>
<div id="selecting-starting-values" class="section level3" number="6.3.1">
<h3>
<span class="header-section-number">6.3.1</span> Selecting Starting Values<a class="anchor" aria-label="anchor" href="#selecting-starting-values"><i class="fas fa-link"></i></a>
</h3>
<p>Choosing good starting values can significantly impact the efficiency and success of optimization algorithms. Several approaches can be used:</p>
<ul>
<li>
<strong>Prior or theoretical information</strong>: If prior knowledge about the parameters is available, it should be incorporated into the choice of initial values.</li>
<li>
<strong>Grid search or graphical inspection of</strong> <span class="math inline">\(SSE(\theta)\)</span>: Evaluating the sum of squared errors (SSE) across a grid of possible values can help identify promising starting points.</li>
<li>
<a href="linear-regression.html#ordinary-least-squares">Ordinary Least Squares</a> <strong>estimates</strong>: If a linear approximation of the model exists, using OLS to obtain initial estimates can be effective.</li>
<li>
<strong>Model interpretation</strong>: Understanding the structure and behavior of the model can provide intuition for reasonable starting values.</li>
<li>
<strong>Expected Value Parameterization</strong>: Reformulating the model based on expected values may improve the interpretability and numerical stability of the estimation.</li>
</ul>
<div id="grid-search-for-optimal-starting-values" class="section level4" number="6.3.1.1">
<h4>
<span class="header-section-number">6.3.1.1</span> Grid Search for Optimal Starting Values<a class="anchor" aria-label="anchor" href="#grid-search-for-optimal-starting-values"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate x as 100 integers using seq function</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate coefficients for exponential function</span></span>
<span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>  <span class="co"># Random coefficient a</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.005</span>, <span class="fl">0.075</span><span class="op">)</span>  <span class="co"># Random coefficient b</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">101</span>, <span class="fl">0</span>, <span class="fl">5</span><span class="op">)</span>  <span class="co"># Random noise</span></span>
<span></span>
<span><span class="co"># Generate y as a * e^(b*x) + c</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">b</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="va">c</span></span>
<span></span>
<span><span class="co"># Print the generated parameters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Generated coefficients:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Generated coefficients:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"a ="</span>, <span class="va">a</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; a = 5.75155</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"b ="</span>, <span class="va">b</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; b = 0.06018136</span></span>
<span></span>
<span><span class="co"># Define our data frame</span></span>
<span><span class="va">datf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define our model function</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">b</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Ensure all y values are positive (avoid log issues)</span></span>
<span><span class="va">y_adj</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">y</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1e-3</span><span class="op">)</span>  <span class="co"># Shift small values slightly</span></span>
<span></span>
<span><span class="co"># Create adjusted dataframe</span></span>
<span><span class="va">datf_adj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y_adj</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linearize by taking log(y)</span></span>
<span><span class="va">lin_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">y_adj</span><span class="op">)</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">datf_adj</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract starting values</span></span>
<span><span class="va">astrt</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Convert intercept back from log scale</span></span>
<span><span class="va">bstrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lin_mod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>  <span class="co"># Slope remains the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Starting values for non-linear fit:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">astrt</span>, <span class="va">bstrt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit nonlinear model with these starting values</span></span>
<span><span class="va">nlin_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">mod</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>                start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">astrt</span>, b <span class="op">=</span> <span class="va">bstrt</span><span class="op">)</span>,</span>
<span>                data <span class="op">=</span> <span class="va">datf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">nlin_mod</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot original data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">y</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Exponential Growth Fit"</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add fitted curve in red</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">nlin_mod</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span><span class="op">(</span></span>
<span>  <span class="st">"topleft"</span>,</span>
<span>  legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Original Data"</span>, <span class="st">"Fitted Model"</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>  pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  lwd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define grid of possible parameter values</span></span>
<span><span class="va">aseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">18</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">bseq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.075</span>, <span class="fl">0.001</span><span class="op">)</span></span>
<span></span>
<span><span class="va">na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">aseq</span><span class="op">)</span></span>
<span><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">bseq</span><span class="op">)</span></span>
<span><span class="va">SSout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">na</span> <span class="op">*</span> <span class="va">nb</span>, <span class="fl">3</span><span class="op">)</span>  <span class="co"># Matrix to store SSE values</span></span>
<span><span class="va">cnt</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Evaluate SSE across grid</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">na</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nb</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">cnt</span> <span class="op">&lt;-</span> <span class="va">cnt</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>    <span class="va">ypred</span> <span class="op">&lt;-</span></span>
<span>      <span class="co"># Evaluate model at these parameter values</span></span>
<span>      <span class="fu">mod</span><span class="op">(</span><span class="va">aseq</span><span class="op">[</span><span class="va">k</span><span class="op">]</span>, <span class="va">bseq</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, <span class="va">x</span><span class="op">)</span>  </span>
<span>    </span>
<span>    <span class="co"># Compute SSE</span></span>
<span>    <span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="va">ypred</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>  </span>
<span>    <span class="va">SSout</span><span class="op">[</span><span class="va">cnt</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">aseq</span><span class="op">[</span><span class="va">k</span><span class="op">]</span></span>
<span>    <span class="va">SSout</span><span class="op">[</span><span class="va">cnt</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">bseq</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>    <span class="va">SSout</span><span class="op">[</span><span class="va">cnt</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">ss</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Identify optimal starting values</span></span>
<span><span class="va">mn_indx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="va">SSout</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">astrt</span> <span class="op">&lt;-</span> <span class="va">SSout</span><span class="op">[</span><span class="va">mn_indx</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">bstrt</span> <span class="op">&lt;-</span> <span class="va">SSout</span><span class="op">[</span><span class="va">mn_indx</span>, <span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Fit nonlinear model using optimal starting values</span></span>
<span><span class="va">nlin_modG</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">mod</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">x</span><span class="op">)</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">astrt</span>, b <span class="op">=</span> <span class="va">bstrt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display model results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">nlin_modG</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: y ~ mod(a, b, x)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; a 5.889e+00  1.986e-02   296.6   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; b 5.995e-02  3.644e-05  1645.0   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 2.135 on 99 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 4 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 7.204e-06</span></span></code></pre></div>
<p>Note: The <code>nls_multstart</code> package can perform a grid search more efficiently without requiring manual looping.</p>
<p>Visualizing Prediction Intervals</p>
<p>Once the model is fitted, it is useful to visualize prediction intervals to assess model uncertainty.</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load necessary package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aursiber/nlstools">nlstools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot fitted model with confidence and prediction intervals</span></span>
<span><span class="fu">plotFit</span><span class="op">(</span></span>
<span>  <span class="va">nlin_modG</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  shade <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  col.conf <span class="op">=</span> <span class="st">"skyblue4"</span>,</span>
<span>  col.pred <span class="op">=</span> <span class="st">"lightskyblue2"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">datf</span></span>
<span><span class="op">)</span>  </span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-27-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="using-programmed-starting-values-in-nls" class="section level4" number="6.3.1.2">
<h4>
<span class="header-section-number">6.3.1.2</span> Using Programmed Starting Values in <code>nls</code><a class="anchor" aria-label="anchor" href="#using-programmed-starting-values-in-nls"><i class="fas fa-link"></i></a>
</h4>
<p>Many nonlinear models have well-established functional forms, allowing for programmed starting values in the <code>nls</code> function. For example, models such as <strong>logistic growth</strong> and <strong>asymptotic regression</strong> have built-in self-starting functions.</p>
<p>To explore available self-starting models in R, use:</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/apropos.html">apropos</a></span><span class="op">(</span><span class="st">"^SS"</span><span class="op">)</span></span></code></pre></div>
<p>This command lists functions with names starting with <code>SS</code>, which typically denote self-starting functions for nonlinear regression.</p>
</div>
<div id="custom-self-starting-functions" class="section level4" number="6.3.1.3">
<h4>
<span class="header-section-number">6.3.1.3</span> Custom Self-Starting Functions<a class="anchor" aria-label="anchor" href="#custom-self-starting-functions"><i class="fas fa-link"></i></a>
</h4>
<p>If your model does not match any built-in <code>nls</code> functions, you can define your own <strong>self-starting function</strong>. Self-starting functions in <code>R</code> automate the process of estimating initial values, which helps in fitting nonlinear models more efficiently.</p>
<p>If needed, a self-starting function should:</p>
<ol style="list-style-type: decimal">
<li><p>Define the nonlinear equation.</p></li>
<li><p>Implement a method for computing starting values.</p></li>
<li><p>Return the function structure in an appropriate format.</p></li>
</ol>
</div>
</div>
<div id="handling-constrained-parameters" class="section level3" number="6.3.2">
<h3>
<span class="header-section-number">6.3.2</span> Handling Constrained Parameters<a class="anchor" aria-label="anchor" href="#handling-constrained-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>In some cases, parameters must satisfy constraints (e.g., <span class="math inline">\(\theta_i &gt; a\)</span> or <span class="math inline">\(a &lt; \theta_i &lt; b\)</span>). The following strategies help address constrained parameter estimation:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Fit the model without constraints first</strong>: If the unconstrained parameter estimates satisfy the desired constraints, no further action is needed.</li>
<li>
<strong>Re-parameterization</strong>: If the estimated parameters violate constraints, consider re-parameterizing the model to naturally enforce the required bounds.</li>
</ol>
</div>
<div id="failure-to-converge" class="section level3" number="6.3.3">
<h3>
<span class="header-section-number">6.3.3</span> Failure to Converge<a class="anchor" aria-label="anchor" href="#failure-to-converge"><i class="fas fa-link"></i></a>
</h3>
<p>Several factors can cause an algorithm to fail to converge:</p>
<ul>
<li>
<strong>A “flat” SSE function</strong>: If the sum of squared errors <span class="math inline">\(SSE(\theta)\)</span> is relatively constant in the neighborhood of the minimum, the algorithm may struggle to locate an optimal solution.</li>
<li>
<strong>Poor starting values</strong>: Trying different or better initial values can help.</li>
<li>
<strong>Overly complex models</strong>: If the model is too complex relative to the data, consider simplifying it.</li>
</ul>
</div>
<div id="convergence-to-a-local-minimum" class="section level3" number="6.3.4">
<h3>
<span class="header-section-number">6.3.4</span> Convergence to a Local Minimum<a class="anchor" aria-label="anchor" href="#convergence-to-a-local-minimum"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>
<strong>Linear least squares models</strong> have a well-defined, unique minimum because the SSE function is quadratic:<br><span class="math display">\[ SSE(\theta) = (Y - X\beta)'(Y - X\beta) \]</span>
</li>
<li>
<strong>Nonlinear least squares models</strong> may have multiple local minima.</li>
<li>
<strong>Testing different starting values</strong> can help identify a global minimum.</li>
<li>
<strong>Graphing</strong> <span class="math inline">\(SSE(\theta)\)</span> as a function of individual parameters (if feasible) can provide insights.</li>
<li>
<strong>Alternative optimization algorithms</strong> such as <a href="non-linear-regression.html#genetic-algorithm">Genetic Algorithm</a> or <a href="non-linear-regression.html#particle-swarm-optimization">particle swarm optimization</a> may be useful in non-convex problems.</li>
</ul>
</div>
<div id="model-adequacy-and-estimation-considerations" class="section level3" number="6.3.5">
<h3>
<span class="header-section-number">6.3.5</span> Model Adequacy and Estimation Considerations<a class="anchor" aria-label="anchor" href="#model-adequacy-and-estimation-considerations"><i class="fas fa-link"></i></a>
</h3>
<p>Assessing the adequacy of a <strong>nonlinear model</strong> involves checking its <strong>nonlinearity</strong>, <strong>goodness of fit</strong>, and <strong>residual behavior</strong>. Unlike linear models, nonlinear models do not always have a direct equivalent of <span class="math inline">\(R^2\)</span>, and issues such as collinearity, leverage, and residual heteroscedasticity must be carefully evaluated.</p>
<hr>
<div id="components-of-nonlinearity" class="section level4" number="6.3.5.1">
<h4>
<span class="header-section-number">6.3.5.1</span> Components of Nonlinearity<a class="anchor" aria-label="anchor" href="#components-of-nonlinearity"><i class="fas fa-link"></i></a>
</h4>
<p><span class="citation">D. M. Bates and Watts (<a href="references.html#ref-bates1980relative">1980</a>)</span> defines two key aspects of <strong>nonlinearity</strong> in statistical modeling:</p>
<ol style="list-style-type: decimal">
<li><strong>Intrinsic Nonlinearity</strong></li>
</ol>
<ul>
<li>Measures the <strong>bending and twisting</strong> in the function <span class="math inline">\(f(\theta)\)</span>.</li>
<li>Assumes that the function is relatively <strong>flat (planar)</strong> in the neighborhood of <span class="math inline">\(\hat{\theta}\)</span>.</li>
<li>If severe, the <strong>distribution of residuals</strong> will be <strong>distorted</strong>.</li>
<li>Leads to:
<ul>
<li>
<strong>Slow convergence</strong> of optimization algorithms.</li>
<li>
<strong>Difficulties in identifying</strong> parameter estimates.</li>
</ul>
</li>
<li>Solution approaches:
<ul>
<li>Higher-order <strong>Taylor expansions</strong> for estimation.</li>
<li>
<strong>Bayesian methods</strong> for parameter estimation.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check intrinsic curvature</span></span>
<span><span class="va">modD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">deriv3</a></span><span class="op">(</span><span class="op">~</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">b</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">x</span><span class="op">)</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nlin_modD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu">modD</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>                 start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">astrt</span>, b <span class="op">=</span> <span class="va">bstrt</span><span class="op">)</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">datf</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/rms.curv.html">rms.curv</a></span><span class="op">(</span><span class="va">nlin_modD</span><span class="op">)</span>  <span class="co"># Function from the MASS package to assess curvature</span></span>
<span><span class="co">#&gt; Parameter effects: c^theta x sqrt(F) = 0.0564 </span></span>
<span><span class="co">#&gt;         Intrinsic: c^iota  x sqrt(F) = 9e-04</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Parameter-Effects Nonlinearity</strong></li>
</ol>
<ul>
<li><p>Measures <strong>how the curvature</strong> (nonlinearity) depends on the parameterization.</p></li>
<li><p>Strong parameter effects nonlinearity can cause <strong>problems with inference on</strong> <span class="math inline">\(\hat{\theta}\)</span>.</p></li>
<li>
<p>Can be assessed using:</p>
<ul>
<li><p><code>rms.curv</code> function from <code>MASS</code>.</p></li>
<li><p>Bootstrap-based inference.</p></li>
</ul>
</li>
<li><p><strong>Solution:</strong> Try <strong>reparameterization</strong> to stabilize the function.</p></li>
</ul>
</div>
<div id="goodness-of-fit-in-nonlinear-models" class="section level4" number="6.3.5.2">
<h4>
<span class="header-section-number">6.3.5.2</span> Goodness of Fit in Nonlinear Models<a class="anchor" aria-label="anchor" href="#goodness-of-fit-in-nonlinear-models"><i class="fas fa-link"></i></a>
</h4>
<p>In <strong>linear regression</strong>, we use the standard <strong>coefficient of determination</strong> ($R^2$):</p>
<p><span class="math display">\[
R^2 = \frac{SSR}{SSTO} = 1 - \frac{SSE}{SSTO}
\]</span>​where:</p>
<ul>
<li><p><span class="math inline">\(SSR\)</span> = Regression Sum of Squares</p></li>
<li><p><span class="math inline">\(SSE\)</span> = Error Sum of Squares</p></li>
<li><p><span class="math inline">\(SSTO\)</span> = Total Sum of Squares</p></li>
</ul>
<p>However, in <strong>nonlinear models</strong>, the error and model sum of squares do not necessarily add up to the total corrected sum of squares:</p>
<p><span class="math display">\[
SSR + SSE \neq SST
\]</span></p>
<p>Thus, <span class="math inline">\(R^2\)</span> is not directly valid in the nonlinear case. Instead, we use a pseudo-<span class="math inline">\(R^2\)</span>:</p>
<p><span class="math display">\[
R^2_{pseudo} = 1 - \frac{\sum_{i=1}^n ({Y}_i- \hat{Y})^2}{\sum_{i=1}^n (Y_i- \bar{Y})^2}
\]</span></p>
<ul>
<li><p>Unlike true <span class="math inline">\(R^2\)</span>, this cannot be interpreted as the proportion of variability explained by the model.</p></li>
<li><p>Should be used only for relative model comparison (e.g., comparing different nonlinear models).</p></li>
</ul>
</div>
<div id="residual-analysis-in-nonlinear-models" class="section level4" number="6.3.5.3">
<h4>
<span class="header-section-number">6.3.5.3</span> Residual Analysis in Nonlinear Models<a class="anchor" aria-label="anchor" href="#residual-analysis-in-nonlinear-models"><i class="fas fa-link"></i></a>
</h4>
<p>Residual plots help assess model adequacy, particularly when <strong>intrinsic curvature is small</strong>.</p>
<p>In nonlinear models, the <strong>studentized residuals</strong> are:</p>
<p><span class="math display">\[
r_i = \frac{e_i}{s \sqrt{1-\hat{c}_i}}
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(e_i\)</span> = residual for observation <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(\hat{c}_i\)</span> = <span class="math inline">\(i\)</span>th diagonal element of the <strong>tangent-plane hat matrix</strong>:</p></li>
</ul>
<p><span class="math display">\[
\mathbf{\hat{H} = F(\hat{\theta})[F(\hat{\theta})'F(\hat{\theta})]^{-1}F(\hat{\theta})'}
\]</span></p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Residual diagnostics for nonlinear models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aursiber/nlstools">nlstools</a></span><span class="op">)</span></span>
<span><span class="va">resid_nls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlstools/man/nlsResiduals.html">nlsResiduals</a></span><span class="op">(</span><span class="va">nlin_modD</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate residual plots</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resid_nls</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-30-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="potential-issues-in-nonlinear-regression-models" class="section level4" number="6.3.5.4">
<h4>
<span class="header-section-number">6.3.5.4</span> Potential Issues in Nonlinear Regression Models<a class="anchor" aria-label="anchor" href="#potential-issues-in-nonlinear-regression-models"><i class="fas fa-link"></i></a>
</h4>
<div id="collinearity-1" class="section level5" number="6.3.5.4.1">
<h5>
<span class="header-section-number">6.3.5.4.1</span> Collinearity<a class="anchor" aria-label="anchor" href="#collinearity-1"><i class="fas fa-link"></i></a>
</h5>
<ul>
<li><p>Measures how correlated the model’s predictors are.</p></li>
<li><p>In nonlinear models, collinearity is assessed using the condition number of:</p></li>
</ul>
<p><span class="math display">\[
\mathbf{[F(\hat{\theta})'F(\hat{\theta})]^{-1}}
\]</span></p>
<ul>
<li><p>If condition number &gt; 30, collinearity is a concern.</p></li>
<li><p>Solution: Consider reparameterization <span class="citation">(<a href="references.html#ref-Magel_1987">Magel and Hertsgaard 1987</a>)</span>.</p></li>
</ul>
</div>
<div id="leverage" class="section level5" number="6.3.5.4.2">
<h5>
<span class="header-section-number">6.3.5.4.2</span> Leverage<a class="anchor" aria-label="anchor" href="#leverage"><i class="fas fa-link"></i></a>
</h5>
<ul>
<li><p>Similar to leverage in <a href="linear-regression.html#ordinary-least-squares">Ordinary Least Squares</a>.</p></li>
<li><p>In nonlinear models, leverage is assessed using the <strong>tangent-plane hat matrix</strong>:</p></li>
</ul>
<p><span class="math display">\[
\mathbf{\hat{H} = F(\hat{\theta})[F(\hat{\theta})'F(\hat{\theta})]^{-1}F(\hat{\theta})'}
\]</span></p>
<ul>
<li>
<strong>Solution:</strong> Identify influential points and assess their impact on parameter estimates <span class="citation">(<a href="references.html#ref-Laurent_1992">St Laurent and Cook 1992</a>)</span>.</li>
</ul>
</div>
<div id="heterogeneous-errors" class="section level5" number="6.3.5.4.3">
<h5>
<span class="header-section-number">6.3.5.4.3</span> Heterogeneous Errors<a class="anchor" aria-label="anchor" href="#heterogeneous-errors"><i class="fas fa-link"></i></a>
</h5>
<ul>
<li><p>Non-constant variance across observations.</p></li>
<li><p><strong>Solution:</strong> Use <strong>Weighted Nonlinear Least Squares (WNLS)</strong>.</p></li>
</ul>
</div>
<div id="correlated-errors" class="section level5" number="6.3.5.4.4">
<h5>
<span class="header-section-number">6.3.5.4.4</span> Correlated Errors<a class="anchor" aria-label="anchor" href="#correlated-errors"><i class="fas fa-link"></i></a>
</h5>
<ul>
<li><p>Residuals may be autocorrelated.</p></li>
<li>
<p><strong>Solution approaches:</strong></p>
<ul>
<li><p><strong>Generalized Nonlinear Least Squares (GNLS)</strong></p></li>
<li><p><strong>Nonlinear Mixed Models (NLMEM)</strong></p></li>
<li><p><strong>Bayesian Methods</strong></p></li>
</ul>
</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="26%">
<col width="38%">
<col width="35%">
</colgroup>
<thead><tr class="header">
<th>Issue</th>
<th>Description</th>
<th>Solution</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Intrinsic Nonlinearity</strong></td>
<td>Function curvature independent of parameterization</td>
<td>Bayesian estimation, Taylor expansion</td>
</tr>
<tr class="even">
<td><strong>Parameter-Effects Nonlinearity</strong></td>
<td>Curvature influenced by parameterization</td>
<td>Reparameterization, bootstrap</td>
</tr>
<tr class="odd">
<td><strong>Collinearity</strong></td>
<td>High correlation among predictors</td>
<td>Reparameterization, condition number check</td>
</tr>
<tr class="even">
<td><strong>Leverage</strong></td>
<td>Influential points affecting model fit</td>
<td>Assess tangent-plane hat matrix</td>
</tr>
<tr class="odd">
<td><strong>Heterogeneous Errors</strong></td>
<td>Unequal variance in residuals</td>
<td>Weighted Nonlinear Least Squares</td>
</tr>
<tr class="even">
<td><strong>Correlated Errors</strong></td>
<td>Autocorrelated residuals</td>
<td>GNLS, Nonlinear Mixed Models, Bayesian Methods</td>
</tr>
</tbody>
</table></div>
</div>
</div>
</div>
</div>
<div id="application" class="section level2" number="6.4">
<h2>
<span class="header-section-number">6.4</span> Application<a class="anchor" aria-label="anchor" href="#application"><i class="fas fa-link"></i></a>
</h2>
<div id="nonlinear-estimation-using-gauss-newton-algorithm" class="section level3" number="6.4.1">
<h3>
<span class="header-section-number">6.4.1</span> Nonlinear Estimation Using Gauss-Newton Algorithm<a class="anchor" aria-label="anchor" href="#nonlinear-estimation-using-gauss-newton-algorithm"><i class="fas fa-link"></i></a>
</h3>
<p>This section demonstrates nonlinear parameter estimation using the Gauss-Newton algorithm and compares results with <code><a href="https://rdrr.io/r/stats/nls.html">nls()</a></code>. The model is given by:</p>
<p><span class="math display">\[
y_i = \frac{\theta_0 + \theta_1 x_i}{1 + \theta_2 \exp(0.4 x_i)} + \epsilon_i
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(i = 1, \dots ,n\)</span></li>
<li>
<span class="math inline">\(\theta_0\)</span>, <span class="math inline">\(\theta_1\)</span>, <span class="math inline">\(\theta_2\)</span> are the unknown parameters.</li>
<li>
<span class="math inline">\(\epsilon_i\)</span> represents errors.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Loading and Visualizing the Data</li>
</ol>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load the dataset</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.delim</a></span><span class="op">(</span><span class="st">"images/S21hw1pr4.txt"</span>, header <span class="op">=</span> <span class="cn">FALSE</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">V1</span>, y <span class="op">=</span> <span class="va">V2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Observed Data"</span>, x <span class="op">=</span> <span class="st">"X"</span>, y <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-31-1.png" width="90%" style="display: block; margin: auto;"></div>
<ol start="2" style="list-style-type: decimal">
<li>Deriving Starting Values for Parameters</li>
</ol>
<p>Since nonlinear optimization is sensitive to starting values, we estimate reasonable initial values based on model interpretation.</p>
<p>Finding the Maximum <span class="math inline">\(Y\)</span> Value</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.6722</span></span>
<span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.0094</span></span></code></pre></div>
<ul>
<li><p>When <span class="math inline">\(y = 2.6722\)</span>, the corresponding <span class="math inline">\(x = 0.0094\)</span>.</p></li>
<li><p>From the model equation: <span class="math inline">\(\theta_0 + 0.0094 \theta_1 = 2.6722\)</span></p></li>
</ul>
<p>Estimating <span class="math inline">\(\theta_2\)</span> from the Median <span class="math inline">\(y\)</span> Value</p>
<ul>
<li>The equation simplifies to: <span class="math inline">\(1 + \theta_2 \exp(0.4 x) = 2\)</span>
</li>
</ul>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find mean y</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] -0.0747864</span></span>
<span></span>
<span><span class="co"># find y closest to its mean</span></span>
<span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="co">#&gt; [1] -0.0773</span></span>
<span></span>
<span></span>
<span><span class="co"># find x closest to the mean y</span></span>
<span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="co">#&gt; [1] 11.0648</span></span></code></pre></div>
<ul>
<li>This yields the equation: <span class="math inline">\(83.58967 \theta_2 = 1\)</span>
</li>
</ul>
<p>Finding the Value of <span class="math inline">\(\theta_0\)</span> and <span class="math inline">\(\theta_1\)</span></p>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># find value of x closet to 1</span></span>
<span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> </span>
<span><span class="co">#&gt; [1] 0.9895</span></span>
<span></span>
<span><span class="co"># find index of x closest to 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="va">my_data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] 14</span></span>
<span></span>
<span><span class="co"># find y value</span></span>
<span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="va">my_data</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1.4577</span></span></code></pre></div>
<ul>
<li>This provides another equation: <span class="math inline">\(\theta_0 + \theta_1 \times 0.9895 - 2.164479 \theta_2 = 1.457\)</span>
</li>
</ul>
<p>Solving for <span class="math inline">\(\theta_0, \theta_1, \theta_2\)</span></p>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/matlib">matlib</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define coefficient matrix</span></span>
<span><span class="va">A</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.0094</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">83.58967</span>, <span class="fl">1</span>, <span class="fl">0.9895</span>, <span class="op">-</span><span class="fl">2.164479</span><span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  byrow <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define constant vector</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.6722</span>, <span class="fl">1</span>, <span class="fl">1.457</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display system of equations</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/matlib/man/showEqn.html">showEqn</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">b</span><span class="op">)</span></span>
<span><span class="co">#&gt; 0*x1 + 0.0094*x2        + 0*x3  =  2.6722 </span></span>
<span><span class="co">#&gt; 0*x1      + 0*x2 + 83.58967*x3  =       1 </span></span>
<span><span class="co">#&gt; 1*x1 + 0.9895*x2 - 2.164479*x3  =   1.457</span></span>
<span></span>
<span><span class="co"># Solve for parameters</span></span>
<span><span class="va">theta_start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/matlib/man/Solve.html">Solve</a></span><span class="op">(</span><span class="va">A</span>, <span class="va">b</span>, fractions <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; x1      =  -279.80879739 </span></span>
<span><span class="co">#&gt;   x2    =   284.27659574 </span></span>
<span><span class="co">#&gt;     x3  =      0.0119632</span></span>
<span><span class="va">theta_start</span></span>
<span><span class="co">#&gt; [1] "x1      =  -279.80879739" "  x2    =   284.27659574"</span></span>
<span><span class="co">#&gt; [3] "    x3  =      0.0119632"</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Implementing the Gauss-Newton Algorithm</li>
</ol>
<p>Using these estimates, we manually implement the <strong>Gauss-Newton optimization</strong>.</p>
<p><strong>Defining the Model and Its Derivatives</strong></p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Starting values</span></span>
<span><span class="va">theta_0_strt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*=\\s*"</span>, <span class="st">""</span>, <span class="va">theta_start</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta_1_strt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*=\\s*"</span>, <span class="st">""</span>, <span class="va">theta_start</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">theta_2_strt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*=\\s*"</span>, <span class="st">""</span>, <span class="va">theta_start</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model function</span></span>
<span><span class="va">mod_4</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta_0</span>, <span class="va">theta_1</span>, <span class="va">theta_2</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">theta_0</span> <span class="op">+</span> <span class="va">theta_1</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">theta_2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.4</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Define function expression</span></span>
<span><span class="va">f_4</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="op">(</span><span class="va">theta_0</span> <span class="op">+</span> <span class="va">theta_1</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">theta_2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">0.4</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First derivatives</span></span>
<span><span class="va">df_4.d_theta_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">D</a></span><span class="op">(</span><span class="va">f_4</span>, <span class="st">'theta_0'</span><span class="op">)</span></span>
<span><span class="va">df_4.d_theta_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">D</a></span><span class="op">(</span><span class="va">f_4</span>, <span class="st">'theta_1'</span><span class="op">)</span></span>
<span><span class="va">df_4.d_theta_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">D</a></span><span class="op">(</span><span class="va">f_4</span>, <span class="st">'theta_2'</span><span class="op">)</span></span></code></pre></div>
<p>Iterative Gauss-Newton Optimization</p>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Initialize</span></span>
<span><span class="va">theta_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">theta_0_strt</span>, <span class="va">theta_1_strt</span>, <span class="va">theta_2_strt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span><span class="co"># Evaluate function at initial estimates</span></span>
<span><span class="va">f_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="va">f_4</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">my_data</span><span class="op">$</span><span class="va">x</span>,</span>
<span>  theta_0 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  theta_1 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  theta_2 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">repeat</span> <span class="op">{</span></span>
<span>  <span class="co"># Compute Jacobian matrix</span></span>
<span>  <span class="va">F_theta_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="va">df_4.d_theta_0</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">my_data</span><span class="op">$</span><span class="va">x</span>,</span>
<span>      theta_0 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      theta_1 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      theta_2 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">3</span>, <span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="va">df_4.d_theta_1</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">my_data</span><span class="op">$</span><span class="va">x</span>,</span>
<span>      theta_0 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      theta_1 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      theta_2 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">3</span>, <span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="va">df_4.d_theta_2</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">my_data</span><span class="op">$</span><span class="va">x</span>,</span>
<span>      theta_0 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      theta_1 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>      theta_2 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">3</span>, <span class="va">i</span><span class="op">]</span></span>
<span>    <span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Compute parameter updates</span></span>
<span>  <span class="va">delta</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">F_theta_0</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">F_theta_0</span><span class="op">)</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">F_theta_0</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span><span class="op">-</span><span class="va">f_theta</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    </span>
<span>  </span>
<span>  <span class="co"># Update parameter estimates</span></span>
<span>  <span class="va">theta_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">theta_vec</span>, <span class="va">theta_vec</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">delta</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">theta_vec</span><span class="op">[</span>, <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">delta</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># Increment iteration counter</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  </span>
<span>  <span class="co"># Compute new function values</span></span>
<span>  <span class="va">f_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">f_theta</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="va">f_4</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">my_data</span><span class="op">$</span><span class="va">x</span>,</span>
<span>    theta_0 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">1</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>    theta_1 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">2</span>, <span class="va">i</span><span class="op">]</span>,</span>
<span>    theta_2 <span class="op">=</span> <span class="va">theta_vec</span><span class="op">[</span><span class="fl">3</span>, <span class="va">i</span><span class="op">]</span></span>
<span>  <span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">delta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">delta</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Convergence criteria based on SSE</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">f_theta</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">f_theta</span><span class="op">[</span>, <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">f_theta</span><span class="op">[</span>, <span class="va">i</span> <span class="op">-</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.001</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">break</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Final parameter estimates</span></span>
<span><span class="va">theta_vec</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">theta_vec</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1]  3.6335135 -1.3055166  0.5043502</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Checking Convergence and Variance</li>
</ol>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Final objective function value (SSE)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">f_theta</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 19.80165</span></span>
<span></span>
<span><span class="va">sigma2</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">)</span> <span class="op">*</span> </span>
<span>  <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">f_theta</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">f_theta</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> </span>
<span>   <span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">f_theta</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">f_theta</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>  <span class="co"># p = 3</span></span>
<span></span>
<span><span class="co"># Asymptotic variance-covariance matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">sigma2</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">F_theta_0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;             [,1]        [,2]        [,3]</span></span>
<span><span class="co">#&gt; [1,]  0.11552571 -0.04817428  0.02685848</span></span>
<span><span class="co">#&gt; [2,] -0.04817428  0.02100861 -0.01158212</span></span>
<span><span class="co">#&gt; [3,]  0.02685848 -0.01158212  0.00703916</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Validating with <code><a href="https://rdrr.io/r/stats/nls.html">nls()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nlin_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="fu">mod_4</span><span class="op">(</span><span class="va">theta_0</span>, <span class="va">theta_1</span>, <span class="va">theta_2</span>, <span class="va">x</span><span class="op">)</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    theta_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*=\\s*"</span>, <span class="st">""</span>, <span class="va">theta_start</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    theta_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*=\\s*"</span>, <span class="st">""</span>, <span class="va">theta_start</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    theta_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*=\\s*"</span>, <span class="st">""</span>, <span class="va">theta_start</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">my_data</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">nlin_4</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: y ~ mod_4(theta_0, theta_1, theta_2, x)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;         Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; theta_0  3.63591    0.36528   9.954  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; theta_1 -1.30639    0.15561  -8.395 3.65e-15 ***</span></span>
<span><span class="co">#&gt; theta_2  0.50528    0.09215   5.483 1.03e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.2831 on 247 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 9 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 2.294e-07</span></span></code></pre></div>
</div>
<div id="logistic-growth-model" class="section level3" number="6.4.2">
<h3>
<span class="header-section-number">6.4.2</span> Logistic Growth Model<a class="anchor" aria-label="anchor" href="#logistic-growth-model"><i class="fas fa-link"></i></a>
</h3>
<p>A classic logistic growth model follows the equation:</p>
<p><span class="math display">\[
P = \frac{K}{1 + \exp(P_0 + r t)} + \epsilon
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(P\)</span> = population at time <span class="math inline">\(t\)</span></p></li>
<li><p><span class="math inline">\(K\)</span> = carrying capacity (maximum population)</p></li>
<li><p><span class="math inline">\(r\)</span> = population growth rate</p></li>
<li><p><span class="math inline">\(P_0\)</span> = initial population log-ratio</p></li>
</ul>
<p>However, R’s built-in <code>SSlogis</code> function uses a slightly different parameterization:</p>
<p><span class="math display">\[
P = \frac{asym}{1 + \exp\left(\frac{xmid - t}{scal}\right)}
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(asym\)</span> = carrying capacity (<span class="math inline">\(K\)</span>)</p></li>
<li><p><span class="math inline">\(xmid\)</span> = the <span class="math inline">\(x\)</span>-value at the inflection point of the curve</p></li>
<li><p><span class="math inline">\(scal\)</span> = scaling parameter</p></li>
</ul>
<p>This gives the parameter relationships:</p>
<ul>
<li><p><span class="math inline">\(K = asym\)</span></p></li>
<li><p><span class="math inline">\(r = -1 / scal\)</span></p></li>
<li><p><span class="math inline">\(P_0 = -r \cdot xmid\)</span></p></li>
</ul>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulated time-series data</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span>, <span class="fl">35</span><span class="op">)</span></span>
<span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.8</span>, <span class="fl">4.2</span>, <span class="fl">3.5</span>, <span class="fl">6.3</span>, <span class="fl">15.7</span>, <span class="fl">21.3</span>, <span class="fl">23.7</span>, <span class="fl">25.1</span>, <span class="fl">25.8</span>, <span class="fl">25.9</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot data points</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">population</span>, las <span class="op">=</span> <span class="fl">1</span>, pch <span class="op">=</span> <span class="fl">16</span>, main <span class="op">=</span> <span class="st">"Logistic Growth Model"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-40-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Fit the logistic growth model using programmed starting values</span></span>
<span><span class="va">logisticModelSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span><span class="va">population</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/SSlogis.html">SSlogis</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">Asym</span>, <span class="va">xmid</span>, <span class="va">scal</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">logisticModelSS</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: population ~ SSlogis(time, Asym, xmid, scal)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;      Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; Asym  25.5029     0.3666   69.56 3.34e-11 ***</span></span>
<span><span class="co">#&gt; xmid   8.7347     0.3007   29.05 1.48e-08 ***</span></span>
<span><span class="co">#&gt; scal   3.6353     0.2186   16.63 6.96e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.6528 on 7 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 1 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 1.908e-06</span></span>
<span></span>
<span><span class="co"># Extract parameter estimates</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logisticModelSS</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Asym      xmid      scal </span></span>
<span><span class="co">#&gt; 25.502890  8.734698  3.635333</span></span></code></pre></div>
<p>To fit the model using an alternative parameterization (<span class="math inline">\(K, r, P_0\)</span>), we convert the estimated coefficients:</p>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert parameter estimates to alternative logistic model parameters</span></span>
<span><span class="va">Ks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logisticModelSS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Carrying capacity (K)</span></span>
<span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logisticModelSS</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Growth rate (r)</span></span>
<span><span class="va">Pos</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">rs</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">logisticModelSS</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>  <span class="co"># P_0</span></span>
<span></span>
<span><span class="co"># Fit the logistic model with the alternative parameterization</span></span>
<span><span class="va">logisticModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span></span>
<span>    <span class="va">population</span> <span class="op">~</span> <span class="va">K</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">Po</span> <span class="op">+</span> <span class="va">r</span> <span class="op">*</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Po <span class="op">=</span> <span class="va">Pos</span>, r <span class="op">=</span> <span class="va">rs</span>, K <span class="op">=</span> <span class="va">Ks</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">logisticModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: population ~ K/(1 + exp(Po + r * time))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;    Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; Po  2.40272    0.12702   18.92 2.87e-07 ***</span></span>
<span><span class="co">#&gt; r  -0.27508    0.01654  -16.63 6.96e-07 ***</span></span>
<span><span class="co">#&gt; K  25.50289    0.36665   69.56 3.34e-11 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.6528 on 7 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 0 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 1.924e-06</span></span></code></pre></div>
<p>Visualizing the Logistic Model Fit</p>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot original data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">time</span>,</span>
<span>     <span class="va">population</span>,</span>
<span>     las <span class="op">=</span> <span class="fl">1</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Logistic Growth Model Fit"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Overlay the fitted logistic curve</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">time</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">logisticModel</span><span class="op">)</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>      lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-42-1.png" width="90%" style="display: block; margin: auto;"></div>
</div>
<div id="nonlinear-plateau-model" class="section level3" number="6.4.3">
<h3>
<span class="header-section-number">6.4.3</span> Nonlinear Plateau Model<a class="anchor" aria-label="anchor" href="#nonlinear-plateau-model"><i class="fas fa-link"></i></a>
</h3>
<p>This example is based on <span class="citation">(<a href="references.html#ref-Schabenberger_2001">Schabenberger and Pierce 2001</a>)</span> and demonstrates the use of a <strong>plateau model</strong> to estimate the relationship between soil nitrate (<span class="math inline">\(NO_3\)</span>) concentration and relative yield percent (RYP) at two different depths (30 cm and 60 cm).</p>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load data</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="st">"images/dat.txt"</span>, header <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot NO3 concentration vs. relative yield percent, colored by depth</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">dat.plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">no3</span>, y <span class="op">=</span> <span class="va">ryp</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'Depth (cm)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">'Soil NO3 Concentration'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">'Relative Yield Percent'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display plot</span></span>
<span><span class="va">dat.plot</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-43-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>The <strong>suggested nonlinear plateau model</strong> is given by:</p>
<p><span class="math display">\[
E(Y_{ij}) = (\beta_{0j} + \beta_{1j}N_{ij})I_{N_{ij}\le \alpha_j} + (\beta_{0j} + \beta_{1j}\alpha_j)I_{N_{ij} &gt; \alpha_j}
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(N_{ij}\)</span> represents the soil nitrate (<span class="math inline">\(NO_3\)</span>) concentration for observation <span class="math inline">\(i\)</span> at depth <span class="math inline">\(j\)</span>.</p></li>
<li><p><span class="math inline">\(i\)</span> indexes individual observations.</p></li>
<li><p><span class="math inline">\(j = 1, 2\)</span> corresponds to depths <strong>30 cm</strong> and <strong>60 cm</strong>.</p></li>
</ul>
<p>This model assumes a <strong>linear increase</strong> up to a threshold (<span class="math inline">\(\alpha_j\)</span>), beyond which the response <strong>levels off (plateaus).</strong></p>
<p>Defining the Plateau Model as a Function</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define the nonlinear plateau model function</span></span>
<span><span class="va">nonlinModel</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">predictor</span>, <span class="va">b0</span>, <span class="va">b1</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">predictor</span> <span class="op">&lt;=</span> <span class="va">alpha</span>, </span>
<span>         <span class="va">b0</span> <span class="op">+</span> <span class="va">b1</span> <span class="op">*</span> <span class="va">predictor</span>,  <span class="co"># Linear growth below threshold</span></span>
<span>         <span class="va">b0</span> <span class="op">+</span> <span class="va">b1</span> <span class="op">*</span> <span class="va">alpha</span><span class="op">)</span>      <span class="co"># Plateau beyond threshold</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Creating a Self-Starting Function for <code>nls</code></p>
<p>Since the model is <strong>piecewise linear</strong>, we can estimate starting values using:</p>
<ol style="list-style-type: decimal">
<li><p>A <strong>linear regression</strong> on the <strong>first half</strong> of sorted predictor values to estimate <span class="math inline">\(b_0\)</span> and <span class="math inline">\(b_1\)</span>.</p></li>
<li><p>The <strong>last predictor value</strong> used in the regression as the plateau threshold (<span class="math inline">\(\alpha\)</span>)</p></li>
</ol>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define initialization function for self-starting plateau model</span></span>
<span><span class="va">nonlinModelInit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mCall</span>, <span class="va">LHS</span>, <span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Sort data by increasing predictor value</span></span>
<span>  <span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sortedXyData.html">sortedXyData</a></span><span class="op">(</span><span class="va">mCall</span><span class="op">[[</span><span class="st">'predictor'</span><span class="op">]</span><span class="op">]</span>, <span class="va">LHS</span>, <span class="va">data</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">xy</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Fit a simple linear model using the first half of the sorted data</span></span>
<span>  <span class="va">lmFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">xy</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">'y'</span><span class="op">]</span> <span class="op">~</span> <span class="va">xy</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">'x'</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Extract initial estimates</span></span>
<span>  <span class="va">b0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lmFit</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>  <span class="co"># Intercept</span></span>
<span>  <span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">lmFit</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>  <span class="co"># Slope</span></span>
<span>  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="va">xy</span><span class="op">[</span><span class="op">(</span><span class="va">n</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="st">'x'</span><span class="op">]</span>  <span class="co"># Last x-value in the fitted linear range</span></span>
<span>  </span>
<span>  <span class="co"># Return initial parameter estimates</span></span>
<span>  <span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">b0</span>, <span class="va">b1</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">mCall</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'b0'</span>, <span class="st">'b1'</span>, <span class="st">'alpha'</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">value</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Combining Model and Self-Start Function</p>
<div class="sourceCode" id="cb247"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define a self-starting nonlinear model for nls</span></span>
<span><span class="va">SS_nonlinModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/selfStart.html">selfStart</a></span><span class="op">(</span><span class="va">nonlinModel</span>,</span>
<span>                            <span class="va">nonlinModelInit</span>,</span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'b0'</span>, <span class="st">'b1'</span>, <span class="st">'alpha'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>nls</code> function is used to estimate parameters separately for <strong>each soil depth (30 cm and 60 cm).</strong></p>
<div class="sourceCode" id="cb248"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model for depth = 30 cm</span></span>
<span><span class="va">sep30_nls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span><span class="va">ryp</span> <span class="op">~</span> <span class="fu">SS_nonlinModel</span><span class="op">(</span>predictor <span class="op">=</span> <span class="va">no3</span>, <span class="va">b0</span>, <span class="va">b1</span>, <span class="va">alpha</span><span class="op">)</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="fl">30</span>,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit the model for depth = 60 cm</span></span>
<span><span class="va">sep60_nls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span><span class="va">ryp</span> <span class="op">~</span> <span class="fu">SS_nonlinModel</span><span class="op">(</span>predictor <span class="op">=</span> <span class="va">no3</span>, <span class="va">b0</span>, <span class="va">b1</span>, <span class="va">alpha</span><span class="op">)</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="fl">60</span>,<span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>We generate separate plots for <strong>30 cm</strong> and <strong>60 cm</strong> depths, showing both <strong>confidence</strong> and <strong>prediction intervals.</strong></p>
<div class="sourceCode" id="cb249"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set plotting layout</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot model fit for 30 cm depth</span></span>
<span><span class="fu">plotFit</span><span class="op">(</span></span>
<span>  <span class="va">sep30_nls</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  shade <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  col.conf <span class="op">=</span> <span class="st">"skyblue4"</span>,</span>
<span>  col.pred <span class="op">=</span> <span class="st">"lightskyblue2"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="fl">30</span>,<span class="op">]</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Results at 30 cm Depth"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Relative Yield Percent"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Soil NO3 Concentration"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot model fit for 60 cm depth</span></span>
<span><span class="fu">plotFit</span><span class="op">(</span></span>
<span>  <span class="va">sep60_nls</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  shade <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  col.conf <span class="op">=</span> <span class="st">"lightpink4"</span>,</span>
<span>  col.pred <span class="op">=</span> <span class="st">"lightpink2"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span><span class="op">[</span><span class="va">dat</span><span class="op">$</span><span class="va">depth</span> <span class="op">==</span> <span class="fl">60</span>,<span class="op">]</span>,</span>
<span>  main <span class="op">=</span> <span class="st">"Results at 60 cm Depth"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">"Relative Yield Percent"</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Soil NO3 Concentration"</span>,</span>
<span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">120</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-48-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb250"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sep30_nls</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: ryp ~ SS_nonlinModel(predictor = no3, b0, b1, alpha)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; b0     15.1943     2.9781   5.102 6.89e-07 ***</span></span>
<span><span class="co">#&gt; b1      3.5760     0.1853  19.297  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; alpha  23.1324     0.5098  45.373  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 8.258 on 237 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 6 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 3.608e-09</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sep60_nls</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: ryp ~ SS_nonlinModel(predictor = no3, b0, b1, alpha)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; b0      5.4519     2.9785    1.83   0.0684 .  </span></span>
<span><span class="co">#&gt; b1      5.6820     0.2529   22.46   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha  16.2863     0.2818   57.80   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 7.427 on 237 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 5 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 8.571e-09</span></span></code></pre></div>
<p><strong>Modeling Soil Depths Together and Comparing Models</strong></p>
<p>Instead of fitting separate models for different soil depths, we first fit a <strong>combined model</strong> where all observations share a <strong>common slope, intercept, and plateau</strong>. We then test whether modeling the two depths separately provides a significantly better fit.</p>
<ol style="list-style-type: decimal">
<li><strong>Fitting a Reduced (Combined) Model</strong></li>
</ol>
<p>The reduced model assumes that <strong>all soil depths follow the same nonlinear relationship</strong>.</p>
<div class="sourceCode" id="cb251"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the combined model (common parameters across all depths)</span></span>
<span><span class="va">red_nls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span></span>
<span>  <span class="va">ryp</span> <span class="op">~</span> <span class="fu">SS_nonlinModel</span><span class="op">(</span>predictor <span class="op">=</span> <span class="va">no3</span>, <span class="va">b0</span>, <span class="va">b1</span>, <span class="va">alpha</span><span class="op">)</span>, </span>
<span>  data <span class="op">=</span> <span class="va">dat</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">red_nls</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: ryp ~ SS_nonlinModel(predictor = no3, b0, b1, alpha)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; b0      8.7901     2.7688   3.175   0.0016 ** </span></span>
<span><span class="co">#&gt; b1      4.8995     0.2207  22.203   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; alpha  18.0333     0.3242  55.630   &lt;2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 9.13 on 477 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 7 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 7.126e-09</span></span>
<span></span>
<span><span class="co"># Visualizing the combined model fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">plotFit</span><span class="op">(</span></span>
<span>  <span class="va">red_nls</span>,</span>
<span>  interval <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">19</span>,</span>
<span>  shade <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  col.conf <span class="op">=</span> <span class="st">"lightblue4"</span>,</span>
<span>  col.pred <span class="op">=</span> <span class="st">"lightblue2"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  main <span class="op">=</span> <span class="st">'Results for Combined Model'</span>,</span>
<span>  ylab <span class="op">=</span> <span class="st">'Relative Yield Percent'</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">'Soil NO3 Concentration'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/reduce-model-1.png" width="90%" style="display: block; margin: auto;"></div>
<ol start="2" style="list-style-type: decimal">
<li><strong>Examining Residuals for the Combined Model</strong></li>
</ol>
<p>Checking residuals helps diagnose potential <strong>lack of fit</strong>.</p>
<div class="sourceCode" id="cb252"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aursiber/nlstools">nlstools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Residual diagnostics using nlstools</span></span>
<span><span class="va">resid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nlstools/man/nlsResiduals.html">nlsResiduals</a></span><span class="op">(</span><span class="va">red_nls</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot residuals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">resid</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="06-nonlinear-regession_files/figure-html/unnamed-chunk-50-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>If there is a <strong>pattern</strong> in the residuals (e.g., systematic deviations based on soil depth), this suggests that a <strong>separate model for each depth</strong> may be necessary.</p>
<ol start="3" style="list-style-type: decimal">
<li><strong>Testing Whether Depths Require Separate Models</strong></li>
</ol>
<p>To formally test whether soil depth significantly affects the model parameters, we introduce a <strong>parameterization where depth-specific parameters are increments from a baseline model</strong> (30 cm depth):</p>
<p><span class="math display">\[
\begin{aligned}
\beta_{02} &amp;= \beta_{01} + d_0 \\
\beta_{12} &amp;= \beta_{11} + d_1 \\
\alpha_{2} &amp;= \alpha_{1} + d_a
\end{aligned}
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(\beta_{01}, \beta_{11}, \alpha_1\)</span> are parameters for <strong>30 cm depth</strong>.</p></li>
<li><p><span class="math inline">\(d_0, d_1, d_a\)</span> represent <strong>depth-specific differences</strong> for <strong>60 cm depth</strong>.</p></li>
<li><p>If <span class="math inline">\(d_0, d_1, d_a\)</span> are significantly <strong>different from 0</strong>, the <strong>two depths should be modeled separately</strong>.</p></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li><strong>Defining the Full (Depth-Specific) Model</strong></li>
</ol>
<div class="sourceCode" id="cb253"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nonlinModelF</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">predictor</span>, <span class="va">soildep</span>, <span class="va">b01</span>, <span class="va">b11</span>, <span class="va">a1</span>, <span class="va">d0</span>, <span class="va">d1</span>, <span class="va">da</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># Define parameters for 60 cm depth as increments from 30 cm parameters</span></span>
<span>  <span class="va">b02</span> <span class="op">&lt;-</span> <span class="va">b01</span> <span class="op">+</span> <span class="va">d0</span></span>
<span>  <span class="va">b12</span> <span class="op">&lt;-</span> <span class="va">b11</span> <span class="op">+</span> <span class="va">d1</span></span>
<span>  <span class="va">a2</span> <span class="op">&lt;-</span> <span class="va">a1</span> <span class="op">+</span> <span class="va">da</span></span>
<span>  </span>
<span>  <span class="co"># Compute model output for 30 cm depth</span></span>
<span>  <span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="va">predictor</span> <span class="op">&lt;=</span> <span class="va">a1</span>, </span>
<span>    <span class="va">b01</span> <span class="op">+</span> <span class="va">b11</span> <span class="op">*</span> <span class="va">predictor</span>, </span>
<span>    <span class="va">b01</span> <span class="op">+</span> <span class="va">b11</span> <span class="op">*</span> <span class="va">a1</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Compute model output for 60 cm depth</span></span>
<span>  <span class="va">y2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span></span>
<span>    <span class="va">predictor</span> <span class="op">&lt;=</span> <span class="va">a2</span>, </span>
<span>    <span class="va">b02</span> <span class="op">+</span> <span class="va">b12</span> <span class="op">*</span> <span class="va">predictor</span>, </span>
<span>    <span class="va">b02</span> <span class="op">+</span> <span class="va">b12</span> <span class="op">*</span> <span class="va">a2</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Assign correct model output based on depth</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y1</span> <span class="op">*</span> <span class="op">(</span><span class="va">soildep</span> <span class="op">==</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span> <span class="va">y2</span> <span class="op">*</span> <span class="op">(</span><span class="va">soildep</span> <span class="op">==</span> <span class="fl">60</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><strong>Fitting the Full (Depth-Specific) Model</strong></li>
</ol>
<p>The starting values are taken from the <strong>separately fitted models</strong> for each depth.</p>
<div class="sourceCode" id="cb254"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Soil_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/nls.html">nls</a></span><span class="op">(</span></span>
<span>  <span class="va">ryp</span> <span class="op">~</span> <span class="fu">nonlinModelF</span><span class="op">(</span></span>
<span>    predictor <span class="op">=</span> <span class="va">no3</span>,</span>
<span>    soildep <span class="op">=</span> <span class="va">depth</span>,</span>
<span>    <span class="va">b01</span>,</span>
<span>    <span class="va">b11</span>,</span>
<span>    <span class="va">a1</span>,</span>
<span>    <span class="va">d0</span>,</span>
<span>    <span class="va">d1</span>,</span>
<span>    <span class="va">da</span></span>
<span>  <span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>  start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    b01 <span class="op">=</span> <span class="fl">15.2</span>,   <span class="co"># Intercept for 30 cm depth</span></span>
<span>    b11 <span class="op">=</span> <span class="fl">3.58</span>,   <span class="co"># Slope for 30 cm depth</span></span>
<span>    a1 <span class="op">=</span> <span class="fl">23.13</span>,   <span class="co"># Plateau cutoff for 30 cm depth</span></span>
<span>    d0 <span class="op">=</span> <span class="op">-</span><span class="fl">9.74</span>,   <span class="co"># Intercept difference (60 cm - 30 cm)</span></span>
<span>    d1 <span class="op">=</span> <span class="fl">2.11</span>,    <span class="co"># Slope difference (60 cm - 30 cm)</span></span>
<span>    da <span class="op">=</span> <span class="op">-</span><span class="fl">6.85</span>    <span class="co"># Plateau cutoff difference (60 cm - 30 cm)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display model summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">Soil_full</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula: ryp ~ nonlinModelF(predictor = no3, soildep = depth, b01, b11, </span></span>
<span><span class="co">#&gt;     a1, d0, d1, da)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameters:</span></span>
<span><span class="co">#&gt;     Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; b01  15.1943     2.8322   5.365 1.27e-07 ***</span></span>
<span><span class="co">#&gt; b11   3.5760     0.1762  20.291  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; a1   23.1324     0.4848  47.711  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; d0   -9.7424     4.2357  -2.300   0.0219 *  </span></span>
<span><span class="co">#&gt; d1    2.1060     0.3203   6.575 1.29e-10 ***</span></span>
<span><span class="co">#&gt; da   -6.8461     0.5691 -12.030  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 7.854 on 474 degrees of freedom</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of iterations to convergence: 1 </span></span>
<span><span class="co">#&gt; Achieved convergence tolerance: 3.742e-06</span></span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li><strong>Model Comparison: Does Depth Matter?</strong></li>
</ol>
<ul>
<li><p>If <span class="math inline">\(d_0, d_1, d_a\)</span> <strong>are significantly different from 0</strong>, the depths should be modeled separately.</p></li>
<li><p>The <strong>p-values</strong> for these parameters indicate whether depth-specific modeling is necessary.</p></li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></div>
<div class="next"><a href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#non-linear-regression"><span class="header-section-number">6</span> Non-Linear Regression</a></li>
<li>
<a class="nav-link" href="#inference"><span class="header-section-number">6.1</span> Inference</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#linear-functions-of-the-parameters"><span class="header-section-number">6.1.1</span> Linear Functions of the Parameters</a></li>
<li><a class="nav-link" href="#nonlinear-functions-of-parameters"><span class="header-section-number">6.1.2</span> Nonlinear Functions of Parameters</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#non-linear-least-squares-estimation"><span class="header-section-number">6.2</span> Non-linear Least Squares Estimation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#iterative-optimization-nonlinear-regression"><span class="header-section-number">6.2.1</span> Iterative Optimization</a></li>
<li><a class="nav-link" href="#derivative-free"><span class="header-section-number">6.2.2</span> Derivative-Free</a></li>
<li><a class="nav-link" href="#stochastic-heuristic-nolinear-regression"><span class="header-section-number">6.2.3</span> Stochastic Heuristic</a></li>
<li><a class="nav-link" href="#linearization-nonlinear-regression-optimization"><span class="header-section-number">6.2.4</span> Linearization</a></li>
<li><a class="nav-link" href="#hybrid-nonlinear-regression-optimization"><span class="header-section-number">6.2.5</span> Hybrid</a></li>
<li><a class="nav-link" href="#comparison-of-nonlinear-optimizers"><span class="header-section-number">6.2.6</span> Comparison of Nonlinear Optimizers</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#practical-considerations-2"><span class="header-section-number">6.3</span> Practical Considerations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#selecting-starting-values"><span class="header-section-number">6.3.1</span> Selecting Starting Values</a></li>
<li><a class="nav-link" href="#handling-constrained-parameters"><span class="header-section-number">6.3.2</span> Handling Constrained Parameters</a></li>
<li><a class="nav-link" href="#failure-to-converge"><span class="header-section-number">6.3.3</span> Failure to Converge</a></li>
<li><a class="nav-link" href="#convergence-to-a-local-minimum"><span class="header-section-number">6.3.4</span> Convergence to a Local Minimum</a></li>
<li><a class="nav-link" href="#model-adequacy-and-estimation-considerations"><span class="header-section-number">6.3.5</span> Model Adequacy and Estimation Considerations</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#application"><span class="header-section-number">6.4</span> Application</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#nonlinear-estimation-using-gauss-newton-algorithm"><span class="header-section-number">6.4.1</span> Nonlinear Estimation Using Gauss-Newton Algorithm</a></li>
<li><a class="nav-link" href="#logistic-growth-model"><span class="header-section-number">6.4.2</span> Logistic Growth Model</a></li>
<li><a class="nav-link" href="#nonlinear-plateau-model"><span class="header-section-number">6.4.3</span> Nonlinear Plateau Model</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mikenguyen13/data_analysis/blob/main/06-nonlinear-regession.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mikenguyen13/data_analysis/edit/main/06-nonlinear-regession.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide on Data Analysis</strong>" was written by Mike Nguyen. It was last built on 2025-02-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
