<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 28 Synthetic Difference-in-Differences | A Guide on Data Analysis</title>
<meta name="author" content="Mike Nguyen">
<meta name="description" content="by (Arkhangelsky et al. 2021) also known as weighted double-differencing estimators Setting: Researchers use panel data to study effects of policy changes. Panel data: repeated observations across...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="Chapter 28 Synthetic Difference-in-Differences | A Guide on Data Analysis">
<meta property="og:type" content="book">
<meta property="og:url" content="https://bookdown.org/mike/data_analysis/synthetic-difference-in-differences.html">
<meta property="og:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<meta property="og:description" content="by (Arkhangelsky et al. 2021) also known as weighted double-differencing estimators Setting: Researchers use panel data to study effects of policy changes. Panel data: repeated observations across...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 28 Synthetic Difference-in-Differences | A Guide on Data Analysis">
<meta name="twitter:description" content="by (Arkhangelsky et al. 2021) also known as weighted double-differencing estimators Setting: Researchers use panel data to study effects of policy changes. Panel data: repeated observations across...">
<meta name="twitter:image" content="https://bookdown.org/mike/data_analysis//images/cover.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.6.1/transition.js"></script><script src="libs/bs3compat-0.6.1/tabs.js"></script><script src="libs/bs3compat-0.6.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){window.dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-DMNX2X65HQ');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">A Guide on Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">2</span> Prerequisites</a></li>
<li class="book-part">I. BASIC</li>
<li><a class="" href="descriptive-statistics.html"><span class="header-section-number">3</span> Descriptive Statistics</a></li>
<li><a class="" href="basic-statistical-inference.html"><span class="header-section-number">4</span> Basic Statistical Inference</a></li>
<li class="book-part">II. REGRESSION</li>
<li><a class="" href="linear-regression.html"><span class="header-section-number">5</span> Linear Regression</a></li>
<li><a class="" href="non-linear-regression.html"><span class="header-section-number">6</span> Non-Linear Regression</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">7</span> Generalized Linear Models</a></li>
<li><a class="" href="sec-linear-mixed-models.html"><span class="header-section-number">8</span> Linear Mixed Models</a></li>
<li><a class="" href="sec-nonlinear-and-generalized-linear-mixed-models.html"><span class="header-section-number">9</span> Nonlinear and Generalized Linear Mixed Models</a></li>
<li><a class="" href="nonparametric-regression.html"><span class="header-section-number">10</span> Nonparametric Regression</a></li>
<li class="book-part">III. RAMIFICATIONS</li>
<li><a class="" href="data.html"><span class="header-section-number">11</span> Data</a></li>
<li><a class="" href="variable-transformation.html"><span class="header-section-number">12</span> Variable Transformation</a></li>
<li><a class="" href="imputation-missing-data.html"><span class="header-section-number">13</span> Imputation (Missing Data)</a></li>
<li><a class="" href="model-specification-tests.html"><span class="header-section-number">14</span> Model Specification Tests</a></li>
<li><a class="" href="variable-selection.html"><span class="header-section-number">15</span> Variable Selection</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">16</span> Hypothesis Testing</a></li>
<li><a class="" href="sec-marginal-effects.html"><span class="header-section-number">17</span> Marginal Effects</a></li>
<li><a class="" href="moderation.html"><span class="header-section-number">18</span> Moderation</a></li>
<li><a class="" href="mediation.html"><span class="header-section-number">19</span> Mediation</a></li>
<li><a class="" href="prediction-and-estimation.html"><span class="header-section-number">20</span> Prediction and Estimation</a></li>
<li class="book-part">IV. CAUSAL INFERENCE</li>
<li><a class="" href="sec-causal-inference.html"><span class="header-section-number">21</span> Causal Inference</a></li>
<li class="book-part">A. EXPERIMENTAL DESIGN</li>
<li><a class="" href="experimental-design.html"><span class="header-section-number">22</span> Experimental Design</a></li>
<li><a class="" href="sampling.html"><span class="header-section-number">23</span> Sampling</a></li>
<li><a class="" href="sec-analysis-of-variance-anova.html"><span class="header-section-number">24</span> Analysis of Variance</a></li>
<li><a class="" href="sec-multivariate-methods.html"><span class="header-section-number">25</span> Multivariate Methods</a></li>
<li class="book-part">B. QUASI-EXPERIMENTAL DESIGN</li>
<li><a class="" href="sec-quasi-experimental.html"><span class="header-section-number">26</span> Quasi-experimental</a></li>
<li><a class="" href="regression-discontinuity.html"><span class="header-section-number">27</span> Regression Discontinuity</a></li>
<li><a class="active" href="synthetic-difference-in-differences.html"><span class="header-section-number">28</span> Synthetic Difference-in-Differences</a></li>
<li><a class="" href="difference-in-differences.html"><span class="header-section-number">29</span> Difference-in-differences</a></li>
<li><a class="" href="changes-in-changes.html"><span class="header-section-number">30</span> Changes-in-Changes</a></li>
<li><a class="" href="synthetic-control.html"><span class="header-section-number">31</span> Synthetic Control</a></li>
<li><a class="" href="event-studies.html"><span class="header-section-number">32</span> Event Studies</a></li>
<li><a class="" href="instrumental-variables.html"><span class="header-section-number">33</span> Instrumental Variables</a></li>
<li><a class="" href="matching-methods.html"><span class="header-section-number">34</span> Matching Methods</a></li>
<li><a class="" href="interrupted-time-series.html"><span class="header-section-number">35</span> Interrupted Time Series</a></li>
<li class="book-part">C. OTHER CONCERNS</li>
<li><a class="" href="endogeneity.html"><span class="header-section-number">36</span> Endogeneity</a></li>
<li><a class="" href="other-biases.html"><span class="header-section-number">37</span> Other Biases</a></li>
<li><a class="" href="controls.html"><span class="header-section-number">38</span> Controls</a></li>
<li><a class="" href="directed-acyclic-graph.html"><span class="header-section-number">39</span> Directed Acyclic Graph</a></li>
<li class="book-part">V. MISCELLANEOUS</li>
<li><a class="" href="report.html"><span class="header-section-number">40</span> Report</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">41</span> Exploratory Data Analysis</a></li>
<li><a class="" href="sensitivity-analysis-robustness-check.html"><span class="header-section-number">42</span> Sensitivity Analysis/ Robustness Check</a></li>
<li><a class="" href="replication-and-synthetic-data.html"><span class="header-section-number">43</span> Replication and Synthetic Data</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="appendix.html"><span class="header-section-number">A</span> Appendix</a></li>
<li><a class="" href="bookdown-cheat-sheet.html"><span class="header-section-number">B</span> Bookdown cheat sheet</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mikenguyen13/data_analysis">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="synthetic-difference-in-differences" class="section level1" number="28">
<h1>
<span class="header-section-number">28</span> Synthetic Difference-in-Differences<a class="anchor" aria-label="anchor" href="#synthetic-difference-in-differences"><i class="fas fa-link"></i></a>
</h1>
<p>by <span class="citation">(<a href="references.html#ref-arkhangelsky2021synthetic">Arkhangelsky et al. 2021</a>)</span></p>
<p>also known as weighted double-differencing estimators</p>
<ul>
<li>
<p>Setting: Researchers use panel data to study effects of policy changes.</p>
<ul>
<li><p>Panel data: repeated observations across time for various units.</p></li>
<li><p>Some units exposed to policy at different times than others.</p></li>
</ul>
</li>
<li>
<p>Policy changes often aren’t random across units or time.</p>
<ul>
<li>Challenge: Observed covariates might not lead to credible conclusions of no confounding <span class="citation">(<a href="references.html#ref-imbens2015causal">G. W. Imbens and Rubin 2015</a>)</span>
</li>
</ul>
</li>
<li>
<p>To estimate the effects, either</p>
<ul>
<li><p><a href="difference-in-differences.html#difference-in-differences">Difference-in-differences</a> (DID) method widely used in applied economics.</p></li>
<li><p><a href="synthetic-control.html#synthetic-control">Synthetic Control</a> (SC) methods offer alternative approach for comparative case studies.</p></li>
</ul>
</li>
<li>
<p>Difference between DID and SC:</p>
<ul>
<li><p>DID: used with many policy-exposed units; relies on “parallel trends” assumption.</p></li>
<li><p>SC: used with few policy-exposed units; compensates lack of parallel trends by reweighting units based on pre-exposure trends.</p></li>
</ul>
</li>
<li>
<p><strong>New proposition</strong>: Synthetic Difference in Differences (SDID).</p>
<ul>
<li><p>Combines features of DID and SC.</p></li>
<li><p>Reweights and matches pre-exposure trends (similar to SC).</p></li>
<li><p>Invariant to additive unit-level shifts, valid for large-panel inference (like DID).</p></li>
</ul>
</li>
<li>
<p>Attractive features:</p>
<ul>
<li><p>SDID provides consistent and asymptotically normal estimates.</p></li>
<li>
<p>SDID performs on par with or better than DID in traditional DID settings.</p>
<ul>
<li>where DID can only handle completely random treatment assignment, SDID can handle cases where treatment assignment is correlated with some time or unit latent factors.</li>
</ul>
</li>
<li><p>Similarly, SDID is as good as or better than SC in traditional SC settings.</p></li>
<li><p>Uniformly random treatment assignment results in unbiased outcomes for all methods, but SDID is more precise.</p></li>
<li><p>SDID reduces bias effectively for non-uniformly random assignments.</p></li>
<li><p>SDID’s double robustness is akin to the augmented inverse probability weighting estimator <span class="citation">Scharfstein, Rotnitzky, and Robins (<a href="references.html#ref-scharfstein1999adjusting">1999</a>)</span>.</p></li>
<li><p>Very much similar to augmented SC estimator by <span class="citation">(<a href="references.html#ref-ben2021augmented">Ben-Michael, Feller, and Rothstein 2021</a>; <a href="references.html#ref-arkhangelsky2021synthetic">Arkhangelsky et al. 2021, 4112</a>)</span></p></li>
</ul>
</li>
</ul>
<p>Ideal case to use SDID estimator is when</p>
<ul>
<li><p><span class="math inline">\(N_{ctr} \approx T_{pre}\)</span></p></li>
<li><p>Small <span class="math inline">\(T_{post}\)</span></p></li>
<li><p><span class="math inline">\(N_{tr} &lt;\sqrt{N_{ctr}}\)</span></p></li>
</ul>
<p>Applications in marketing:</p>
<ul>
<li><p><span class="citation">Lambrecht, Tucker, and Zhang (<a href="references.html#ref-lambrecht2024tv">2024</a>)</span>: TV ads on online browsing and sales.</p></li>
<li><p><span class="citation">Keller, Guyt, and Grewal (<a href="references.html#ref-keller2024soda">2024</a>)</span>: soda tax on marketing effectiveness.</p></li>
</ul>
<hr>
<div id="understanding" class="section level2" number="28.1">
<h2>
<span class="header-section-number">28.1</span> Understanding<a class="anchor" aria-label="anchor" href="#understanding"><i class="fas fa-link"></i></a>
</h2>
<p>Consider a traditional time-series cross-sectional data</p>
<p>Let <span class="math inline">\(Y_{it}\)</span> denote the outcome for unit <span class="math inline">\(i\)</span> in period <span class="math inline">\(t\)</span></p>
<p>A balanced panel of <span class="math inline">\(N\)</span> units and <span class="math inline">\(T\)</span> time periods</p>
<ul>
<li><p><span class="math inline">\(W_{it} \in \{0, 1\}\)</span> is the binary treatment</p></li>
<li><p><span class="math inline">\(N_c\)</span> never-treated units (control)</p></li>
<li><p><span class="math inline">\(N_t\)</span> treated units after time <span class="math inline">\(T_{pre}\)</span></p></li>
</ul>
<p><strong>Steps</strong>:</p>
<ol style="list-style-type: decimal">
<li>Find unit weights <span class="math inline">\(\hat{w}^{sdid}\)</span> such that <span class="math inline">\(\sum_{i = 1}^{N_c} \hat{w}_i^{sdid} Y_{it} \approx N_t^{-1} \sum_{i = N_c + 1}^N Y_{it} \forall t = 1, \dots, T_{pre}\)</span> (i.e., pre-treatment trends in outcome of the treated similar to those of control units) (similar to SC).</li>
<li>Find time weights <span class="math inline">\(\hat{\lambda}_t\)</span> such that we have a balanced window (i.e., posttreatment outcomes for control units differ consistently from their weighted average pretreatment outcomes).</li>
<li>Estimate the average causal effect of treatment</li>
</ol>
<p><span class="math display">\[
(\hat{\tau}^{sdid}, \hat{\mu}, \hat{\alpha}, \hat{\beta}) = \arg \min_{\tau, \mu, \alpha, \beta} \{ \sum_{i = 1}^N \sum_{t = 1}^T (Y_{it} - \mu - \alpha_i - \beta_ t - W_{it} \tau)^2 \hat{w}_i^{sdid} \hat{\lambda}_t^{sdid} \}
\]</span></p>
<p>Better than DiD estimator because <span class="math inline">\(\tau^{did}\)</span> does not consider time or unit weights</p>
<p><span class="math display">\[
(\hat{\tau}^{did}, \hat{\mu}, \hat{\alpha}, \hat{\beta}) = \arg \min_{\tau, \mu, \alpha, \beta} \{ \sum_{i = 1}^N \sum_{t = 1}^T (Y_{it} - \mu - \alpha_i - \beta_ t - W_{it} \tau)^2 \}
\]</span></p>
<p>Better than SC estimator because <span class="math inline">\(\tau^{sc}\)</span> lacks unit fixed effete and time weights</p>
<p><span class="math display">\[
(\hat{\tau}^{sc}, \hat{\mu}, \hat{\beta}) = \arg \min_{\tau, \mu, \beta} \{ \sum_{i = 1}^N \sum_{t = 1}^T (Y_{it} - \mu - \beta_ t - W_{it} \tau)^2 \hat{w}_i^{sdid}  \}
\]</span></p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="11%">
<col width="24%">
<col width="28%">
<col width="35%">
</colgroup>
<thead><tr class="header">
<th></th>
<th><strong>DID</strong></th>
<th><strong>SC</strong></th>
<th><strong>SDID</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Primary Assumption</strong></td>
<td>Absence of intervention leads to parallel evolution across states.</td>
<td>Reweights unexposed states to match pre-intervention outcomes of treated state.</td>
<td>Reweights control units to ensure a parallel time trend with the treated pre-intervention trend.</td>
</tr>
<tr class="even">
<td><strong>Reliability Concern</strong></td>
<td>Can be unreliable when pre-intervention trends aren’t parallel.</td>
<td>Accounts for non-parallel pre-intervention trends by reweighting.</td>
<td>Uses reweighting to adjust for non-parallel pre-intervention trends.</td>
</tr>
<tr class="odd">
<td><strong>Treatment of Time Periods</strong></td>
<td>All pre-treatment periods are given equal weight.</td>
<td>Doesn’t specifically emphasize equal weight for pre-treatment periods.</td>
<td>Focuses only on a subset of pre-intervention time periods, selected based on historical outcomes.</td>
</tr>
<tr class="even">
<td><strong>Goal with Reweighting</strong></td>
<td>N/A (doesn’t use reweighting).</td>
<td>To match treated state as closely as possible before the intervention.</td>
<td>Make trends of control units parallel (not necessarily identical) to the treated pre-intervention.</td>
</tr>
</tbody>
</table></div>
<p>Alternatively, think of our parameter of interest as:</p>
<p><span class="math display">\[
\hat{\tau} = \hat{\delta}_t - \sum_{i = 1}^{N_c} \hat{w}_i \hat{\delta}_i
\]</span></p>
<p>where <span class="math inline">\(\hat{\delta}_t = \frac{1}{N_t} \sum_{i = N_c + 1}^N \hat{\delta}_i\)</span></p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="4%">
<col width="21%">
<col width="41%">
<col width="31%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Sample Weight</th>
<th>Adjusted outcomes (<span class="math inline">\(\hat{\delta}_i\)</span>)</th>
<th>Interpretation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>SC</td>
<td><span class="math inline">\(\hat{w}^{sc} = \min_{w \in R}l_{unit}(w)\)</span></td>
<td><span class="math inline">\(\frac{1}{T_{post}} \sum_{t = T_{pre} + 1}^T Y_{it}\)</span></td>
<td>Unweighted treatment period averages</td>
</tr>
<tr class="even">
<td>DID</td>
<td><span class="math inline">\(\hat{w}_i^{did} = N_c^{-1}\)</span></td>
<td><span class="math inline">\(\frac{1}{T_{post}} \sum_{t = T_{pre}+ 1}^T Y_{it} - \frac{1}{T_{pre}} \sum_{t = 1}^{T_{pre}}Y_{it}\)</span></td>
<td>Unweighted differences between average treatment period and pretreatment outcome</td>
</tr>
<tr class="odd">
<td>SDID</td>
<td><span class="math inline">\((\hat{w}_0, \hat{w}^{sdid}) = \min l_{unit}(w_0, w)\)</span></td>
<td><span class="math inline">\(\frac{1}{T_{post}} \sum_{t = T_{pre} + 1}^T Y_{it} - \sum_{t = 1}^{T_{pre}} \hat{\lambda}_t^{sdid} Y_{it}\)</span></td>
<td>Weighted differences between average treatment period and pretreatment outcome</td>
</tr>
</tbody>
</table></div>
<ul>
<li>
<p>The SDID estimator uses weights:</p>
<ul>
<li><p>Makes two-way fixed effect regression “local.”</p></li>
<li><p>Emphasizes units similar in their past to treated units.</p></li>
<li><p>Prioritizes periods resembling treated periods.</p></li>
</ul>
</li>
<li>
<p>Benefits of this localization:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Robustness</strong>: Using similar units and periods boosts estimator’s robustness.</p></li>
<li>
<p><strong>Improved Precision</strong>: Weights can eliminate predictable outcome components.</p>
<ul>
<li><p>The SEs of SDID are smaller than those of SC and DID</p></li>
<li><p>Caveat: If there’s minor systematic heterogeneity in outcomes, unequal weighting might reduce precision compared to standard DID.</p></li>
</ul>
</li>
</ol>
</li>
<li>
<p>Weight Design:</p>
<ul>
<li><p><strong>Unit Weights</strong>: Makes average outcome for treated units roughly parallel to the weighted average for control units.</p></li>
<li><p><strong>Time Weights</strong>: Ensures posttreatment outcomes for control units differ consistently from their weighted average pretreatment outcomes.</p></li>
</ul>
</li>
<li>
<p>Weights enhance DID’s plausibility:</p>
<ul>
<li><p>Raw data often lacks parallel time trends for treated/control units.</p></li>
<li><p>Similar techniques (e.g., adjusting for covariates or selecting specific time periods) were used before <span class="citation">(<a href="references.html#ref-callaway2021difference">Callaway and Sant’Anna 2021</a>)</span>.</p></li>
<li><p>SDID automates this process, applying a similar logic to weight both units and time periods.</p></li>
</ul>
</li>
<li>
<p>Time Weights in SDID:</p>
<ul>
<li>Removes bias and boosts precision (i.e., minimizes the influence of time periods vastly different from posttreatment periods).</li>
</ul>
</li>
<li>
<p>Argument for Unit Fixed Effects:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Flexibility</strong>: Increases model flexibility and thereby bolsters robustness.</p></li>
<li><p><strong>Enhanced Precision</strong>: Unit fixed effects explain a significant portion of outcome variation.</p></li>
</ol>
</li>
<li>
<p>SC Weighting &amp; Unit Fixed Effects:</p>
<ul>
<li>
<p>Under certain conditions, SC weighting can inherently account for unit fixed effects.</p>
<ul>
<li>For example, when the weighted average outcome for control units in pretreatment is the same as that of the treated units. (unlikely in reality)</li>
</ul>
</li>
<li><p>The use of unit fixed effect in synthetic control regression (i.e., synthetic control with intercept) was proposed before in <span class="citation">Doudchenko and Imbens (<a href="references.html#ref-doudchenko2016balancing">2016</a>)</span> and <span class="citation">Ferman and Pinto (<a href="references.html#ref-ferman2021synthetic">2021</a>)</span> (called DIFP)</p></li>
</ul>
</li>
</ul>
<p>More details on application</p>
<ol style="list-style-type: decimal">
<li>Choose unit weights</li>
</ol>
<ul>
<li>
<p>Regularization Parameter:</p>
<ul>
<li>Equal to the size of a typical one-period outcome change for control units in the pre-period, then multiplied by a scaling factor <span class="citation">(<a href="references.html#ref-arkhangelsky2021synthetic">Arkhangelsky et al. 2021, 4092</a>)</span>.</li>
</ul>
</li>
<li>
<p>Relation to SC Weights:</p>
<ul>
<li>
<p>SDID weights are similar to those used in <span class="citation">(<a href="references.html#ref-abadie2010synthetic">Abadie, Diamond, and Hainmueller 2010</a>)</span> except two distinctions:</p>
<ol style="list-style-type: decimal">
<li>
<p>Inclusion of an Intercept Term:</p>
<ul>
<li><p>The weights in SynthDiD do not necessarily make the control pre-trends perfectly match the treated trends, just make them parallel.</p></li>
<li><p>This flexibility comes from the use of unit fixed effects, which can absorb any consistent differences between units.</p></li>
</ul>
</li>
<li>
<p>Regularization Penalty:</p>
<ul>
<li><p>Adopted from <span class="citation">Doudchenko and Imbens (<a href="references.html#ref-doudchenko2016balancing">2016</a>)</span> .</p></li>
<li><p>Enhances the dispersion and ensures the uniqueness of the weights.</p></li>
</ul>
</li>
</ol>
</li>
<li><p>DID weights are identical to those used in <span class="citation">(<a href="references.html#ref-abadie2010synthetic">Abadie, Diamond, and Hainmueller 2010</a>)</span> without intercept and regularization penalty and 1 treated unit.</p></li>
</ul>
</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Choose time weights</li>
</ol>
<ul>
<li>Also include an intercept term, but no regularization (because correlated observations within time periods for the same unit is plausible, but not across units within the same period).</li>
</ul>
<p><strong>Note</strong>: To account for time-varying variables in the weights, one can use the residuals of the regression of the observed outcome on these time-varying variables, instead of the observed outcomes themselves (<span class="math inline">\(Y_{it}^{res} = Y_{it} - X_{it} \hat{\beta}\)</span>, where <span class="math inline">\(\hat{\beta}\)</span> come from <span class="math inline">\(Y = \beta X_{it}\)</span>).</p>
<p>The SDID method can account for systematic effects, often referred to as unit effects or unit heterogeneity, which influence treatment assignment (i.e., when treatment assignment is correlated with these systematic effects). Consequently, it provides unbiased estimates, especially valuable when there’s a suspicion that the treatment might be influenced by persistent, unit-specific attributes.</p>
<p>Even in cases where we have completely random assignment, SDID, DiD, and SC are unbiased, but SynthDiD has the smallest SE.</p>
<hr>
</div>
<div id="application-6" class="section level2" number="28.2">
<h2>
<span class="header-section-number">28.2</span> Application<a class="anchor" aria-label="anchor" href="#application-6"><i class="fas fa-link"></i></a>
</h2>
<p><strong>SDID Algorithm</strong></p>
<ol style="list-style-type: decimal">
<li>Compute regularization parameter <span class="math inline">\(\zeta\)</span>
</li>
</ol>
<p><span class="math display">\[
\zeta = (N_{t}T_{post})^{1/4} \hat{\sigma}
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\hat{\sigma}^2 = \frac{1}{N_c(T_{pre}- 1)} \sum_{i = 1}^{N_c} \sum_{t = 1}^{T_{re}-1}(\Delta_{it} - \hat{\Delta})^2
\]</span></p>
<ul>
<li><p><span class="math inline">\(\Delta_{it} = Y_{i(t + 1)} - Y_{it}\)</span></p></li>
<li><p><span class="math inline">\(\hat{\Delta} = \frac{1}{N_c(T_{pre} - 1)}\sum_{i = 1}^{N_c}\sum_{t = 1}^{T_{pre}-1} \Delta_{it}\)</span></p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Compute unit weights <span class="math inline">\(\hat{w}^{sdid}\)</span>
</li>
</ol>
<p><span class="math display">\[
(\hat{w}_0, \hat{w}^{sidid}) = \arg \min_{w_0 \in R, w \in \Omega}l_{unit}(w_0, w)
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(l_{unit} (w_0, w) = \sum_{t = 1}^{T_{pre}}(w_0 + \sum_{i = 1}^{N_c}w_i Y_{it} - \frac{1}{N_t}\sum_{i = N_c + 1}^NY_{it})^2 + \zeta^2 T_{pre}||w||_2^2\)</span></p></li>
<li><p><span class="math inline">\(\Omega = \{w \in R_+^N: \sum_{i = 1}^{N_c} w_i = 1, w_i = N_t^{-1} \forall i = N_c + 1, \dots, N \}\)</span></p></li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Compute time weights <span class="math inline">\(\hat{\lambda}^{sdid}\)</span>
</li>
</ol>
<p><span class="math display">\[
(\hat{\lambda}_0 , \hat{\lambda}^{sdid}) = \arg \min_{\lambda_0 \in R, \lambda \in \Lambda} l_{time}(\lambda_0, \lambda)
\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(l_{time} (\lambda_0, \lambda) = \sum_{i = 1}^{N_c}(\lambda_0 + \sum_{t = 1}^{T_{pre}} \lambda_t Y_{it} - \frac{1}{T_{post}} \sum_{t = T_{pre} + 1}^T Y_{it})^2\)</span></p></li>
<li><p><span class="math inline">\(\Lambda = \{ \lambda \in R_+^T: \sum_{t = 1}^{T_{pre}} \lambda_t = 1, \lambda_t = T_{post}^{-1} \forall t = T_{pre} + 1, \dots, T\}\)</span></p></li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Compute the SDID estimator</li>
</ol>
<p><span class="math display">\[
(\hat{\tau}^{sdid}, \hat{\mu}, \hat{\alpha}, \hat{\beta}) = \arg \min_{\tau, \mu, \alpha, \beta}\{ \sum_{i = 1}^N \sum_{t = 1}^T (Y_{it} - \mu - \alpha_i - \beta_t - W_{it} \tau)^2 \hat{w}_i^{sdid}\hat{\lambda}_t^{sdid}
\]</span></p>
<hr>
<p><strong>SE Estimation</strong></p>
<ul>
<li><p>Under certain assumptions (errors, samples, and interaction properties between time and unit fixed effects) detailed in <span class="citation">(<a href="references.html#ref-arkhangelsky2019synthetic">Arkhangelsky et al. 2019, 4107</a>)</span>, SDID is asymptotically normal and zero-centered</p></li>
<li><p>Using its asymptotic variance, conventional confidence intervals can be applied to SDID.</p></li>
</ul>
<p><span class="math display">\[
\tau \in \hat{\tau}^{sdid} \pm z_{\alpha/2}\sqrt{\hat{V}_\tau}
\]</span></p>
<ul>
<li>
<p>There are 3 approaches for variance estimation in confidence intervals:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>Clustered Bootstrap <span class="citation">(<a href="references.html#ref-efron1992bootstrap">Efron 1992</a>)</span>:</strong></p>
<ul>
<li><p>Independently resample units.</p></li>
<li><p>Advantages: Simple to use; robust performance in large panels due to natural approach to inference with panel data where observations of the same unit might be correlated.</p></li>
<li><p>Disadvantage: Computationally expensive.</p></li>
</ul>
</li>
<li>
<p><strong>Jackknife <span class="citation">(<a href="references.html#ref-miller1974jackknife">Miller 1974</a>)</span>:</strong></p>
<ul>
<li><p>Applied to weighted SDID regression with fixed weights.</p></li>
<li><p>Generally conservative and precise when treated and control units are sufficiently similar.</p></li>
<li><p>Not recommended for some methods, like the SC estimator, due to potential biases.</p></li>
<li><p>Appropriate for jackknifing DID without random weights.</p></li>
</ul>
</li>
<li>
<p><strong>Placebo Variance Estimation:</strong></p>
<ul>
<li><p>Can used in cases with only one treated unit or large panels.</p></li>
<li><p>Placebo evaluations swap out the treated unit for untreated ones to estimate noise.</p></li>
<li><p>Relies on homoskedasticity across units.</p></li>
<li><p>Depends on homoskedasticity across units. It hinges on the empirical distribution of residuals from placebo estimators on control units.</p></li>
<li><p>The validity of the placebo method hinges on consistent noise distribution across units. One treated unit makes nonparametric variance estimation difficult, necessitating homoskedasticity for feasible inference. Detailed analysis available in <span class="citation">Conley and Taber (<a href="references.html#ref-conley2011inference">2011</a>)</span>.</p></li>
</ul>
</li>
</ol>
</li>
</ul>
<p>All algorithms are from <span class="citation">Arkhangelsky et al. (<a href="references.html#ref-arkhangelsky2021synthetic">2021</a>)</span>, p. 4109:</p>
<blockquote>
<p><strong>Bootstrap Variance Estimation</strong></p>
<ol style="list-style-type: decimal">
<li>
<p>For each <span class="math inline">\(b\)</span> from <span class="math inline">\(1 \to B\)</span>:</p>
<ul>
<li><p>Sample <span class="math inline">\(N\)</span> rows from <span class="math inline">\((\mathbf{Y}, \mathbf{W})\)</span> to get (<span class="math inline">\(\mathbf{Y}^{(b)}, \mathbf{W}^{(b)}\)</span>) with replacement.</p></li>
<li><p>If the sample lacks treated or control units, resample.</p></li>
<li><p>Calculate <span class="math inline">\(\tau^{(b)}\)</span> using (<span class="math inline">\(\mathbf{Y}^{(b)}, \mathbf{W}^{(b)}\)</span>).</p></li>
</ul>
</li>
<li><p>Calculate variance: <span class="math inline">\(\hat{V}_\tau = \frac{1}{B} \sum_{b = 1}^B (\hat{\tau}^{b} - \frac{1}{B} \sum_{b = 1}^B \hat{\tau}^b)^2\)</span></p></li>
</ol>
</blockquote>
<blockquote>
<p><strong>Jackknife Variance Estimation</strong></p>
<ol style="list-style-type: decimal">
<li>For each <span class="math inline">\(i\)</span> from <span class="math inline">\(1 \to N\)</span>:
<ol style="list-style-type: decimal">
<li>Calculate <span class="math inline">\(\hat{\tau}^{(-i)}\)</span>: <span class="math inline">\(\arg\min_{\tau, \{\alpha_j, \beta_t\}} \sum_{j \neq, i, t}(\mathbf{Y}_{jt} - \alpha_j - \beta_t - \tau \mathbf{W}_{it})^2 \hat{w}_j \hat{\lambda}_t\)</span>
</li>
</ol>
</li>
<li>Calculate: <span class="math inline">\(\hat{V}_{\tau} = (N - 1) N^{-1} \sum_{i = 1}^N (\hat{\tau}^{(-i)} - \hat{\tau})^2\)</span>
</li>
</ol>
</blockquote>
<blockquote>
<p><strong>Placebo Variance Estimation</strong></p>
<ol style="list-style-type: decimal">
<li>For each <span class="math inline">\(b\)</span> from <span class="math inline">\(1 \to B\)</span>
<ol style="list-style-type: decimal">
<li>Sample <span class="math inline">\(N_t\)</span> out of <span class="math inline">\(N_c\)</span> without replacement to get the “placebo” treatment</li>
<li>Construct a placebo treatment matrix <span class="math inline">\(\mathbf{W}_c^b\)</span> for the controls</li>
<li>Calculate <span class="math inline">\(\hat{\tau}\)</span> based on <span class="math inline">\((\mathbf{Y}_c, \mathbf{W}_c^b)\)</span>
</li>
</ol>
</li>
<li>Calculate <span class="math inline">\(\hat{V}_\tau = \frac{1}{B}\sum_{b = 1}^B (\hat{\tau}^b - \frac{1}{B} \sum_{b = 1}^B \hat{\tau}^b)^2\)</span>
</li>
</ol>
</blockquote>
<div id="block-treatment" class="section level3" number="28.2.1">
<h3>
<span class="header-section-number">28.2.1</span> Block Treatment<a class="anchor" aria-label="anchor" href="#block-treatment"><i class="fas fa-link"></i></a>
</h3>
<p>Code provided by the <code>synthdid</code> package</p>
<div class="sourceCode" id="cb754"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/synth-inference/synthdid">synthdid</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate the effect of California Proposition 99 on cigarette consumption</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">'california_prop99'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">setup</span> <span class="op">=</span> <span class="fu">synthdid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/synthdid/man/panel.matrices.html">panel.matrices</a></span><span class="op">(</span><span class="fu">synthdid</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/synthdid/man/california_prop99.html">california_prop99</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">tau.hat</span> <span class="op">=</span> <span class="fu">synthdid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/synthdid/man/synthdid_estimate.html">synthdid_estimate</a></span><span class="op">(</span><span class="va">setup</span><span class="op">$</span><span class="va">Y</span>, <span class="va">setup</span><span class="op">$</span><span class="va">N0</span>, <span class="va">setup</span><span class="op">$</span><span class="va">T0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># se = sqrt(vcov(tau.hat, method = 'placebo'))</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span><span class="op">(</span><span class="va">tau.hat</span><span class="op">)</span> <span class="op">+</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/ama_theme.html">ama_theme</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-synthdid_files/figure-html/unnamed-chunk-1-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb755"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">setup</span> <span class="op">=</span> <span class="fu">synthdid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/synthdid/man/panel.matrices.html">panel.matrices</a></span><span class="op">(</span><span class="fu">synthdid</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/synthdid/man/california_prop99.html">california_prop99</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run for specific estimators</span></span>
<span><span class="va">results_selected</span> <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/panel_estimate.html">panel_estimate</a></span><span class="op">(</span><span class="va">setup</span>,</span>
<span>                                               selected_estimators <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"synthdid"</span>, <span class="st">"did"</span>, <span class="st">"sc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results_selected</span></span>
<span><span class="co">#&gt; $synthdid</span></span>
<span><span class="co">#&gt; $synthdid$estimate</span></span>
<span><span class="co">#&gt; synthdid: -15.604 +- NA. Effective N0/N0 = 16.4/38~0.4. Effective T0/T0 = 2.8/19~0.1. N1,T1 = 1,12. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $synthdid$std.error</span></span>
<span><span class="co">#&gt; [1] 10.05324</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $did</span></span>
<span><span class="co">#&gt; $did$estimate</span></span>
<span><span class="co">#&gt; synthdid: -27.349 +- NA. Effective N0/N0 = 38.0/38~1.0. Effective T0/T0 = 19.0/19~1.0. N1,T1 = 1,12. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $did$std.error</span></span>
<span><span class="co">#&gt; [1] 15.81479</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sc</span></span>
<span><span class="co">#&gt; $sc$estimate</span></span>
<span><span class="co">#&gt; synthdid: -19.620 +- NA. Effective N0/N0 = 3.8/38~0.1. Effective T0/T0 = Inf/19~Inf. N1,T1 = 1,12. </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $sc$std.error</span></span>
<span><span class="co">#&gt; [1] 11.16422</span></span>
<span></span>
<span><span class="co"># to access more details in the estimate object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">results_selected</span><span class="op">$</span><span class="va">did</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; $estimate</span></span>
<span><span class="co">#&gt; [1] -27.34911</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $se</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]   NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $controls</span></span>
<span><span class="co">#&gt;                estimate 1</span></span>
<span><span class="co">#&gt; Wyoming             0.026</span></span>
<span><span class="co">#&gt; Wisconsin           0.026</span></span>
<span><span class="co">#&gt; West Virginia       0.026</span></span>
<span><span class="co">#&gt; Virginia            0.026</span></span>
<span><span class="co">#&gt; Vermont             0.026</span></span>
<span><span class="co">#&gt; Utah                0.026</span></span>
<span><span class="co">#&gt; Texas               0.026</span></span>
<span><span class="co">#&gt; Tennessee           0.026</span></span>
<span><span class="co">#&gt; South Dakota        0.026</span></span>
<span><span class="co">#&gt; South Carolina      0.026</span></span>
<span><span class="co">#&gt; Rhode Island        0.026</span></span>
<span><span class="co">#&gt; Pennsylvania        0.026</span></span>
<span><span class="co">#&gt; Oklahoma            0.026</span></span>
<span><span class="co">#&gt; Ohio                0.026</span></span>
<span><span class="co">#&gt; North Dakota        0.026</span></span>
<span><span class="co">#&gt; North Carolina      0.026</span></span>
<span><span class="co">#&gt; New Mexico          0.026</span></span>
<span><span class="co">#&gt; New Hampshire       0.026</span></span>
<span><span class="co">#&gt; Nevada              0.026</span></span>
<span><span class="co">#&gt; Nebraska            0.026</span></span>
<span><span class="co">#&gt; Montana             0.026</span></span>
<span><span class="co">#&gt; Missouri            0.026</span></span>
<span><span class="co">#&gt; Mississippi         0.026</span></span>
<span><span class="co">#&gt; Minnesota           0.026</span></span>
<span><span class="co">#&gt; Maine               0.026</span></span>
<span><span class="co">#&gt; Louisiana           0.026</span></span>
<span><span class="co">#&gt; Kentucky            0.026</span></span>
<span><span class="co">#&gt; Kansas              0.026</span></span>
<span><span class="co">#&gt; Iowa                0.026</span></span>
<span><span class="co">#&gt; Indiana             0.026</span></span>
<span><span class="co">#&gt; Illinois            0.026</span></span>
<span><span class="co">#&gt; Idaho               0.026</span></span>
<span><span class="co">#&gt; Georgia             0.026</span></span>
<span><span class="co">#&gt; Delaware            0.026</span></span>
<span><span class="co">#&gt; Connecticut         0.026</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $periods</span></span>
<span><span class="co">#&gt;      estimate 1</span></span>
<span><span class="co">#&gt; 1988      0.053</span></span>
<span><span class="co">#&gt; 1987      0.053</span></span>
<span><span class="co">#&gt; 1986      0.053</span></span>
<span><span class="co">#&gt; 1985      0.053</span></span>
<span><span class="co">#&gt; 1984      0.053</span></span>
<span><span class="co">#&gt; 1983      0.053</span></span>
<span><span class="co">#&gt; 1982      0.053</span></span>
<span><span class="co">#&gt; 1981      0.053</span></span>
<span><span class="co">#&gt; 1980      0.053</span></span>
<span><span class="co">#&gt; 1979      0.053</span></span>
<span><span class="co">#&gt; 1978      0.053</span></span>
<span><span class="co">#&gt; 1977      0.053</span></span>
<span><span class="co">#&gt; 1976      0.053</span></span>
<span><span class="co">#&gt; 1975      0.053</span></span>
<span><span class="co">#&gt; 1974      0.053</span></span>
<span><span class="co">#&gt; 1973      0.053</span></span>
<span><span class="co">#&gt; 1972      0.053</span></span>
<span><span class="co">#&gt; 1971      0.053</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $dimensions</span></span>
<span><span class="co">#&gt;           N1           N0 N0.effective           T1           T0 T0.effective </span></span>
<span><span class="co">#&gt;            1           38           38           12           19           19</span></span>
<span></span>
<span><span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/process_panel_estimate.html">process_panel_estimate</a></span><span class="op">(</span><span class="va">results_selected</span><span class="op">)</span></span>
<span><span class="co">#&gt;     Method Estimate    SE</span></span>
<span><span class="co">#&gt; 1 SYNTHDID   -15.60 10.05</span></span>
<span><span class="co">#&gt; 2      DID   -27.35 15.81</span></span>
<span><span class="co">#&gt; 3       SC   -19.62 11.16</span></span></code></pre></div>
</div>
<div id="staggered-adoption" class="section level3" number="28.2.2">
<h3>
<span class="header-section-number">28.2.2</span> Staggered Adoption<a class="anchor" aria-label="anchor" href="#staggered-adoption"><i class="fas fa-link"></i></a>
</h3>
<p>To apply to staggered adoption settings using the SDID estimator (see examples in <span class="citation">Arkhangelsky et al. (<a href="references.html#ref-arkhangelsky2021synthetic">2021</a>)</span>, p. 4115 similar to <span class="citation">Ben-Michael, Feller, and Rothstein (<a href="references.html#ref-ben2022synthetic">2022</a>)</span>), we can:</p>
<ol style="list-style-type: decimal">
<li><p>Apply the SDID estimator repeatedly, once for every adoption date.</p></li>
<li><p>Using <span class="citation">Ben-Michael, Feller, and Rothstein (<a href="references.html#ref-ben2022synthetic">2022</a>)</span> ’s method, form matrices for each adoption date. Apply SDID and average based on treated unit/time-period fractions.</p></li>
<li><p>Create multiple samples by splitting the data up by time periods. Each sample should have a consistent adoption date.</p></li>
</ol>
<p>For a formal note on this special case, see <span class="citation">Porreca (<a href="references.html#ref-porreca2022synthetic">2022</a>)</span>. It compares the outcomes from using SynthDiD with those from other estimators:</p>
<ul>
<li><p>Two-Way Fixed Effects (TWFE),</p></li>
<li><p>The group time average treatment effect estimator from <span class="citation">Callaway and Sant’Anna (<a href="references.html#ref-callaway2021difference">2021</a>)</span>,</p></li>
<li><p>The partially pooled synthetic control method estimator from <span class="citation">Ben-Michael, Feller, and Rothstein (<a href="references.html#ref-ben2021augmented">2021</a>)</span>, in a staggered treatment adoption context.</p></li>
</ul>
<!-- --><ul>
<li>
<p>The findings reveal that SynthDiD produces a different estimate of the average treatment effect compared to the other methods.</p>
<ul>
<li>Simulation results suggest that these differences could be due to the SynthDiD’s data generating process assumption (a latent factor model) aligning more closely with the actual data than the additive fixed effects model assumed by traditional DiD methods.</li>
</ul>
</li>
</ul>
<p>To explore heterogeneity of treatment effect, we can do subgroup analysis <span class="citation">(<a href="references.html#ref-berman2022value">Berman and Israeli 2022, 1092</a>)</span></p>
<div class="inline-table"><table style="width:99%;" class="table table-sm">
<colgroup>
<col width="17%">
<col width="17%">
<col width="39%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th><strong>Method</strong></th>
<th><strong>Advantages</strong></th>
<th><strong>Disadvantages</strong></th>
<th><strong>Procedure</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Split Data into Subsets</td>
<td>Compares treated units to control units within the same subgroup.</td>
<td>Each subset uses a different synthetic control, making it challenging to compare effects across subgroups.</td>
<td><ol style="list-style-type: decimal">
<li>Split the data into separate subsets for each subgroup.</li>
<li>Compute synthetic DID effects for each subset.</li>
</ol></td>
</tr>
<tr class="even">
<td>Control Group Comprising All Non-adopters</td>
<td>Control weights match pretrends well for each treated subgroup.</td>
<td>Each control unit receives a different weight for each treatment subgroup, making it difficult to compare results due to varying synthetic controls.</td>
<td><ol style="list-style-type: decimal">
<li>Use a control group consisting of all non-adopters in each balanced panel cohort analysis.</li>
<li>Switch treatment units to the subgroup being analyzed.</li>
<li>Perform <code>synthdid</code> analysis.</li>
</ol></td>
</tr>
<tr class="odd">
<td>Use All Data to Estimate Synthetic Control Weights <strong>(recommend)</strong>
</td>
<td>All units have the same synthetic control.</td>
<td>Pretrend match may not be as accurate since it aims to match the average outcome of all treated units, not just a specific subgroup.</td>
<td><ol style="list-style-type: decimal">
<li>Use all the data to estimate the synthetic DID control weights.</li>
<li>Compute treatment effects using only the treated subgroup units as the treatment units.</li>
</ol></td>
</tr>
</tbody>
</table></div>
<div class="sourceCode" id="cb756"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">fixest</span><span class="fu">::</span><span class="va"><a href="https://lrberge.github.io/fixest/reference/base_stagg.html">base_stagg</a></span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>treatvar <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">time_to_treatment</span> <span class="op">&gt;=</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>treatvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">year_treated</span> <span class="op">&gt;</span> <span class="op">(</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">treatvar</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">est</span> <span class="op">&lt;-</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/synthdid_est_ate.html">synthdid_est_ate</a></span><span class="op">(</span></span>
<span>  data               <span class="op">=</span> <span class="va">df</span>,</span>
<span>  adoption_cohorts   <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">7</span>,</span>
<span>  lags               <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  leads              <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  time_var           <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  unit_id_var        <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  treated_period_var <span class="op">=</span> <span class="st">"year_treated"</span>,</span>
<span>  treat_stat_var     <span class="op">=</span> <span class="st">"treatvar"</span>,</span>
<span>  outcome_var        <span class="op">=</span> <span class="st">"y"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Adoption Cohort: 5 </span></span>
<span><span class="co">#&gt; Treated units: 5 Control units: 65 </span></span>
<span><span class="co">#&gt; Adoption Cohort: 6 </span></span>
<span><span class="co">#&gt; Treated units: 5 Control units: 60 </span></span>
<span><span class="co">#&gt; Adoption Cohort: 7 </span></span>
<span><span class="co">#&gt; Treated units: 5 Control units: 55</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">est</span><span class="op">$</span><span class="va">TE_mean_w</span><span class="op">)</span>,</span>
<span>    ATE    <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">TE_mean_w</span>,</span>
<span>    SE     <span class="op">=</span> <span class="va">est</span><span class="op">$</span><span class="va">SE_mean_w</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/nice_tab.html">nice_tab</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Period   ATE   SE</span></span>
<span><span class="co">#&gt; 1      -2 -0.05 0.22</span></span>
<span><span class="co">#&gt; 2      -1  0.05 0.22</span></span>
<span><span class="co">#&gt; 3       0 -5.07 0.80</span></span>
<span><span class="co">#&gt; 4       1 -4.68 0.51</span></span>
<span><span class="co">#&gt; 5       2 -3.70 0.79</span></span>
<span><span class="co">#&gt; 6 cumul.0 -5.07 0.80</span></span>
<span><span class="co">#&gt; 7 cumul.1 -4.87 0.55</span></span>
<span><span class="co">#&gt; 8 cumul.2 -4.48 0.53</span></span>
<span></span>
<span></span>
<span><span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/synthdid_plot_ate.html">synthdid_plot_ate</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-synthdid_files/figure-html/unnamed-chunk-2-1.png" width="90%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb757"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">est_sub</span> <span class="op">&lt;-</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/synthdid_est_ate.html">synthdid_est_ate</a></span><span class="op">(</span></span>
<span>  data               <span class="op">=</span> <span class="va">df</span>,</span>
<span>  adoption_cohorts   <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">7</span>,</span>
<span>  lags               <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  leads              <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  time_var           <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  unit_id_var        <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  treated_period_var <span class="op">=</span> <span class="st">"year_treated"</span>,</span>
<span>  treat_stat_var     <span class="op">=</span> <span class="st">"treatvar"</span>,</span>
<span>  outcome_var        <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  <span class="co"># a vector of subgroup id (from unit id)</span></span>
<span>  subgroup           <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># some are treated</span></span>
<span>    <span class="st">"11"</span>, <span class="st">"30"</span>, <span class="st">"49"</span> ,</span>
<span>    <span class="co"># some are control within this period</span></span>
<span>    <span class="st">"20"</span>, <span class="st">"25"</span>, <span class="st">"21"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Adoption Cohort: 5 </span></span>
<span><span class="co">#&gt; Treated units: 3 Control units: 65 </span></span>
<span><span class="co">#&gt; Adoption Cohort: 6 </span></span>
<span><span class="co">#&gt; Treated units: 0 Control units: 60 </span></span>
<span><span class="co">#&gt; Adoption Cohort: 7 </span></span>
<span><span class="co">#&gt; Treated units: 0 Control units: 55</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    Period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">est_sub</span><span class="op">$</span><span class="va">TE_mean_w</span><span class="op">)</span>,</span>
<span>    ATE <span class="op">=</span> <span class="va">est_sub</span><span class="op">$</span><span class="va">TE_mean_w</span>,</span>
<span>    SE <span class="op">=</span> <span class="va">est_sub</span><span class="op">$</span><span class="va">SE_mean_w</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/nice_tab.html">nice_tab</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Period   ATE   SE</span></span>
<span><span class="co">#&gt; 1      -2  0.32 0.44</span></span>
<span><span class="co">#&gt; 2      -1 -0.32 0.44</span></span>
<span><span class="co">#&gt; 3       0 -4.29 1.68</span></span>
<span><span class="co">#&gt; 4       1 -4.00 1.52</span></span>
<span><span class="co">#&gt; 5       2 -3.44 2.90</span></span>
<span><span class="co">#&gt; 6 cumul.0 -4.29 1.68</span></span>
<span><span class="co">#&gt; 7 cumul.1 -4.14 1.52</span></span>
<span><span class="co">#&gt; 8 cumul.2 -3.91 1.82</span></span>
<span></span>
<span><span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/synthdid_plot_ate.html">synthdid_plot_ate</a></span><span class="op">(</span><span class="va">est</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="28-synthdid_files/figure-html/synthdid%20subgroup%20analysis-1.png" width="90%" style="display: block; margin: auto;"></div>
<p>Plot different estimators</p>
<div class="sourceCode" id="cb758"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">causalverse</span><span class="op">)</span></span>
<span><span class="va">methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"synthdid"</span>, <span class="st">"did"</span>, <span class="st">"sc"</span>, <span class="st">"sc_ridge"</span>, <span class="st">"difp"</span>, <span class="st">"difp_ridge"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">methods</span>, <span class="kw">function</span><span class="op">(</span><span class="va">method</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/synthdid_est_ate.html">synthdid_est_ate</a></span><span class="op">(</span></span>
<span>    data               <span class="op">=</span> <span class="va">df</span>,</span>
<span>    adoption_cohorts   <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">7</span>,</span>
<span>    lags               <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    leads              <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    time_var           <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>    unit_id_var        <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>    treated_period_var <span class="op">=</span> <span class="st">"year_treated"</span>,</span>
<span>    treat_stat_var     <span class="op">=</span> <span class="st">"treatvar"</span>,</span>
<span>    outcome_var        <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    method <span class="op">=</span> <span class="va">method</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/synthdid_plot_ate.html">synthdid_plot_ate</a></span><span class="op">(</span><span class="va">estimates</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                 title <span class="op">=</span> <span class="va">methods</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                                 theme <span class="op">=</span> <span class="fu">causalverse</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/causalverse/man/ama_theme.html">ama_theme</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">plots</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="regression-discontinuity.html"><span class="header-section-number">27</span> Regression Discontinuity</a></div>
<div class="next"><a href="difference-in-differences.html"><span class="header-section-number">29</span> Difference-in-differences</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#synthetic-difference-in-differences"><span class="header-section-number">28</span> Synthetic Difference-in-Differences</a></li>
<li><a class="nav-link" href="#understanding"><span class="header-section-number">28.1</span> Understanding</a></li>
<li>
<a class="nav-link" href="#application-6"><span class="header-section-number">28.2</span> Application</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#block-treatment"><span class="header-section-number">28.2.1</span> Block Treatment</a></li>
<li><a class="nav-link" href="#staggered-adoption"><span class="header-section-number">28.2.2</span> Staggered Adoption</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mikenguyen13/data_analysis/blob/main/28-synthdid.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mikenguyen13/data_analysis/edit/main/28-synthdid.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>A Guide on Data Analysis</strong>" was written by Mike Nguyen. It was last built on 2025-02-27.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
